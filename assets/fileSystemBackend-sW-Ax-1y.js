var y=Object.defineProperty;var u=(l,e,t)=>e in l?y(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var o=(l,e,t)=>u(l,typeof e!="symbol"?e+"":e,t);import{aQ as a}from"./index-Ri5Ws9ur.js";class m{constructor(){o(this,"type","filesystem");o(this,"directoryHandle",null);o(this,"initialized",!1)}async isAvailable(){return typeof window<"u"&&"showDirectoryPicker"in window}async initialize(){try{a.info("[FileSystemBackend] Requesting directory access..."),this.directoryHandle=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"}),this.initialized=!0,a.info("[FileSystemBackend] Initialized successfully")}catch(e){throw a.error("[FileSystemBackend] Failed to initialize:",e),new Error("Failed to initialize FileSystemBackend: User may have denied access")}}async readNota(e){var t;this.ensureInitialized();try{const i=this.getNotaFileName(e),c=await(await(await this.directoryHandle.getFileHandle(i,{create:!1})).getFile()).text(),r=JSON.parse(c);return r.createdAt&&(r.createdAt=new Date(r.createdAt)),r.updatedAt&&(r.updatedAt=new Date(r.updatedAt)),a.debug(`[FileSystemBackend] Read nota: ${e}`),r}catch(i){return i.name==="NotFoundError"||(t=i.message)!=null&&t.includes("NotFoundError")||a.error(`[FileSystemBackend] Failed to read nota ${e}:`,i),null}}async writeNota(e){this.ensureInitialized();try{const t=this.getNotaFileName(e.id),n=await(await this.directoryHandle.getFileHandle(t,{create:!0})).createWritable(),d=JSON.stringify(e,null,2);await n.write(d),await n.close(),a.debug(`[FileSystemBackend] Wrote nota: ${e.id}`)}catch(t){throw a.error(`[FileSystemBackend] Failed to write nota ${e.id}:`,t),t}}async deleteNota(e){var t;this.ensureInitialized();try{const i=this.getNotaFileName(e);await this.directoryHandle.removeEntry(i),a.debug(`[FileSystemBackend] Deleted nota: ${e}`)}catch(i){if(i.name==="NotFoundError"||(t=i.message)!=null&&t.includes("NotFoundError"))return;throw a.error(`[FileSystemBackend] Failed to delete nota ${e}:`,i),i}}async listNotas(){this.ensureInitialized();const e=[];try{const t=this.directoryHandle;for await(const[i,n]of t.entries())if(n.kind==="file"&&i.endsWith(".json"))try{const r=await(await n.getFile()).text(),s=JSON.parse(r);s.createdAt&&(s.createdAt=new Date(s.createdAt)),s.updatedAt&&(s.updatedAt=new Date(s.updatedAt)),e.push(s)}catch{a.warn(`[FileSystemBackend] Failed to parse file ${n.name}, skipping`)}return a.debug(`[FileSystemBackend] Listed ${e.length} notas`),e}catch(t){return a.error("[FileSystemBackend] Failed to list notas:",t),[]}}ensureInitialized(){if(!this.initialized||!this.directoryHandle)throw new Error("FileSystemBackend not initialized. Call initialize() first.")}getNotaFileName(e){return`${e.replace(/[^a-zA-Z0-9-_]/g,"_")}.json`}}export{m as FileSystemBackend};
