import{az as c}from"./index-DIg-grGt.js";const u="bashnota-fs-handles",s="directory-handles",d="primary-directory";function l(){return new Promise((r,e)=>{const t=indexedDB.open(u,1);t.onerror=()=>{e(new Error("Failed to open directory handle database"))},t.onsuccess=()=>{r(t.result)},t.onupgradeneeded=o=>{const n=o.target.result;n&&!n.objectStoreNames.contains(s)&&n.createObjectStore(s)}})}async function m(r){try{const e=await l();return new Promise((t,o)=>{const n=e.transaction(s,"readwrite"),i=n.objectStore(s).put(r,d);i.onsuccess=()=>{c.info("[DirectoryHandleStorage] Directory handle saved"),t()},i.onerror=()=>{o(new Error("Failed to save directory handle"))},n.oncomplete=()=>{e.close()}})}catch(e){throw c.error("[DirectoryHandleStorage] Failed to save directory handle:",e),e}}async function h(){try{const r=await l();return new Promise((e,t)=>{const o=r.transaction(s,"readonly"),a=o.objectStore(s).get(d);a.onsuccess=()=>{const i=a.result;e(i||null)},a.onerror=()=>{t(new Error("Failed to retrieve directory handle"))},o.oncomplete=()=>{r.close()}})}catch(r){return c.error("[DirectoryHandleStorage] Failed to retrieve directory handle:",r),null}}async function w(r){try{const e=r;return await e.queryPermission({mode:"readwrite"})==="granted"?!0:await e.requestPermission({mode:"readwrite"})==="granted"}catch(e){return c.warn("[DirectoryHandleStorage] Failed to verify permission:",e),!1}}export{h as g,m as s,w as v};
