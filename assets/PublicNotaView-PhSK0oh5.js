import{c as Fe,d as Z,cA as We,a as Qe,cB as Xe,Q as re,b as T,o as l,w as i,r as Pe,m as Ue,e,aD as Ye,n as Ze,g as et,bc as tt,bd as ot,q as _,bh as st,cC as nt,P as G,ab as le,aQ as P,R as f,V as N,k as t,$ as W,cD as Ie,cE as at,c4 as lt,i as a,bk as Ce,J as I,aZ as rt,L as D,K as he,bm as it,cF as ut,A as ye,B as ge,D as be,E as A,G as Ve,S as ee,ap as te,cG as dt,F as fe,I as _e,N as we,cH as ne,v as K,x as M,cI as se,cJ as pe,cK as ct,cL as J,cM as $e,cN as mt,cO as pt,cP as De,cQ as vt,cR as ft,cS as ht,cT as yt,s as xe,bF as gt,bG as bt,bH as _t,bI as wt,t as L,bN as xt,bP as kt,b1 as Te,bQ as Ct,bR as $t,bM as Dt,a$ as At,cU as St,O as Le,bj as Nt,aO as de,X as Et,Y as Rt,cV as Ft,a1 as Pt,a2 as Ut,aP as Ae,cW as ae,aB as It,cX as Be,bU as Vt,bV as Tt,bW as Lt,bZ as Bt,aS as Ot,b0 as Se,cY as jt,bC as Mt,c5 as zt,a7 as qt,cZ as Ne,c_ as Ht,ar as Ee,c$ as Jt,d0 as Kt,a0 as Gt,d1 as Wt}from"./index-DL3HndNP.js";import{_ as Qt}from"./TableOfContents.vue_vue_type_script_setup_true_lang-CVqJMhXI.js";import{T as Oe,a as je}from"./thumbs-up-D4XIZ7VY.js";import{S as Xt}from"./shield-BH5JeB_m.js";/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=Fe("CircleUserIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=Fe("FileDownIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var eo=Z({__name:"DialogTrigger",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(p){const h=p,o=We(),{forwardRef:y,currentElement:d}=Qe();return o.contentId||(o.contentId=Xe(void 0,"reka-dialog-content")),re(()=>{o.triggerElement.value=d.value}),(s,v)=>(l(),T(e(Ye),Ue(h,{ref:e(y),type:s.as==="button"?"button":void 0,"aria-haspopup":"dialog","aria-expanded":e(o).open.value||!1,"aria-controls":e(o).open.value?e(o).contentId:void 0,"data-state":e(o).open.value?"open":"closed",onClick:e(o).onOpenToggle}),{default:i(()=>[Pe(s.$slots,"default")]),_:3},16,["type","aria-expanded","aria-controls","data-state","onClick"]))}}),to=eo;const oo=Z({__name:"DialogTrigger",props:{asChild:{type:Boolean},as:{}},setup(p){const h=p;return(o,y)=>(l(),T(e(to),Ze(et(h)),{default:i(()=>[Pe(o.$slots,"default")]),_:3},16))}}),so={class:"flex"},no={class:"flex-1 flex flex-col min-w-0"},ao={key:0,class:"border-b bg-background sticky top-0 z-10"},lo={class:"flex items-center justify-between px-4 py-2 text-sm text-muted-foreground"},ro={class:"text-xs"},io={class:"relative min-h-[300px] flex-1"},uo={key:0,class:"absolute inset-0 flex items-center justify-center"},co={class:"px-6 md:px-8 lg:px-12 py-6 mx-auto max-w-none"},mo={class:"max-w-3xl mx-auto"},po=Z({__name:"NotaContentViewer",props:{content:{},readonly:{type:Boolean},citations:{},isPublished:{type:Boolean}},emits:["content-rendered"],setup(p,{emit:h}){const o=p,y=h,d=tt(),s=ot(),v=_(!1),c=()=>{o.citations&&s.setPublicCitations(o.citations||[])};c();const g=w=>{const C=$=>{const u=[];return $.type==="executableCodeBlock"&&u.push($),$.content&&$.content.forEach(r=>{u.push(...C(r))}),u};C(w).forEach($=>{const{attrs:u,content:r}=$,B=r?r.map(V=>V.text).join(`
`):"";d.addCell({id:u.id,code:B,kernelName:u.kernelName,output:u.output,sessionId:u.sessionId,isPublished:o.isPublished||!1})})},k=st({content:o.content?JSON.parse(o.content):null,extensions:nt(),editable:!1,onCreate({editor:w}){g(w.getJSON()),b.value=!1,y("content-rendered")},nodeViews:{citation:(w,C,F,$)=>({dom:document.createElement("span"),update:u=>!0,destroy:()=>{},selectNode:()=>{},deselectNode:()=>{}}),notaTable:(w,C,F,$)=>{const u=document.createElement("div");u.className="data-table";const r=w.attrs.tableData;if(r){const B=document.createElement("table");B.className="data-table-content";const V=document.createElement("thead"),O=document.createElement("tr");r.columns.forEach(X=>{const Y=document.createElement("th");Y.textContent=X.title,O.appendChild(Y)}),V.appendChild(O),B.appendChild(V);const Q=document.createElement("tbody");r.rows.forEach(X=>{const Y=document.createElement("tr");r.columns.forEach(R=>{const x=document.createElement("td");x.textContent=X.cells[R.id]||"",Y.appendChild(x)}),Q.appendChild(Y)}),B.appendChild(Q),u.appendChild(B)}return{dom:u,update:B=>!0,destroy:()=>{},selectNode:()=>{},deselectNode:()=>{}}},bibliography:(w,C,F,$)=>{const u=document.createElement("div");return u.className="bibliography-wrapper",{dom:u,update:r=>!0,destroy:()=>{},selectNode:()=>{},deselectNode:()=>{},stopEvent:()=>!1,ignoreMutation:()=>!0,render:()=>({dom:u,update:r=>!0,destroy:()=>{},selectNode:()=>{},deselectNode:()=>{},stopEvent:()=>!1,ignoreMutation:()=>!0,props:{node:w,updateAttributes:()=>{},editor:k.value,citations:o.citations}})}}}}),S=G(()=>{if(!k.value)return!1;const w=k.value.getJSON(),C=F=>{if(F.type==="heading")return!0;if(F.content){for(const $ of F.content)if(C($))return!0}return!1};return C(w)});le(()=>o.citations,()=>{c()},{deep:!0}),le(()=>o.content,w=>{if(k.value&&w)try{k.value.commands.setContent(JSON.parse(w))}catch(C){P.error("Error parsing content:",C)}});const b=_(!0);return re(()=>{if(k.value)b.value=!1;else{const w=setInterval(()=>{k.value&&(b.value=!1,clearInterval(w))},100)}}),(w,C)=>(l(),f("div",so,[S.value?(l(),f("div",{key:0,class:W(["transition-all duration-300 ease-in-out sticky top-0 h-[calc(100vh-80px)]",{"w-64":v.value,"w-0":!v.value}])},[Ie(t("div",{style:lt({width:v.value?"100%":"0"}),class:"border-r h-full"},[a(e(Ce),{class:"h-full px-4 py-4"},{default:i(()=>[a(Qt,{editor:e(k)},null,8,["editor"])]),_:1})],4),[[at,v.value]])],2)):N("",!0),t("div",no,[S.value?(l(),f("div",ao,[t("div",lo,[a(e(I),{variant:"ghost",size:"sm",class:"flex items-center gap-2",onClick:C[0]||(C[0]=F=>v.value=!v.value)},{default:i(()=>[a(e(rt),{class:"h-4 w-4"}),t("span",ro,D(v.value?"Hide":"Show")+" Contents",1)]),_:1})])])):N("",!0),t("div",io,[b.value?(l(),f("div",uo,[a(e(he),{class:"w-8 h-8 rounded-full"})])):N("",!0),e(k)?(l(),T(e(Ce),{key:1,class:"h-full"},{default:i(()=>[t("div",co,[t("div",mo,[a(e(it),{editor:e(k),class:"prose prose-sm sm:prose lg:prose-lg"},null,8,["editor"])])])]),_:1})):N("",!0)])])]))}}),vo={class:"py-4"},fo={key:0,class:"flex justify-center py-4"},ho={key:1,class:"text-center py-4 text-muted-foreground"},yo={key:2,class:"space-y-2"},go=Z({__name:"VotersList",props:{notaId:{}},setup(p){const h=p,o=_(!1),y=_(!1),d=_([]),s=async()=>{try{y.value=!0,d.value=await ne.getVoters(h.notaId)}catch(v){P.error("Failed to fetch voters:",v)}finally{y.value=!1}};return le(o,v=>{v&&s()}),(v,c)=>(l(),f("div",null,[a(e(I),{variant:"outline",size:"sm",class:"flex items-center gap-1",onClick:c[0]||(c[0]=g=>o.value=!0)},{default:i(()=>[a(e(ut),{class:"h-4 w-4"}),c[3]||(c[3]=t("span",null,"Show Voters",-1))]),_:1}),a(e(we),{open:o.value,"onUpdate:open":c[2]||(c[2]=g=>o.value=g)},{default:i(()=>[a(e(ye),{class:"sm:max-w-md"},{default:i(()=>[a(e(ge),null,{default:i(()=>[a(e(be),null,{default:i(()=>c[4]||(c[4]=[A("Voters")])),_:1}),a(e(Ve),null,{default:i(()=>c[5]||(c[5]=[A(" Users who voted on this nota ")])),_:1})]),_:1}),t("div",vo,[y.value?(l(),f("div",fo,[a(e(he),{class:"h-8 w-8 rounded-full"})])):d.value.length===0?(l(),f("div",ho,c[6]||(c[6]=[t("p",null,"No votes on this nota yet.",-1)]))):(l(),f("div",yo,[c[9]||(c[9]=t("div",{class:"mb-2 flex justify-between border-b pb-2"},[t("span",{class:"font-medium"},"User"),t("span",{class:"font-medium"},"Vote")],-1)),(l(!0),f(ee,null,te(d.value,g=>(l(),f("div",{key:g.userId,class:"flex items-center justify-between py-2 border-b border-muted"},[a(e(dt),{to:`/@${g.userTag}`,class:"flex items-center gap-2 hover:underline text-primary"},{default:i(()=>[a(e(Yt),{class:"h-5 w-5"}),t("span",null,"@"+D(g.userTag),1)]),_:2},1032,["to"]),t("div",null,[g.voteType==="like"?(l(),T(e(fe),{key:0,variant:"default",class:"flex items-center gap-1"},{default:i(()=>[a(e(Oe),{class:"h-3 w-3"}),c[7]||(c[7]=A(" Liked "))]),_:1})):(l(),T(e(fe),{key:1,variant:"outline",class:"flex items-center gap-1 bg-muted"},{default:i(()=>[a(e(je),{class:"h-3 w-3"}),c[8]||(c[8]=A(" Disliked "))]),_:1}))])]))),128))]))]),a(e(_e),{class:"sm:justify-center"},{default:i(()=>[a(e(I),{variant:"secondary",onClick:c[1]||(c[1]=g=>o.value=!1)},{default:i(()=>c[10]||(c[10]=[A("Close")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}}),oe={async addComment(p,h,o,y,d,s=null){try{if(!p||!h||!d)throw new Error("Nota ID, user ID, and content are required to add a comment");P.info(`Adding comment to nota ${p} by user ${h}`);const v=K(M,"publishedNotas",p);if(!(await se(v)).exists())throw new Error(`Published nota ${p} not found when adding comment`);const g=pe(M),k=yt(),S=K(M,"comments",k),b=new Date().toISOString(),w={id:k,notaId:p,content:d,authorId:h,authorName:o,authorTag:y,createdAt:b,updatedAt:b,parentId:s,likeCount:0,dislikeCount:0,replyCount:0,votes:{}};if(g.set(S,w),g.update(v,{commentCount:J(1)}),s){const C=K(M,"comments",s);g.update(C,{replyCount:J(1)})}return await g.commit(),$e("nota_commented",{nota_id:p,user_id:h,is_reply:!!s}),P.info(`Comment added to nota ${p}`),w}catch(v){throw P.error("Failed to add comment:",v),v}},async getComments(p,h=null,o=50){try{if(!p)throw new Error("Nota ID is required to get comments");P.info(`Getting comments for nota ${p}`);const y=mt(pt(M,"comments"),De("notaId","==",p),De("parentId","==",h),vt("createdAt","desc"),ft(o)),d=await ht(y),s=[];return d.forEach(v=>{s.push(v.data())}),P.info(`Found ${s.length} comments for nota ${p}`),s}catch(y){throw P.error("Failed to get comments:",y),y}},async getComment(p){try{if(!p)throw new Error("Comment ID is required");const h=K(M,"comments",p),o=await se(h);return o.exists()?o.data():null}catch(h){throw P.error("Failed to get comment:",h),h}},async deleteComment(p,h){try{if(!p||!h)throw new Error("Comment ID and user ID are required");const o=K(M,"comments",p),y=await se(o);if(!y.exists())throw new Error(`Comment ${p} not found`);const d=y.data();if(d.authorId!==h){const c=K(M,"publishedNotas",d.notaId),g=await se(c);if(!g.exists()||g.data().authorId!==h)throw new Error("You do not have permission to delete this comment")}const s=pe(M);s.delete(o);const v=K(M,"publishedNotas",d.notaId);if(s.update(v,{commentCount:J(-1)}),d.parentId){const c=K(M,"comments",d.parentId);s.update(c,{replyCount:J(-1)})}return await s.commit(),P.info(`Comment ${p} deleted by user ${h}`),!0}catch(o){throw P.error("Failed to delete comment:",o),o}},async voteOnComment(p,h,o){try{if(!p||!h)throw new Error("Comment ID and user ID are required to vote");P.info(`Recording vote: ${o} for comment ${p} by user ${h}`);const y=K(M,"comments",p),d=await se(y);if(!d.exists())throw new Error(`Comment ${p} not found`);const s=d.data();let v=s.likeCount||0,c=s.dislikeCount||0;const k=(s.votes||{})[h]||null,S=pe(M);if(k===o){const b={};b[`votes.${h}`]=ct(),o==="like"?(b.likeCount=J(-1),v--):(b.dislikeCount=J(-1),c--),S.update(y,b)}else if(k){const b={};b[`votes.${h}`]=o,o==="like"?(b.likeCount=J(1),b.dislikeCount=J(-1),v++,c--):(b.likeCount=J(-1),b.dislikeCount=J(1),v--,c++),S.update(y,b)}else{const b={};b[`votes.${h}`]=o,o==="like"?(b.likeCount=J(1),v++):(b.dislikeCount=J(1),c++),S.update(y,b)}return await S.commit(),$e("comment_voted",{comment_id:p,nota_id:s.notaId,vote_type:o,is_vote_change:!!k}),{likeCount:v,dislikeCount:c,userVote:k===o?null:o}}catch(y){throw P.error("Failed to vote on comment:",y),y}},async getUserVote(p,h){try{if(!p||!h)return null;const o=K(M,"comments",p),y=await se(o);return y.exists()&&(y.data().votes||{})[h]||null}catch(o){return P.error("Failed to get user vote on comment:",o),null}}},bo={class:"comment-form mt-4 bg-muted/30 rounded-lg p-4"},_o={key:0,class:"text-center p-4"},wo={class:"flex justify-end gap-2"},ve=1e3,Me=Z({__name:"CommentForm",props:{notaId:{},parentId:{},placeholder:{},isReply:{type:Boolean}},emits:["comment-added","cancel-reply"],setup(p,{emit:h}){const o=p,y=h,d=_(!1),s=xe(),v=gt(bt({comment:_t().min(1,"Comment cannot be empty").max(ve,`Comment must be ${ve} characters or less`).refine(C=>C.trim().length>0,"Comment cannot be empty")})),{handleSubmit:c,resetForm:g,values:k}=wt({validationSchema:v,initialValues:{comment:""}}),S=G(()=>s.isAuthenticated&&k.comment&&k.comment.trim().length>0),b=c(async C=>{var F,$,u;if(!(!S.value||d.value)){d.value=!0;try{await oe.addComment(o.notaId,(F=s.currentUser)==null?void 0:F.uid,(($=s.currentUser)==null?void 0:$.displayName)||"Anonymous",((u=s.currentUser)==null?void 0:u.userTag)||"",C.comment.trim(),o.parentId||null),g(),y("comment-added"),L(o.isReply?"Reply posted":"Comment posted")}catch(r){P.error("Error posting comment:",r),L("Failed to post comment. Please try again.")}finally{d.value=!1}}}),w=()=>{g(),y("cancel-reply")};return(C,F)=>(l(),f("div",bo,[e(s).isAuthenticated?(l(),f("form",{key:1,onSubmit:F[0]||(F[0]=(...$)=>e(b)&&e(b)(...$)),class:"space-y-3"},[a(e(Dt),{name:"comment"},{default:i(({componentField:$})=>[a(e(xt),null,{default:i(()=>[a(e(kt),null,{default:i(()=>[a(e(Te),Ue({placeholder:C.placeholder||"Add a comment...",class:"min-h-[80px] resize-y"},$),null,16,["placeholder"])]),_:2},1024),a(e(Ct),{class:"flex justify-between items-center"},{default:i(()=>{var u;return[t("span",null,D(((u=e(k).comment)==null?void 0:u.length)||0)+"/"+D(ve),1),F[2]||(F[2]=t("span",{class:"text-xs"},"Share your thoughts respectfully",-1))]}),_:1}),a(e($t))]),_:2},1024)]),_:1}),t("div",wo,[C.isReply?(l(),T(e(I),{key:0,type:"button",variant:"ghost",size:"sm",onClick:w},{default:i(()=>F[3]||(F[3]=[A(" Cancel ")])),_:1})):N("",!0),a(e(I),{type:"submit",size:"sm",disabled:!S.value||d.value},{default:i(()=>[d.value?(l(),T(e(At),{key:0,class:"h-4 w-4 mr-1 animate-spin"})):(l(),T(e(St),{key:1,class:"h-4 w-4 mr-1"})),A(" "+D(C.isReply?"Reply":"Post Comment"),1)]),_:1},8,["disabled"])])],32)):(l(),f("div",_o,F[1]||(F[1]=[t("p",{class:"text-muted-foreground"},[A("Please "),t("a",{href:"/login",class:"text-primary hover:underline"},"log in"),A(" to comment")],-1)])))]))}}),xo={class:"comment-item border border-border rounded-lg p-4 my-3 bg-card"},ko={class:"flex items-center justify-between"},Co={class:"flex items-center gap-2"},$o=["title"],Do={class:"flex items-center gap-1"},Ao={class:"text-xs text-muted-foreground"},So={class:"mt-3 text-sm whitespace-pre-wrap"},No={class:"mt-4 flex items-center gap-4 text-sm text-muted-foreground"},Eo={key:0,class:"mt-4 ml-8"},Ro={key:1,class:"mt-4 ml-8 space-y-4"},Fo={key:0,class:"flex justify-center p-4"},Po={key:1,class:"text-center text-sm text-muted-foreground p-4"},Uo={key:1,class:"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-background border-r-transparent"},Io=Z({__name:"CommentItem",props:{comment:{},notaId:{}},emits:["comment-deleted","comment-updated"],setup(p,{emit:h}){const o=p,y=h,d=Le(),s=xe(),v=_(!1),c=_(!1),g=_(!1),k=_([]),S=_(!1),b=_(!1),w=_(!1),C=_(o.comment.likeCount||0),F=_(o.comment.dislikeCount||0),$=_(null);re(async()=>{var R;if(s.isAuthenticated&&((R=s.currentUser)!=null&&R.uid))try{$.value=await oe.getUserVote(o.comment.id,s.currentUser.uid)}catch(x){P.error("Error fetching user vote:",x)}});const u=G(()=>{var R;return s.isAuthenticated&&((R=s.currentUser)==null?void 0:R.uid)===o.comment.authorId}),r=async R=>{var x;if(!s.isAuthenticated||!((x=s.currentUser)!=null&&x.uid)){L("Please log in to vote");return}if(!c.value)try{c.value=!0;const q=await oe.voteOnComment(o.comment.id,s.currentUser.uid,R);C.value=q.likeCount,F.value=q.dislikeCount,$.value=q.userVote}catch(q){P.error("Failed to record vote:",q),L("Failed to record your vote")}finally{c.value=!1}},B=async()=>{v.value=!v.value,v.value&&k.value.length===0&&o.comment.replyCount>0&&await V()},V=async()=>{if(!S.value)try{S.value=!0,k.value=await oe.getComments(o.notaId,o.comment.id)}catch(R){P.error("Error loading replies:",R),L("Failed to load replies")}finally{S.value=!1}},O=()=>{if(!s.isAuthenticated){L("Please log in to reply");return}g.value=!0,!v.value&&o.comment.replyCount>0&&B()},Q=async()=>{g.value=!1,L("Reply added successfully"),o.comment.replyCount++,v.value=!0,await V(),y("comment-updated")},X=async()=>{var R;if(s.isAuthenticated&&!w.value)try{w.value=!0,await oe.deleteComment(o.comment.id,(R=s.currentUser)==null?void 0:R.uid)&&(b.value=!1,L("Comment deleted successfully"),y("comment-deleted"))}catch(x){P.error("Error deleting comment:",x),L("Failed to delete comment")}finally{w.value=!1}},Y=()=>{o.comment.authorTag&&d.push(`/@${o.comment.authorTag}`)};return(R,x)=>{var ie;const q=Nt("CommentItem",!0);return l(),f("div",xo,[t("div",ko,[t("div",Co,[t("div",{class:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-medium",title:R.comment.authorName},D(R.comment.authorName.charAt(0).toUpperCase()),9,$o),t("div",null,[t("div",Do,[t("span",{class:"font-medium cursor-pointer hover:underline",onClick:Y},D(R.comment.authorTag?`@${R.comment.authorTag}`:R.comment.authorName),1),u.value?(l(),T(e(fe),{key:0,variant:"outline",class:"text-xs"},{default:i(()=>x[6]||(x[6]=[A("Author")])),_:1})):N("",!0)]),t("span",Ao,D(e(de)(R.comment.createdAt)),1)])]),u.value||e(s).isAuthenticated&&((ie=e(s).currentUser)!=null&&ie.uid)?(l(),T(e(Et),{key:0},{default:i(()=>[a(e(Rt),{asChild:""},{default:i(()=>[a(e(I),{variant:"ghost",size:"icon",class:"h-8 w-8"},{default:i(()=>[a(e(Ft),{class:"h-4 w-4"})]),_:1})]),_:1}),a(e(Pt),{align:"end"},{default:i(()=>[u.value?(l(),T(e(Ut),{key:0,onClick:x[0]||(x[0]=H=>b.value=!0),class:"text-destructive focus:text-destructive cursor-pointer"},{default:i(()=>[a(e(Ae),{class:"h-4 w-4 mr-2"}),x[7]||(x[7]=A(" Delete "))]),_:1})):N("",!0)]),_:1})]),_:1})):N("",!0)]),t("div",So,D(R.comment.content),1),t("div",No,[a(e(I),{variant:"ghost",size:"sm",class:W(["h-8 px-2 flex items-center gap-1 transition-colors",{"text-primary":$.value==="like"}]),disabled:c.value,onClick:x[1]||(x[1]=H=>r("like"))},{default:i(()=>[a(e(Oe),{class:W([{"fill-current":$.value==="like"},"h-4 w-4"])},null,8,["class"]),t("span",null,D(C.value),1)]),_:1},8,["class","disabled"]),a(e(I),{variant:"ghost",size:"sm",class:W(["h-8 px-2 flex items-center gap-1 transition-colors",{"text-destructive":$.value==="dislike"}]),disabled:c.value,onClick:x[2]||(x[2]=H=>r("dislike"))},{default:i(()=>[a(e(je),{class:W([{"fill-current":$.value==="dislike"},"h-4 w-4"])},null,8,["class"]),t("span",null,D(F.value),1)]),_:1},8,["class","disabled"]),a(e(I),{variant:"ghost",size:"sm",class:"h-8 px-2 flex items-center gap-1",onClick:O},{default:i(()=>[a(e(ae),{class:"h-4 w-4"}),x[8]||(x[8]=t("span",null,"Reply",-1))]),_:1}),R.comment.replyCount>0?(l(),T(e(I),{key:0,variant:"ghost",size:"sm",class:"h-8 px-2 flex items-center gap-1 ml-auto",onClick:B},{default:i(()=>[t("span",null,D(v.value?"Hide":"Show")+" "+D(R.comment.replyCount)+" "+D(R.comment.replyCount===1?"reply":"replies"),1)]),_:1})):N("",!0)]),g.value?(l(),f("div",Eo,[a(Me,{"nota-id":R.notaId,"parent-id":R.comment.id,placeholder:"Write a reply...","is-reply":"",onCommentAdded:Q,onCancelReply:x[3]||(x[3]=H=>g.value=!1)},null,8,["nota-id","parent-id"])])):N("",!0),v.value?(l(),f("div",Ro,[S.value?(l(),f("div",Fo,x[9]||(x[9]=[t("div",{class:"animate-spin h-5 w-5 border-2 border-primary border-t-transparent rounded-full"},null,-1)]))):k.value.length===0?(l(),f("div",Po," No replies yet. Be the first to reply! ")):(l(!0),f(ee,{key:2},te(k.value,H=>(l(),f("div",{key:H.id,class:"border-l-2 border-muted pl-4"},[a(q,{comment:H,"nota-id":R.notaId,onCommentDeleted:V,onCommentUpdated:V},null,8,["comment","nota-id"])]))),128))])):N("",!0),a(e(we),{open:b.value,"onUpdate:open":x[5]||(x[5]=H=>b.value=H)},{default:i(()=>[a(e(ye),null,{default:i(()=>[a(e(ge),null,{default:i(()=>[a(e(be),null,{default:i(()=>x[10]||(x[10]=[A("Delete Comment")])),_:1})]),_:1}),x[13]||(x[13]=t("p",{class:"py-4"},"Are you sure you want to delete this comment? This action cannot be undone.",-1)),a(e(_e),null,{default:i(()=>[a(e(I),{variant:"outline",onClick:x[4]||(x[4]=H=>b.value=!1),disabled:w.value},{default:i(()=>x[11]||(x[11]=[A(" Cancel ")])),_:1},8,["disabled"]),a(e(I),{variant:"destructive",onClick:X,disabled:w.value},{default:i(()=>[w.value?(l(),f("div",Uo)):(l(),T(e(Ae),{key:0,class:"h-4 w-4 mr-2"})),x[12]||(x[12]=A(" Delete "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Vo={class:"comments-section mt-8 pt-6 border-t"},To={class:"flex items-center justify-between mb-6"},Lo={class:"text-xl font-semibold flex items-center"},Bo={key:0,class:"ml-2 text-sm font-normal text-muted-foreground"},Oo={key:2,class:"flex justify-center py-8"},jo={key:3,class:"bg-yellow-50 border border-yellow-200 p-4 rounded-md my-4"},Mo={class:"flex items-start"},zo={key:4,class:"bg-destructive/10 text-destructive p-4 rounded-md my-4"},qo={key:5,class:"text-center py-12 border border-dashed rounded-lg"},Ho={key:6,class:"space-y-4 mt-6"},Jo={key:0,class:"flex justify-center mt-6"},Ko={key:0,class:"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full mr-2"},ue=20,Go=Z({__name:"CommentSection",props:{notaId:{}},setup(p){const h=p,o=_([]),y=_(!0),d=_(null),s=_(0),v=_(1),c=_(!1),g=_(!1),k=_(!1),S=_(!1);re(async()=>{await b()}),le(()=>h.notaId,async()=>{h.notaId&&(y.value=!0,d.value=null,o.value=[],v.value=1,await b())});const b=async()=>{var u;if(h.notaId)try{y.value=!0,d.value=null,S.value=!1;const r=await oe.getComments(h.notaId,null,ue);o.value=r,s.value=r.length,c.value=r.length===ue}catch(r){P.error("Failed to load comments:",r),r&&r.name==="FirebaseError"&&(r.code==="permission-denied"||(u=r.message)!=null&&u.includes("Missing or insufficient permissions"))?(S.value=!0,d.value="Comments are not available at this moment. Firestore permissions need to be updated."):d.value="Failed to load comments. Please try again later."}finally{y.value=!1}},w=async()=>{if(!(g.value||!c.value))try{g.value=!0,v.value++;const u=await oe.getComments(h.notaId,null,ue);o.value=[...o.value,...u],c.value=u.length===ue}catch(u){P.error("Failed to load more comments:",u),L("Failed to load more comments")}finally{g.value=!1}},C=async()=>{await b(),k.value=!1},F=async u=>{o.value.splice(u,1),s.value--},$=()=>{k.value=!k.value};return(u,r)=>(l(),f("section",Vo,[t("div",To,[t("h2",Lo,[a(e(ae),{class:"mr-2 h-5 w-5"}),r[0]||(r[0]=A(" Comments ")),y.value?N("",!0):(l(),f("span",Bo," ("+D(s.value)+") ",1))]),a(e(I),{variant:"outline",size:"sm",onClick:b,disabled:y.value},{default:i(()=>[a(e(It),{class:W([{"animate-spin":y.value},"h-4 w-4 mr-2"])},null,8,["class"]),r[1]||(r[1]=A(" Refresh "))]),_:1},8,["disabled"])]),!k.value&&!S.value?(l(),T(e(I),{key:0,variant:"outline",class:"w-full justify-center mb-6",onClick:$},{default:i(()=>[a(e(ae),{class:"h-4 w-4 mr-2"}),r[2]||(r[2]=A(" Write a comment "))]),_:1})):N("",!0),k.value&&!S.value?(l(),T(Me,{key:1,"nota-id":u.notaId,onCommentAdded:C},null,8,["nota-id"])):N("",!0),y.value?(l(),f("div",Oo,r[3]||(r[3]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"},null,-1)]))):S.value?(l(),f("div",jo,[t("div",Mo,[a(e(Xt),{class:"h-5 w-5 text-yellow-500 mt-0.5 mr-2 flex-shrink-0"}),r[4]||(r[4]=t("div",null,[t("h3",{class:"font-medium text-yellow-800"},"Comments Unavailable"),t("p",{class:"text-yellow-700 mt-1 text-sm"}," Comments are not available at this moment. The system administrator needs to update Firestore security rules. ")],-1))])])):d.value&&!S.value?(l(),f("div",zo,[t("p",null,D(d.value),1),a(e(I),{variant:"outline",size:"sm",class:"mt-2",onClick:b},{default:i(()=>r[5]||(r[5]=[A(" Try Again ")])),_:1})])):o.value.length===0&&!S.value?(l(),f("div",qo,[a(e(ae),{class:"h-12 w-12 mx-auto text-muted-foreground opacity-20 mb-4"}),r[7]||(r[7]=t("h3",{class:"text-lg font-medium mb-2"},"No comments yet",-1)),r[8]||(r[8]=t("p",{class:"text-muted-foreground mb-4"},"Be the first to share your thoughts!",-1)),k.value?N("",!0):(l(),T(e(I),{key:0,onClick:$},{default:i(()=>[a(e(ae),{class:"h-4 w-4 mr-2"}),r[6]||(r[6]=A(" Add Comment "))]),_:1}))])):S.value?N("",!0):(l(),f("div",Ho,[(l(!0),f(ee,null,te(o.value,(B,V)=>(l(),T(Io,{key:B.id,comment:B,"nota-id":u.notaId,onCommentDeleted:O=>F(V),onCommentUpdated:b},null,8,["comment","nota-id","onCommentDeleted"]))),128)),c.value?(l(),f("div",Jo,[a(e(I),{variant:"outline",onClick:w,disabled:g.value,class:"min-w-[150px]"},{default:i(()=>[g.value?(l(),f("div",Ko)):N("",!0),t("span",null,D(g.value?"Loading...":"Load More"),1)]),_:1},8,["disabled"])])):N("",!0)]))]))}});function Re(p,h={}){var g;if(!p)return"";const o=((g=p.authorName.split(" ").pop())==null?void 0:g.toLowerCase())||"author",y=new Date(p.publishedAt).getFullYear(),d=h.customCiteKey||`${o}${y}`,s=typeof window<"u"?`${window.location.origin}/p/${p.id}`:`https://bashnota.com/p/${p.id}`,v=new Date().toISOString().split("T")[0];let c=`@misc{${d},
  author = {${p.authorName}},
  title = {${p.title}},
  year = {${y}},
  howpublished = {\\url{${s}}},
  publisher = {BashNota}`;return h.includeAccessDate!==!1&&(c+=`,
  note = {Online; accessed ${v}}`),c+=`
}`,c}function Wo(p,h="bibtex",o={}){if(!p)return"";switch(h){case"bibtex":return Re(p,o);case"apa":return"APA format not yet implemented";case"mla":return"MLA format not yet implemented";case"chicago":return"Chicago format not yet implemented";default:return Re(p,o)}}const Qo={class:"space-y-4 py-2"},Xo={key:0,class:"text-muted-foreground text-sm py-2"},Yo={key:1,class:"space-y-4"},Zo={key:0,class:"space-y-2"},es={class:"flex items-center space-x-2"},ts={class:"flex flex-col space-y-1.5"},os={class:"flex items-center gap-2"},ss=["disabled"],ns={key:0},as={key:1},ls=Z({__name:"CitationDialog",props:{nota:{},title:{},showTrigger:{type:Boolean}},setup(p,{expose:h}){const o=p,y=_(!1),d=_("bibtex"),s=_(!0),v=_(""),c=_(null),g=G(()=>Wo(o.nota,d.value,{includeAccessDate:s.value,customCiteKey:v.value||void 0})),k=()=>{navigator.clipboard.writeText(g.value).then(()=>{L("Citation copied to clipboard"),c.value=d.value,setTimeout(()=>{c.value=null},2e3)}).catch(()=>{L("Failed to copy citation")})},S=()=>{const $=new Blob([g.value],{type:"text/plain"}),u=URL.createObjectURL($),r=document.createElement("a");r.href=u,r.download=`citation_${o.nota.title.replace(/\s+/g,"_").toLowerCase()}.${d.value==="bibtex"?"bib":"txt"}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(u),L("Citation downloaded")},b=()=>{y.value=!0,v.value=""},w=()=>{y.value=!1},C=[{value:"bibtex",label:"BibTeX"},{value:"apa",label:"APA",disabled:!0},{value:"mla",label:"MLA",disabled:!0},{value:"chicago",label:"Chicago",disabled:!0}],F=G(()=>d.value!=="bibtex");return h({openDialog:b,closeDialog:w}),($,u)=>(l(),T(e(we),{open:y.value,"onUpdate:open":u[3]||(u[3]=r=>y.value=r)},{default:i(()=>[$.showTrigger?(l(),T(e(oo),{key:0},{default:i(()=>[a(e(I),{variant:"outline",size:"sm",title:$.title||"Cite this nota"},{default:i(()=>[a(e(Be),{class:"mr-2 h-4 w-4"}),A(" "+D($.title||"Cite"),1)]),_:1},8,["title"])]),_:1})):N("",!0),a(e(ye),{class:"max-w-md"},{default:i(()=>[a(e(ge),null,{default:i(()=>[a(e(be),null,{default:i(()=>u[4]||(u[4]=[A("Cite this Nota")])),_:1}),a(e(Ve),null,{default:i(()=>u[5]||(u[5]=[A(" Generate a citation for this published nota in your preferred format. ")])),_:1})]),_:1}),t("div",Qo,[a(e(Vt),{"default-value":d.value,"onUpdate:value":u[2]||(u[2]=r=>d.value=r),class:"w-full"},{default:i(()=>[a(e(Tt),{class:"mb-2 grid grid-cols-4"},{default:i(()=>[(l(),f(ee,null,te(C,r=>a(e(Lt),{key:r.value,value:r.value,disabled:r.disabled,class:"text-xs"},{default:i(()=>[A(D(r.label),1)]),_:2},1032,["value","disabled"])),64))]),_:1}),(l(),f(ee,null,te(C,r=>a(e(Bt),{key:r.value,value:r.value},{default:i(()=>[r.disabled?(l(),f("div",Xo,D(r.label)+" format coming soon. ",1)):(l(),f("div",Yo,[r.value==="bibtex"?(l(),f("div",Zo,[t("div",es,[a(e(Ot),{id:"include-date",checked:s.value,"onUpdate:checked":u[0]||(u[0]=B=>s.value=B)},null,8,["checked"]),a(e(Se),{for:"include-date"},{default:i(()=>u[6]||(u[6]=[A("Include access date")])),_:1})]),t("div",ts,[a(e(Se),{for:"cite-key",class:"text-sm"},{default:i(()=>u[7]||(u[7]=[A(" Custom cite key (optional) ")])),_:1}),t("div",os,[Ie(t("input",{id:"cite-key","onUpdate:modelValue":u[1]||(u[1]=B=>v.value=B),placeholder:"e.g. smith2023",class:"flex-1 rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors",disabled:F.value},null,8,ss),[[jt,v.value]])])])])):N("",!0),a(e(Te),{value:g.value,readonly:"",rows:"8",class:"font-mono text-xs"},null,8,["value"])]))]),_:2},1032,["value"])),64))]),_:1},8,["default-value"])]),a(e(_e),{class:"flex gap-2"},{default:i(()=>[a(e(I),{variant:"outline",onClick:S},{default:i(()=>[a(e(Zt),{class:"mr-2 h-4 w-4"}),u[8]||(u[8]=A(" Download "))]),_:1}),a(e(I),{onClick:k},{default:i(()=>[a(e(Mt),{class:"mr-2 h-4 w-4"}),c.value===d.value?(l(),f("span",ns,"Copied!")):(l(),f("span",as,"Copy"))]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}}),rs={class:"container mx-auto py-8 px-4 max-h-screen flex flex-col"},is={key:0,class:"flex justify-center items-center h-64","aria-live":"polite"},us={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},ds={class:"text-red-600 text-xl font-semibold mb-2"},cs={key:2,class:"flex-1 flex flex-col min-h-0",itemscope:"",itemtype:"https://schema.org/Article"},ms=["content"],ps=["content"],vs=["content"],fs=["content"],hs=["content"],ys=["content"],gs={itemprop:"author",itemscope:"",itemtype:"https://schema.org/Person"},bs=["content"],_s=["content"],ws={itemprop:"publisher",itemscope:"",itemtype:"https://schema.org/Organization"},xs=["content"],ks={itemprop:"logo",itemscope:"",itemtype:"https://schema.org/ImageObject"},Cs=["content"],$s=["content"],Ds={key:0,itemprop:"citation",itemscope:"",itemtype:"https://schema.org/CreativeWork"},As=["content"],Ss={key:1,itemprop:"image",itemscope:"",itemtype:"https://schema.org/ImageObject"},Ns=["content"],Es=["content"],Rs={class:"flex-shrink-0"},Fs={key:0,"aria-label":"Breadcrumb",class:"flex items-center text-sm mb-4"},Ps={class:"flex items-center",itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},Us={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},Is={itemprop:"name"},Vs=["content"],Ts={class:"flex items-center justify-between pb-4 border-b"},Ls={class:"flex items-center gap-4"},Bs={itemprop:"name",class:"text-2xl font-bold tracking-tight"},Os={class:"flex items-center gap-2"},js={class:"flex flex-wrap items-center justify-between text-sm text-muted-foreground"},Ms={class:"flex items-center gap-4"},zs={itemscope:"",itemtype:"https://schema.org/PublicationEvent"},qs=["datetime"],Hs=["datetime"],Js={itemprop:"name"},Ks={class:"flex items-center gap-2"},Gs={class:"relative group"},Ws={class:"font-medium"},Qs={key:0,class:"absolute -top-1 -right-1 h-2 w-2 bg-green-500 rounded-full animate-ping"},Xs={class:"absolute -top-8 left-0 bg-black bg-opacity-80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap"},Ys={class:"relative group"},Zs={class:"font-medium"},en={key:0,class:"absolute -top-1 -right-1 h-2 w-2 bg-red-500 rounded-full animate-ping"},tn={class:"absolute -top-8 left-0 bg-black bg-opacity-80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap"},on={class:"flex items-center gap-1 ml-2"},sn={class:"text-sm"},nn={key:0,class:"mt-2 sm:mt-0"},an={key:1,class:"text-sm text-muted-foreground bg-muted/30 p-2 rounded text-center my-2"},ln={class:"flex-1 overflow-y-auto min-h-0 space-y-6"},rn={itemprop:"articleBody"},un={key:0,class:"mt-8 pt-6 border-t"},dn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},cn=["href"],mn={class:"font-medium text-lg"},pn={class:"text-sm text-muted-foreground mt-1"},gn=Z({__name:"PublicNotaView",setup(p){const h=zt(),o=Le(),y=qt(),d=xe(),s=_(null),v=_(!0),c=_(null),g=_(null),k=_(!1),S=_(0),b=_(0),w=_(null),C=_(!1),F=_("");_("Published Note");const $=_(""),u=_(""),r=_(""),B=G(()=>!!g.value),V=G(()=>{const m=h.params.id||h.params.notaId;return typeof m=="string"?m:Array.isArray(m)?m[0]:""}),O=G(()=>{const m=h.params.userTag;return typeof m=="string"?m:Array.isArray(m)?m[0]:""}),Q=G(()=>typeof window<"u"?window.location.origin:""),X=_(0),Y=m=>{if(!m)return"Read this published note on BashNota - a powerful note-taking app for developers.";try{const n=JSON.parse(m);let E="";const U=z=>{z.text&&(E+=z.text+" "),z.content&&Array.isArray(z.content)&&z.content.forEach(U)};return n.content&&Array.isArray(n.content)&&n.content.forEach(U),E.trim().replace(/\s+/g," ").substring(0,157)+"..."||"Read this published note on BashNota - a powerful note-taking app for developers."}catch{return"Read this published note on BashNota - a powerful note-taking app for developers."}},R=m=>{const n=new Set;return m.tags&&m.tags.length>0&&m.tags.forEach(E=>n.add(E)),m.title&&m.title.split(" ").forEach(E=>{E.length>3&&n.add(E.toLowerCase())}),m.authorName&&n.add(m.authorName),Array.from(n).join(", ")},x=m=>{if(!m)return"";try{const n=JSON.parse(m);let E="";const U=j=>{var z;if(j.type==="image"&&((z=j.attrs)!=null&&z.src)){const me=j.attrs.src;return E=me.startsWith("http")?me:`${Q.value}${me}`,!0}return j.content&&Array.isArray(j.content)?j.content.some(U):!1};return n.content&&Array.isArray(n.content)&&n.content.some(U),E}catch{return""}},q=m=>O.value?`${window.location.origin}/@${O.value}/${m}`:`${window.location.origin}/p/${m}`;le(()=>s.value,m=>{if(m){const n=`${m.title} | BashNota`,E=Y(m.content),U=q(m.id),j=R(m),z=x(m.content);Ne({title:n,meta:[{name:"description",content:E},{name:"keywords",content:j},{name:"language",content:"en"},{name:"robots",content:"index, follow"},{name:"author",content:m.authorName},{property:"og:title",content:n},{property:"og:description",content:E},{property:"og:type",content:"article"},{property:"og:url",content:U},{property:"og:site_name",content:"BashNota"},{property:"og:locale",content:"en_US"},{property:"article:published_time",content:new Date(m.publishedAt).toISOString()},{property:"article:modified_time",content:new Date(m.updatedAt).toISOString()},{property:"article:author",content:m.authorName},{name:"twitter:card",content:z?"summary_large_image":"summary"},{name:"twitter:title",content:n},{name:"twitter:description",content:E},{name:"twitter:site",content:"@bashnota"},{name:"twitter:creator",content:`@${m.authorName}`}],link:[{rel:"canonical",href:U}]}),z&&Ne({meta:[{property:"og:image",content:z},{property:"og:image:alt",content:m.title},{property:"og:image:width",content:"1200"},{property:"og:image:height",content:"630"},{name:"twitter:image",content:z},{name:"twitter:image:alt",content:m.title}]})}},{immediate:!0}),re(async()=>{try{if(v.value=!0,!V.value){c.value="No nota ID provided";return}const m=await y.getPublishedNota(V.value);if(!m){c.value="This nota does not exist or is no longer public";return}if(s.value=m,setTimeout(()=>{ie(V.value)},2e3),m.parentId)try{const n=await y.getPublishedNota(m.parentId);n&&(g.value=n)}catch(n){P.error("Parent nota is not published or accessible:",n)}await Je()}catch(m){P.error("Error loading public nota:",m),c.value="Failed to load the nota"}finally{v.value=!1}});const ie=async m=>{var n;if(!k.value)try{const E=((n=d.currentUser)==null?void 0:n.uid)||null,U=document.referrer||null;await ne.recordView(m,E,U),k.value=!0}catch(E){P.error("Failed to record view statistics:",E)}},H=async()=>{g.value?(O.value?await o.push(`/@${O.value}/${g.value.id}`):await o.push(`/p/${g.value.id}`),location.reload()):O.value?o.push(`/@${O.value}`):o.push("/")},ze=()=>{s.value&&navigator.clipboard.writeText(q(s.value.id)).then(()=>{alert("Link copied to clipboard")}).catch(()=>{alert("Failed to copy link")})},qe=async()=>{if(s.value)try{v.value=!0;const m=await y.clonePublishedNota(V.value);m&&setTimeout(()=>{o.push(`/nota/${m.id}`)},1e3)}catch(m){P.error("Error cloning nota:",m),L("Failed to clone nota")}finally{v.value=!1}},He=G(()=>s.value?O.value?`/@${O.value}`:`/u/${s.value.authorId}`:"#"),Je=async()=>{var m;if(V.value)try{const n=await ne.getStatistics(V.value);if(S.value=n.likeCount||0,b.value=n.dislikeCount||0,X.value=n.cloneCount||0,d.isAuthenticated&&((m=d.currentUser)!=null&&m.uid)){const E=await ne.getUserVote(V.value,d.currentUser.uid);w.value=E}}catch(n){P.error("Failed to load voting data:",n)}},ke=async m=>{var n;if(!d.isAuthenticated||!((n=d.currentUser)!=null&&n.uid)){L("Please log in to vote");return}if(V.value)try{C.value=!0;const E=await ne.recordVote(V.value,d.currentUser.uid,m);S.value=E.likeCount,b.value=E.dislikeCount,w.value=E.userVote,E.userVote===null?L("Vote removed"):L(`You ${E.userVote}d this nota`)}catch(E){P.error("Failed to record vote:",E),L("Failed to record your vote")}finally{C.value=!1}},Ke=()=>{Wt(document),P.debug("Content rendered, converting public page links. Current path:",window.location.pathname)},ce=_(null),Ge=()=>{setTimeout(()=>{ce.value&&ce.value.openDialog()},0)};return(m,n)=>{var E;return l(),f("main",rs,[v.value?(l(),f("div",is,[a(e(he),{class:"w-10 h-10 rounded-full"}),n[6]||(n[6]=t("span",{class:"sr-only"},"Loading note content",-1))])):c.value?(l(),f("div",us,[t("h2",ds,D(c.value),1),n[8]||(n[8]=t("p",{class:"text-gray-600 mb-4"}," The nota you're looking for might have been deleted or made private. ",-1)),a(e(I),{onClick:H},{default:i(()=>n[7]||(n[7]=[A("Go Home")])),_:1})])):s.value?(l(),f("article",cs,[t("meta",{itemprop:"headline",content:s.value.title},null,8,ms),t("meta",{itemprop:"description",content:F.value},null,8,ps),t("meta",{itemprop:"datePublished",content:new Date(s.value.publishedAt).toISOString()},null,8,vs),t("meta",{itemprop:"dateModified",content:new Date(s.value.updatedAt).toISOString()},null,8,fs),t("meta",{itemprop:"keywords",content:u.value},null,8,hs),t("meta",{itemprop:"wordCount",content:s.value.content&&((E=JSON.parse(s.value.content).content)==null?void 0:E.length)||0},null,8,ys),n[24]||(n[24]=t("meta",{itemprop:"inLanguage",content:"en-US"},null,-1)),n[25]||(n[25]=t("meta",{itemprop:"isAccessibleForFree",content:"true"},null,-1)),n[26]||(n[26]=t("meta",{itemprop:"license",content:"https://creativecommons.org/licenses/by/4.0/"},null,-1)),t("div",gs,[t("meta",{itemprop:"name",content:s.value.authorName},null,8,bs),t("meta",{itemprop:"url",content:`${Q.value}/@${s.value.authorId}`},null,8,_s)]),t("div",ws,[n[9]||(n[9]=t("meta",{itemprop:"name",content:"BashNota"},null,-1)),t("meta",{itemprop:"url",content:Q.value},null,8,xs),t("div",ks,[t("meta",{itemprop:"url",content:`${Q.value}/logo.png`},null,8,Cs)])]),t("meta",{itemprop:"url",content:$.value},null,8,$s),s.value.citations&&s.value.citations.length>0?(l(),f("div",Ds,[(l(!0),f(ee,null,te(s.value.citations,(U,j)=>(l(),f("meta",{key:j,itemprop:"citation",content:U.title},null,8,As))),128))])):N("",!0),r.value?(l(),f("div",Ss,[t("meta",{itemprop:"url",content:r.value},null,8,Ns),t("meta",{itemprop:"caption",content:s.value.title},null,8,Es)])):N("",!0),t("div",Rs,[B.value?(l(),f("nav",Fs,[t("ol",Ps,[t("li",Us,[a(e(I),{variant:"ghost",size:"sm",class:"flex items-center gap-1",onClick:H},{default:i(()=>{var U;return[a(e(Ht),{class:"h-4 w-4"}),t("span",Is,"Back to "+D(((U=g.value)==null?void 0:U.title)||"Parent"),1),n[10]||(n[10]=t("meta",{itemprop:"position",content:"1"},null,-1)),t("meta",{itemprop:"item",content:g.value?q(g.value.id):"/"},null,8,Vs)]}),_:1})])])])):N("",!0),t("header",Ts,[t("div",Ls,[t("h1",Bs,D(s.value.title),1)]),t("div",Os,[e(d).isAuthenticated?(l(),T(e(I),{key:0,variant:"outline",size:"sm",onClick:qe},{default:i(()=>[a(e(Ee),{class:"mr-2 h-4 w-4"}),n[11]||(n[11]=A(" Clone "))]),_:1})):N("",!0),a(e(I),{variant:"outline",size:"sm",onClick:Ge,title:"Cite this nota"},{default:i(()=>[a(e(Be),{class:"mr-2 h-4 w-4"}),n[12]||(n[12]=A(" Cite "))]),_:1}),s.value?(l(),T(ls,{key:1,nota:s.value,showTrigger:!1,ref_key:"citationDialogRef",ref:ce},null,8,["nota"])):N("",!0),a(e(I),{variant:"outline",size:"sm",onClick:ze},{default:i(()=>[a(e(Jt),{class:"mr-2 h-4 w-4"}),n[13]||(n[13]=A(" Share "))]),_:1})])]),t("div",js,[t("div",Ms,[t("div",zs,[t("span",null,[n[14]||(n[14]=A("Published: ")),t("time",{itemprop:"datePublished",datetime:new Date(s.value.publishedAt).toISOString()},D(e(de)(s.value.publishedAt)),9,qs)]),n[17]||(n[17]=t("span",{class:"mx-2"},"•",-1)),t("span",null,[n[15]||(n[15]=A("Last updated: ")),t("time",{itemprop:"dateModified",datetime:new Date(s.value.updatedAt).toISOString()},D(e(de)(s.value.updatedAt)),9,Hs)]),n[18]||(n[18]=t("span",{class:"mx-2"},"•",-1)),t("span",null,[n[16]||(n[16]=A(" By: ")),t("a",{onClick:n[0]||(n[0]=U=>e(o).push(He.value)),class:"underline cursor-pointer hover:text-black",itemprop:"author",itemscope:"",itemtype:"https://schema.org/Person"},[t("span",Js,D(O.value?`@${O.value}`:s.value.authorName),1)])])]),t("div",Ks,[t("div",Gs,[a(e(I),{variant:w.value==="like"?"default":"ghost",class:W(["transition-all duration-200 flex items-center gap-1 relative",w.value==="like"?"text-green-600 hover:text-green-700":"hover:text-green-600",e(d).isAuthenticated?"":"cursor-help"]),size:"sm",disabled:C.value,onClick:n[1]||(n[1]=U=>e(d).isAuthenticated?ke("like"):null),onMouseenter:n[2]||(n[2]=U=>e(d).isAuthenticated?null:e(L)("Please login to vote"))},{default:i(()=>[a(e(Kt),{class:W(["h-5 w-5 transition-transform duration-200",{"scale-125":w.value==="like"}])},null,8,["class"]),t("span",Ws,D(S.value),1),C.value&&w.value==="like"?(l(),f("span",Qs)):N("",!0)]),_:1},8,["variant","class","disabled"]),t("div",Xs,D(w.value==="like"?"Remove Upvote":"Upvote this nota"),1)]),t("div",Ys,[a(e(I),{variant:w.value==="dislike"?"default":"ghost",class:W(["transition-all duration-200 flex items-center gap-1 relative",w.value==="dislike"?"text-red-600 hover:text-red-700":"hover:text-red-600",e(d).isAuthenticated?"":"cursor-help"]),size:"sm",disabled:C.value,onClick:n[3]||(n[3]=U=>e(d).isAuthenticated?ke("dislike"):null),onMouseenter:n[4]||(n[4]=U=>e(d).isAuthenticated?null:e(L)("Please login to vote"))},{default:i(()=>[a(e(Gt),{class:W(["h-5 w-5 transition-transform duration-200",{"scale-125":w.value==="dislike"}])},null,8,["class"]),t("span",Zs,D(b.value),1),C.value&&w.value==="dislike"?(l(),f("span",en)):N("",!0)]),_:1},8,["variant","class","disabled"]),t("div",tn,D(w.value==="dislike"?"Remove Downvote":"Downvote this nota"),1)]),S.value>0||b.value>0?(l(),T(go,{key:0,notaId:V.value},null,8,["notaId"])):N("",!0),t("div",on,[a(e(Ee),{class:"h-4 w-4 text-muted-foreground"}),t("span",sn,D(X.value)+" clone"+D(X.value!==1?"s":""),1)])])]),s.value.tags&&s.value.tags.length>0?(l(),f("div",nn,[n[19]||(n[19]=t("span",{class:"text-muted-foreground"},"Tags: ",-1)),(l(!0),f(ee,null,te(s.value.tags,(U,j)=>(l(),f("span",{key:j,class:"inline-block bg-muted/50 text-xs px-2 py-1 rounded-md mx-1"},D(U),1))),128))])):N("",!0)]),e(d).isAuthenticated?N("",!0):(l(),f("div",an,[n[20]||(n[20]=A(" Please ")),t("button",{class:"underline text-primary hover:text-primary/80",onClick:n[5]||(n[5]=U=>e(o).push("/login"))},"login"),n[21]||(n[21]=A(" to vote on this nota "))])),n[22]||(n[22]=t("hr",{class:"border-t border-gray-200"},null,-1))]),t("div",ln,[t("div",rn,[a(po,{content:s.value.content,citations:s.value.citations,isPublished:!0,readonly:"",onContentRendered:Ke},null,8,["content","citations"])]),s.value.relatedNotas&&s.value.relatedNotas.length>0?(l(),f("footer",un,[n[23]||(n[23]=t("h2",{class:"text-xl font-semibold mb-4"},"Related Notes",-1)),t("ul",dn,[(l(!0),f(ee,null,te(s.value.relatedNotas,(U,j)=>(l(),f("li",{key:j,class:"border rounded-lg p-4 hover:bg-muted/30 transition-colors"},[t("a",{href:q(U.id),class:"block"},[t("h3",mn,D(U.title),1),t("p",pn,D(e(de)(U.updatedAt)),1)],8,cn)]))),128))])])):N("",!0),s.value?(l(),T(Go,{key:1,"nota-id":V.value},null,8,["nota-id"])):N("",!0)])])):N("",!0)])}}});export{gn as default};
