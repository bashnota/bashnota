var Es=Object.defineProperty;var Bs=(m,t,e)=>t in m?Es(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var Dt=(m,t,e)=>Bs(m,typeof t!="symbol"?t+"":t,e);import{c as at,d as K,b as O,o as f,w as l,r as ue,n as $e,g as Te,e as n,aD as Wt,aE as Qt,a as Ve,aF as Is,q as D,aG as Ps,ab as ie,aH as Vs,p as ot,m as ve,aI as Ms,u as Ls,aJ as Ds,aK as As,aL as Ns,P as se,Q as Ce,R as k,i as a,aM as zs,S as Q,aN as be,a7 as we,O as kt,N as Oe,A as rt,k as c,B as Fe,D as qe,E as V,V as q,ap as ee,L as A,aO as Rs,J,$ as le,aP as it,t as N,aQ as I,aR as Gs,a6 as Me,aS as Os,F as Yt,aT as At,aU as lt,aV as Ge,aW as _t,aX as Ze,aB as Fs,aY as qs,aZ as Xt,ac as Be,ar as et,aC as bt,a_ as Nt,aA as wt,a$ as js,U as St,G as ut,b0 as Ie,b1 as Zt,I as Ct,b2 as Hs,b3 as Us,b4 as Js,b5 as Ks,b6 as Ws,b7 as es,b8 as Qs,b9 as Ys,ba as Xs,bb as dt,bc as ts,bd as Zs,be as en,bf as tn,bg as sn,bh as nn,bi as an,ay as tt,bj as on,bk as rn,ae as ln,bl as un,bm as dn,bn as ss,bo as ns,bp as zt,bq as cn,br as Rt,bs as Gt,bt as pn,h as ct,j as je,bu as mn,bv as Re,bw as fn,bx as gn,by as vn,bz as hn,bA as yn,bB as bn,bC as wn,a4 as xn,bD as kn,bE as _n,bF as Sn,bG as Cn,bH as Je,bI as $n,bJ as as,bK as os,bL as Tn,ad as rs,bM as Ke,bN as We,bO as Qe,bP as Ye,bQ as En,bR as Xe,bS as $t,bT as is,bU as ls,bV as us,bW as st,bX as xt,bY as Ot,bZ as nt,b_ as pt,b$ as ye,aq as Ft,c0 as ds,c1 as cs,c2 as Bn,c3 as In,c4 as gt,c5 as Pn,c6 as Vn}from"./index-BQvMrvkP.js";import{_ as Mn}from"./TableOfContents.vue_vue_type_script_setup_true_lang-BvrneZaB.js";import{u as Ln,g as Dn}from"./iconResolver-DbXfVuQD.js";import{_ as An}from"./ServerListItem.vue_vue_type_script_setup_true_lang-C3swJfaS.js";/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=at("BlocksIcon",[["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3",key:"1fpvtg"}]]);/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=at("CircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=at("SquareSplitHorizontalIcon",[["path",{d:"M8 19H5c-1 0-2-1-2-2V7c0-1 1-2 2-2h3",key:"lubmu8"}],["path",{d:"M16 5h3c1 0 2 1 2 2v10c0 1-1 2-2 2h-3",key:"1ag34g"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-vue-next v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=at("SquareSplitVerticalIcon",[["path",{d:"M5 8V5c0-1 1-2 2-2h10c1 0 2 1 2 2v3",key:"1pi83i"}],["path",{d:"M19 16v3c0 1-1 2-2 2H7c-1 0-2-1-2-2v-3",key:"ido5k7"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);var On=K({__name:"MenuLabel",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"div"}},setup(m){const t=m;return(e,s)=>(f(),O(n(Wt),$e(Te(t)),{default:l(()=>[ue(e.$slots,"default")]),_:3},16))}}),Fn=On;const[ps,qn]=Ps("ContextMenuRoot");var jn=K({inheritAttrs:!1,__name:"ContextMenuRoot",props:{dir:{type:String,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(m,{emit:t}){const e=m,s=t,{dir:r,modal:o}=Qt(e);Ve();const i=Is(r),u=D(!1),g=D();return qn({open:u,onOpenChange:d=>{u.value=d},dir:i,modal:o,triggerElement:g}),ie(u,d=>{s("update:open",d)}),(d,x)=>(f(),O(n(Vs),{open:u.value,"onUpdate:open":x[0]||(x[0]=L=>u.value=L),dir:n(i),modal:n(o)},{default:l(()=>[ue(d.$slots,"default")]),_:3},8,["open","dir","modal"]))}}),Hn=jn,Un=K({__name:"ContextMenuContent",props:{forceMount:{type:Boolean,required:!1},loop:{type:Boolean,required:!1},sideFlip:{type:Boolean,required:!1},alignOffset:{type:Number,required:!1,default:0},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1,default:!0},collisionBoundary:{type:null,required:!1,default:()=>[]},collisionPadding:{type:[Number,Object],required:!1,default:0},sticky:{type:String,required:!1,default:"partial"},hideWhenDetached:{type:Boolean,required:!1,default:!1},positionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(m,{emit:t}){const r=ot(m,t);Ve();const o=ps(),i=D(!1);return(u,g)=>(f(),O(n(Ms),ve(n(r),{side:"right","side-offset":2,align:"start","update-position-strategy":"always",style:{"--reka-context-menu-content-transform-origin":"var(--reka-popper-transform-origin)","--reka-context-menu-content-available-width":"var(--reka-popper-available-width)","--reka-context-menu-content-available-height":"var(--reka-popper-available-height)","--reka-context-menu-trigger-width":"var(--reka-popper-anchor-width)","--reka-context-menu-trigger-height":"var(--reka-popper-anchor-height)"},onCloseAutoFocus:g[0]||(g[0]=d=>{!d.defaultPrevented&&i.value&&d.preventDefault(),i.value=!1}),onInteractOutside:g[1]||(g[1]=d=>{d.detail.originalEvent.button===2&&d.target===n(o).triggerElement.value&&d.preventDefault(),!d.defaultPrevented&&!n(o).modal.value&&(i.value=!0)})}),{default:l(()=>[ue(u.$slots,"default")]),_:3},16))}}),Jn=Un,Kn=K({__name:"ContextMenuItem",props:{disabled:{type:Boolean,required:!1},textValue:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["select"],setup(m,{emit:t}){const e=m,r=Ls(t);return Ve(),(o,i)=>(f(),O(n(Ds),$e(Te({...e,...n(r)})),{default:l(()=>[ue(o.$slots,"default")]),_:3},16))}}),Wn=Kn,Qn=K({__name:"ContextMenuLabel",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(m){const t=m;return Ve(),(e,s)=>(f(),O(n(Fn),$e(Te(t)),{default:l(()=>[ue(e.$slots,"default")]),_:3},16))}}),Yn=Qn,Xn=K({__name:"ContextMenuPortal",props:{to:{type:null,required:!1},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(m){const t=m;return(e,s)=>(f(),O(n(As),$e(Te(t)),{default:l(()=>[ue(e.$slots,"default")]),_:3},16))}}),Zn=Xn,ea=K({__name:"ContextMenuSeparator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(m){const t=m;return Ve(),(e,s)=>(f(),O(n(Ns),$e(Te(t)),{default:l(()=>[ue(e.$slots,"default")]),_:3},16))}}),ta=ea;function qt(m){return m.pointerType!=="mouse"}var sa=K({inheritAttrs:!1,__name:"ContextMenuTrigger",props:{disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(m){const t=m,{disabled:e}=Qt(t),{forwardRef:s,currentElement:r}=Ve(),o=ps(),i=D({x:0,y:0}),u=se(()=>({getBoundingClientRect:()=>({width:0,height:0,left:i.value.x,right:i.value.x,top:i.value.y,bottom:i.value.y,...i.value})})),g=D(0);function d(){window.clearTimeout(g.value)}function x(b){i.value={x:b.clientX,y:b.clientY},o.onOpenChange(!0)}async function L(b){e.value||(await be(),b.defaultPrevented||(d(),x(b),b.preventDefault()))}async function G(b){e.value||(await be(),qt(b)&&!b.defaultPrevented&&(d(),g.value=window.setTimeout(()=>x(b),700)))}async function C(b){e.value||(await be(),qt(b)&&!b.defaultPrevented&&d())}return Ce(()=>{r.value&&(o.triggerElement.value=r.value)}),(b,S)=>(f(),k(Q,null,[a(n(zs),{as:"template",reference:u.value},null,8,["reference"]),a(n(Wt),ve({ref:n(s),as:b.as,"as-child":b.asChild,"data-state":n(o).open.value?"open":"closed","data-disabled":n(e)?"":void 0,style:{WebkitTouchCallout:"none",pointerEvents:"auto"}},b.$attrs,{onContextmenu:L,onPointerdown:G,onPointermove:C,onPointercancel:C,onPointerup:C}),{default:l(()=>[ue(b.$slots,"default")]),_:3},16,["as","as-child","data-state","data-disabled"])],64))}}),na=sa;const aa={class:"space-y-4 max-h-[50vh] overflow-y-auto"},oa={key:0,class:"text-center py-4 text-muted-foreground"},ra={class:"font-medium"},ia={class:"text-sm text-muted-foreground"},la={class:"flex items-center gap-2"},ua={key:0,class:"inline-block h-3 w-3 animate-spin rounded-full border-2 border-solid border-current border-r-transparent mr-2"},da={key:0,class:"inline-block h-3 w-3 animate-spin rounded-full border-2 border-solid border-current border-r-transparent mr-2"},ca=K({__name:"VersionHistoryDialog",props:{notaId:{},open:{type:Boolean}},emits:["update:open","version-restored"],setup(m,{emit:t}){const e=m,s=t,r=we(),o=kt(),i=D(!1),u=D(!1),g=D(""),d=se(()=>r.getNotaVersions(e.notaId).sort((C,b)=>{const S=new Date(C.createdAt);return new Date(b.createdAt).getTime()-S.getTime()})),x=()=>{s("update:open",!1)},L=async C=>{try{i.value=!0,g.value=C,await r.restoreVersion(e.notaId,C),N("Version restored successfully"),s("version-restored"),x();const b=o.currentRoute.value;o.push({path:"/temp-redirect"}).then(()=>{o.push({path:b.path})})}catch(b){I.error("Error restoring version:",b),N("Failed to restore version")}finally{i.value=!1,g.value=""}},G=async C=>{try{if(!confirm("Are you sure you want to delete this version? This action cannot be undone."))return;u.value=!0,g.value=C,await r.deleteVersion(e.notaId,C),N("Version deleted successfully")}catch(b){I.error("Error deleting version:",b),N("Failed to delete version")}finally{u.value=!1,g.value=""}};return(C,b)=>(f(),O(n(Oe),{open:C.open,"onUpdate:open":x},{default:l(()=>[a(n(rt),{class:"sm:max-w-md"},{default:l(()=>[a(n(Fe),null,{default:l(()=>[a(n(qe),null,{default:l(()=>b[0]||(b[0]=[V("Version History")])),_:1})]),_:1}),c("div",aa,[d.value.length===0?(f(),k("div",oa," No saved versions yet ")):q("",!0),(f(!0),k(Q,null,ee(d.value,S=>(f(),k("div",{key:S.id,class:"flex items-center justify-between p-3 border rounded-md"},[c("div",null,[c("div",ra,A(S.versionName),1),c("div",ia,A(n(Rs)(S.createdAt)),1)]),c("div",la,[a(n(J),{variant:"outline",size:"sm",onClick:y=>L(S.id),disabled:i.value||u.value,class:le({"opacity-50 cursor-not-allowed":i.value||u.value})},{default:l(()=>[i.value&&g.value===S.id?(f(),k("span",ua)):q("",!0),b[1]||(b[1]=V(" Restore "))]),_:2},1032,["onClick","disabled","class"]),a(n(J),{variant:"destructive",size:"sm",onClick:y=>G(S.id),disabled:i.value||u.value,class:le({"opacity-50 cursor-not-allowed":i.value||u.value})},{default:l(()=>[u.value&&g.value===S.id?(f(),k("span",da)):q("",!0),a(n(it),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled","class"])])]))),128))])]),_:1})]),_:1},8,["open"]))}}),pa={class:"nota-breadcrumb","aria-label":"Nota navigation"},ma={class:"flex items-center space-x-1 text-sm text-muted-foreground"},fa=["onClick","title"],ga={key:2,class:"px-2 py-1 font-medium text-foreground"},va=K({__name:"NotaBreadcrumb",props:{notaId:{}},setup(m){const t=m,e=kt(),s=we(),r=se(()=>s.getNotaHierarchy(t.notaId)),o=i=>{e.push(`/nota/${i}`)};return(i,u)=>(f(),k("nav",pa,[c("ol",ma,[(f(!0),k(Q,null,ee(r.value,(g,d)=>(f(),k("li",{key:g.id,class:"flex items-center"},[d>0?(f(),O(n(Gs),{key:0,class:"h-4 w-4 mx-1"})):q("",!0),d<r.value.length-1?(f(),k("button",{key:1,onClick:x=>o(g.id),class:"hover:text-foreground transition-colors duration-200 px-2 py-1 rounded-md hover:bg-muted/50",title:`Go to ${g.title}`},A(g.title),9,fa)):(f(),k("span",ga,A(g.title),1))]))),128))])]))}}),ha=Me(va,[["__scopeId","data-v-17b789a7"]]);class ya{constructor(){Dt(this,"blockPatterns",[]);this.initializeBlockPatterns()}initializeBlockPatterns(){this.blockPatterns=[{name:"heading",pattern:/^(#{1,6})\s+(.+)$/gm,blockType:"heading",attributes:t=>({level:t[1].length,content:t[2].trim()}),validate:t=>{const e=[],s=[];return t.attributes.content||e.push("Heading content cannot be empty"),t.attributes.level>6&&e.push("Heading level cannot exceed 6"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"codeBlock",pattern:/^```(\w+)?\n([\s\S]*?)\n```$/gm,blockType:"code",attributes:t=>({language:t[1]||"text",content:t[2]}),validate:t=>{const e=[],s=[];return t.attributes.content||e.push("Code block content cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"mathBlock",pattern:/^\$\$([\s\S]*?)\$\$$/gm,blockType:"math",attributes:t=>({latex:t[1].trim(),displayMode:!0}),validate:t=>{const e=[],s=[];return t.attributes.latex||e.push("Math content cannot be empty"),t.attributes.latex.includes("\\")&&!t.attributes.latex.includes("\\")&&s.push("LaTeX content may be incomplete"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"table",pattern:/^(\|.*\|)\n(\|[\s\-:|]+\|)\n((?:\|.*\|\n?)*)$/gm,blockType:"table",attributes:t=>{const e=t[0].split(`
`).filter(o=>o.trim()),s=this.parseTableRow(e[0]),r=e.slice(2).map(o=>this.parseTableRow(o));return{headers:s,rows:r}},validate:t=>{const e=[],s=[];return(!t.attributes.headers||t.attributes.headers.length===0)&&e.push("Table must have headers"),(!t.attributes.rows||t.attributes.rows.length===0)&&s.push("Table has no data rows"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"blockquote",pattern:/^(>\s+.+\n?)+$/gm,blockType:"quote",attributes:t=>({content:t[0].replace(/^>\s+/gm,"").trim()}),validate:t=>{const e=[],s=[];return t.attributes.content||e.push("Blockquote content cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"list",pattern:/^((?:[\s]*[-*+]\s+.+\n?)+|(?:[\s]*\d+\.\s+.+\n?)+)$/gm,blockType:"list",attributes:t=>{const e=/^\s*\d+\./.test(t[0]),s=t[0].split(`
`).filter(r=>r.trim()).map(r=>r.replace(/^[\s]*[-*+\d\.]\s+/,"").trim());return{listType:e?"ordered":"unordered",items:s}},validate:t=>{const e=[],s=[];return(!t.attributes.items||t.attributes.items.length===0)&&e.push("List must have at least one item"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"horizontalRule",pattern:/^[\s]*[-*_]{3,}[\s]*$/gm,blockType:"horizontalRule",attributes:()=>({}),validate:()=>({isValid:!0,errors:[],warnings:[]})},{name:"link",pattern:/\[([^\]]+)\]\(([^)]+)\)/g,blockType:"link",attributes:t=>({text:t[1],url:t[2]}),validate:t=>{const e=[],s=[];t.attributes.text||e.push("Link text cannot be empty"),t.attributes.url||e.push("Link URL cannot be empty");try{new URL(t.attributes.url)}catch{s.push("Link URL may not be valid")}return{isValid:e.length===0,errors:e,warnings:s}}},{name:"image",pattern:/!\[([^\]]*)\]\(([^)]+)(?:\s+"([^"]+)")?\)/g,blockType:"image",attributes:t=>({alt:t[1]||"",src:t[2],title:t[3]||""}),validate:t=>{const e=[],s=[];return t.attributes.src||e.push("Image source cannot be empty"),t.attributes.alt||s.push("Image should have alt text for accessibility"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"multipleImages",pattern:/(?:!\[([^\]]*)\]\(([^)]+)(?:\s+"([^"]+)")?\)\s*\n?)+/g,blockType:"multipleImages",attributes:t=>{const e=t[0].matchAll(/!\[([^\]]*)\]\(([^)]+)(?:\s+"([^"]+)")?\)/g),s=[];for(const r of e)s.push({alt:r[1]||"",src:r[2],title:r[3]||""});return{images:s}},validate:t=>{const e=[],s=[];return(!t.attributes.images||t.attributes.images.length===0)&&e.push("Multiple images block must contain at least one image"),t.attributes.images.length===1&&s.push("Consider using single image pattern for single images"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"executableCode",pattern:/^```\{(\w+)(?:\s*,\s*([^}]+))?\}\n([\s\S]*?)\n```$/gm,blockType:"executableCodeBlock",attributes:t=>({language:t[1],options:t[2]?this.parseOptions(t[2]):{},content:t[3]}),validate:t=>{const e=[],s=[];return t.attributes.language||e.push("Executable code block must specify a language"),t.attributes.content||e.push("Executable code block content cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"mermaid",pattern:/^```mermaid\s*\n([\s\S]*?)\n```$/gm,blockType:"mermaid",attributes:t=>({content:t[1].trim()}),validate:t=>{const e=[],s=[];return t.attributes.content||e.push("Mermaid diagram content cannot be empty"),!t.attributes.content.includes("graph")&&!t.attributes.content.includes("flowchart")&&!t.attributes.content.includes("sequenceDiagram")&&s.push("Mermaid content may not be valid diagram syntax"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"citation",pattern:/@([a-zA-Z0-9_-]+)/g,blockType:"citation",attributes:t=>({citationKey:t[1]}),validate:t=>{const e=[],s=[];return t.attributes.citationKey||e.push("Citation key cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"bibliography",pattern:/(?:@([a-zA-Z0-9_-]+)\s*)+/g,blockType:"bibliography",attributes:t=>{const e=t[0].matchAll(/@([a-zA-Z0-9_-]+)/g),s=[];for(const r of e)s.push(r[1]);return{citations:s}},validate:t=>{const e=[],s=[];return(!t.attributes.citations||t.attributes.citations.length===0)&&e.push("Bibliography must contain at least one citation"),t.attributes.citations.length===1&&s.push("Consider using single citation pattern for single citations"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"youtube",pattern:/^!\[youtube\]\(([^)]+)\)$/gm,blockType:"youtube",attributes:t=>({videoId:this.extractYouTubeId(t[1])}),validate:t=>{const e=[],s=[];return t.attributes.videoId||e.push("YouTube video ID could not be extracted"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"theorem",pattern:/^\\begin\{theorem\}(?:\[([^\]]+)\])?\s*\n([\s\S]*?)\n\\end\{theorem\}$/gm,blockType:"theorem",attributes:t=>({title:t[1]||"Theorem",content:t[2].trim()}),validate:t=>{const e=[],s=[];return t.attributes.content||e.push("Theorem content cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"aiGeneration",pattern:/^```ai\s*\n([\s\S]*?)\n```$/gm,blockType:"aiGeneration",attributes:t=>({prompt:t[1].trim(),model:"gpt-4",timestamp:new Date}),validate:t=>{const e=[],s=[];return t.attributes.prompt||e.push("AI generation prompt cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"confusionMatrix",pattern:/^```confusion-matrix\s*\n([\s\S]*?)\n```$/gm,blockType:"confusionMatrix",attributes:t=>({matrixData:t[1].trim(),title:"Confusion Matrix",source:"markdown"}),validate:t=>{const e=[],s=[];return t.attributes.matrixData||e.push("Confusion matrix data cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"pipeline",pattern:/^```pipeline\s*\n([\s\S]*?)\n```$/gm,blockType:"pipeline",attributes:t=>({description:t[1].trim(),title:"Pipeline",nodes:[],edges:[]}),validate:t=>{const e=[],s=[];return t.attributes.description||e.push("Pipeline description cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}},{name:"drawio",pattern:/^```drawio\s*\n([\s\S]*?)\n```$/gm,blockType:"drawio",attributes:t=>({diagramData:t[1].trim(),width:800,height:600}),validate:t=>{const e=[],s=[];return t.attributes.diagramData||e.push("DrawIO diagram data cannot be empty"),{isValid:e.length===0,errors:e,warnings:s}}}]}parseTableRow(t){return t.split("|").slice(1,-1).map(e=>e.trim())}parseOptions(t){const e={};return t.split(",").map(r=>r.trim()).forEach(r=>{const[o,i]=r.split("=").map(u=>u.trim());o&&i&&(e[o]=i)}),e}extractYouTubeId(t){const e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(const s of e){const r=t.match(s);if(r)return r[1]}return""}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}extractTextBlocks(t,e){const s=[];if(I.info("Extracting text blocks from content:",{contentLength:t.length,existingBlocks:e.length}),e.length===0){const i=t.trim();if(I.info("No existing blocks, treating entire content as text:",{trimmedContent:i,length:i.length}),i&&i.length>0){const u={type:"text",content:i,attributes:{content:i},metadata:{startLine:1,endLine:t.split(`
`).length,rawText:i,isValid:!0,errors:[],warnings:[]}};s.push(u),I.info("Created text block:",u)}return s}const r=[...e].sort((i,u)=>i.metadata.startLine-u.metadata.startLine);if(r[0].metadata.startLine>1){const i=t.split(`
`).slice(0,r[0].metadata.startLine-1).join(`
`).trim();i&&i.length>0&&s.push({type:"text",content:i,attributes:{content:i},metadata:{startLine:1,endLine:r[0].metadata.startLine-1,rawText:i,isValid:!0,errors:[],warnings:[]}})}for(let i=0;i<r.length-1;i++){const u=r[i],g=r[i+1];if(g.metadata.startLine>u.metadata.endLine+1){const d=t.split(`
`).slice(u.metadata.endLine,g.metadata.startLine-1).join(`
`).trim();d&&d.length>0&&s.push({type:"text",content:d,attributes:{content:d},metadata:{startLine:u.metadata.endLine+1,endLine:g.metadata.startLine-1,rawText:d,isValid:!0,errors:[],warnings:[]}})}}const o=r[r.length-1];if(o.metadata.endLine<t.split(`
`).length){const i=t.split(`
`).slice(o.metadata.endLine).join(`
`).trim();i&&i.length>0&&s.push({type:"text",content:i,attributes:{content:i},metadata:{startLine:o.metadata.endLine+1,endLine:t.split(`
`).length,rawText:i,isValid:!0,errors:[],warnings:[]}})}return I.info("Extracted text blocks:",s.length,s.map(i=>({type:i.type,contentLength:i.content.length}))),s}parseMarkdown(t){const e=t.split(`
`),s=[],r=[],o=[];try{for(const g of this.blockPatterns){const d=t.matchAll(g.pattern);for(const x of d)try{const L=this.getLineNumber(t,x.index||0),G=this.getLineNumber(t,(x.index||0)+x[0].length),C={type:g.blockType,content:x[0],attributes:g.attributes(x),metadata:{startLine:L,endLine:G,rawText:x[0],isValid:!0,errors:[],warnings:[]}},b=g.validate(C);C.metadata.isValid=b.isValid,C.metadata.errors=b.errors,C.metadata.warnings=b.warnings,s.push(C),r.push(...b.errors),o.push(...b.warnings)}catch(L){I.error(`Error parsing ${g.name} block:`,L),r.push(`Failed to parse ${g.name} block`)}}const i=this.extractTextBlocks(t,s);s.push(...i),s.sort((g,d)=>g.metadata.startLine-d.metadata.startLine);const u=this.removeOverlappingBlocks(s);return{blocks:u,metadata:{totalLines:e.length,validBlocks:u.filter(g=>g.metadata.isValid).length,invalidBlocks:u.filter(g=>!g.metadata.isValid).length,warnings:o,errors:r}}}catch(i){return I.error("Error parsing markdown:",i),{blocks:[],metadata:{totalLines:e.length,validBlocks:0,invalidBlocks:0,warnings:[],errors:["Failed to parse markdown content"]}}}}getLineNumber(t,e){return t.substring(0,e).split(`
`).length}removeOverlappingBlocks(t){const e=t.sort((r,o)=>r.metadata.startLine-o.metadata.startLine),s=[];for(const r of e)s.some(i=>r.metadata.startLine>=i.metadata.startLine&&r.metadata.startLine<=i.metadata.endLine||r.metadata.endLine>=i.metadata.startLine&&r.metadata.endLine<=i.metadata.endLine)||s.push(r);return s}convertTextWithInlineMath(t){const e=t&&typeof t=="string"?t.trim():"";if(I.info("Converting text with inline math:",{original:t,sanitized:e}),!e)return I.info("Empty content, returning empty paragraph"),{type:"paragraph",content:[{type:"text",text:" "}]};const s={type:"paragraph",content:[{type:"text",text:e}]};return I.info("Generated paragraph:",s),s}convertToTiptap(t){return I.info("Converting blocks to Tiptap format:",t.length),t.map(e=>{switch(I.info("Converting block:",e.type,e.attributes),e.type){case"heading":return{type:"heading",attrs:{level:e.attributes.level},content:[{type:"text",text:e.attributes.content}]};case"text":return this.convertTextWithInlineMath(e.attributes.content);case"code":return{type:"executableCodeBlock",attrs:{language:e.attributes.language},content:[{type:"text",text:e.attributes.content}]};case"math":return{type:"math",attrs:{latex:e.attributes.latex}};case"table":return{type:"notaTable",attrs:{tableData:{id:this.generateId(),name:"Markdown Table",columns:e.attributes.headers.map(s=>({id:this.generateId(),title:s,type:"text"})),rows:e.attributes.rows.map(s=>({id:this.generateId(),cells:Object.fromEntries(e.attributes.headers.map((r,o)=>[r,s[o]||""]))}))}}};case"quote":return{type:"blockquote",content:[{type:"paragraph",content:[{type:"text",text:e.attributes.content}]}]};case"list":return{type:e.attributes.listType==="ordered"?"orderedList":"bulletList",content:e.attributes.items.map(s=>({type:"listItem",content:[{type:"paragraph",content:[{type:"text",text:s}]}]}))};case"horizontalRule":return{type:"horizontalRule"};case"link":return{type:"paragraph",content:[{type:"text",text:e.attributes.text,marks:[{type:"link",attrs:{href:e.attributes.url}}]}]};case"image":return{type:"subfigure",attrs:{images:[{src:e.attributes.src,alt:e.attributes.alt,title:e.attributes.title}],layout:"horizontal"}};case"multipleImages":return{type:"subfigure",attrs:{images:e.attributes.images,layout:"horizontal"}};case"executableCodeBlock":return{type:"executableCodeBlock",attrs:{language:e.attributes.language,...e.attributes.options},content:[{type:"text",text:e.attributes.content}]};case"mermaid":return{type:"mermaid",attrs:{content:e.attributes.content,theme:"default"}};case"citation":return{type:"citation",attrs:{citationKey:e.attributes.citationKey,citationData:{}}};case"bibliography":return{type:"bibliography",attrs:{citations:e.attributes.citations}};case"youtube":return{type:"youtube",attrs:{videoId:e.attributes.videoId,title:""}};case"theorem":return{type:"theorem",attrs:{title:e.attributes.title,content:e.attributes.content,theoremType:"theorem",tags:[]}};case"aiGeneration":return{type:"aiGeneration",attrs:{prompt:e.attributes.prompt,model:e.attributes.model,timestamp:e.attributes.timestamp},content:[{type:"text",text:""}]};case"confusionMatrix":return{type:"confusionMatrix",attrs:{matrixData:e.attributes.matrixData,title:e.attributes.title,source:e.attributes.source}};case"pipeline":return{type:"pipeline",attrs:{title:e.attributes.title,description:e.attributes.description,nodes:e.attributes.nodes,edges:e.attributes.edges}};case"drawio":return{type:"drawio",attrs:{diagramData:e.attributes.diagramData,width:e.attributes.width,height:e.attributes.height}};default:return{type:"paragraph",content:[{type:"text",text:e.content}]}}})}validateBlock(t){const e=this.blockPatterns.find(s=>s.blockType===t.type);return e?e.validate(t):{isValid:!1,errors:["Unknown block type"],warnings:[]}}getFixSuggestions(t){const e=[];return t.metadata.errors.length>0&&e.push("Review and fix validation errors before inserting"),t.metadata.warnings.length>0&&e.push("Consider addressing warnings for better content quality"),e}}const me=new ya,ba={class:"block-preview-item"},wa={class:"flex items-start justify-between mb-3"},xa={class:"flex items-center gap-2"},ka={class:"flex items-center gap-2"},_a={class:"text-xs text-muted-foreground"},Sa={class:"flex items-center gap-1"},Ca={class:"mb-3"},$a={class:"bg-muted/30 rounded p-3 text-sm font-mono overflow-x-auto"},Ta={class:"whitespace-pre-wrap break-words"},Ea={key:0,class:"mb-3"},Ba={class:"grid grid-cols-2 gap-2 text-xs"},Ia={class:"font-medium"},Pa={class:"text-muted-foreground truncate ml-2"},Va={class:"space-y-2"},Ma={key:0,class:"space-y-1"},La={class:"flex items-center gap-2 text-sm text-destructive"},Da={class:"list-disc list-inside space-y-1 text-xs text-destructive ml-4"},Aa={key:1,class:"space-y-1"},Na={class:"flex items-center gap-2 text-sm text-yellow-600"},za={class:"list-disc list-inside space-y-1 text-xs text-yellow-600 ml-4"},Ra={key:2,class:"flex items-center gap-2 text-sm text-green-600"},Ga={key:1,class:"flex items-center justify-between mt-3 pt-3 border-t"},Oa={class:"text-xs text-muted-foreground"},Fa=K({__name:"BlockPreviewItem",props:{block:{},index:{},isSelected:{type:Boolean},compact:{type:Boolean}},emits:["toggleSelection","editBlock"],setup(m,{emit:t}){const e=m,s=se(()=>Object.keys(e.block.attributes).length>0),r=()=>e.block.metadata.isValid?e.block.metadata.warnings.length>0?"secondary":"default":"destructive",o=()=>{const u=e.block.content,g=e.compact?100:200;return u.length<=g?u:u.substring(0,g)+"..."},i=u=>u==null?"null":typeof u=="string"?u.length>30?u.substring(0,30)+"...":u:typeof u=="object"?JSON.stringify(u).substring(0,30)+"...":String(u);return(u,g)=>(f(),k("div",ba,[c("div",wa,[c("div",xa,[a(n(Os),{checked:u.isSelected,"onUpdate:checked":g[0]||(g[0]=d=>u.$emit("toggleSelection",u.index)),disabled:!u.block.metadata.isValid},null,8,["checked","disabled"]),c("div",ka,[a(n(Yt),{variant:r(),class:"text-xs"},{default:l(()=>[V(A(u.block.type),1)]),_:1},8,["variant"]),c("span",_a," Lines "+A(u.block.metadata.startLine)+"-"+A(u.block.metadata.endLine),1)])]),c("div",Sa,[u.compact?q("",!0):(f(),O(n(J),{key:0,variant:"ghost",size:"sm",onClick:g[1]||(g[1]=d=>u.$emit("editBlock",u.block)),class:"h-7 w-7 p-0"},{default:l(()=>[a(n(At),{class:"h-3 w-3"})]),_:1})),a(n(J),{variant:"ghost",size:"sm",onClick:g[2]||(g[2]=d=>u.$emit("toggleSelection",u.index)),disabled:!u.block.metadata.isValid,class:"h-7 w-7 p-0"},{default:l(()=>[(f(),O(lt(u.isSelected?n(Ge):n(zn)),{class:"h-3 w-3"}))]),_:1},8,["disabled"])])]),c("div",Ca,[g[4]||(g[4]=c("div",{class:"text-sm font-medium mb-2"},"Content Preview",-1)),c("div",$a,[c("pre",Ta,A(o()),1)])]),!u.compact&&s.value?(f(),k("div",Ea,[g[5]||(g[5]=c("div",{class:"text-sm font-medium mb-2"},"Attributes",-1)),c("div",Ba,[(f(!0),k(Q,null,ee(u.block.attributes,(d,x)=>(f(),k("div",{key:x,class:"flex justify-between p-2 bg-muted/20 rounded"},[c("span",Ia,A(x)+":",1),c("span",Pa,A(i(d)),1)]))),128))])])):q("",!0),c("div",Va,[u.block.metadata.errors.length>0?(f(),k("div",Ma,[c("div",La,[a(n(_t),{class:"h-3 w-3"}),g[6]||(g[6]=c("span",{class:"font-medium"},"Errors:",-1))]),c("ul",Da,[(f(!0),k(Q,null,ee(u.block.metadata.errors,d=>(f(),k("li",{key:d},A(d),1))),128))])])):q("",!0),u.block.metadata.warnings.length>0?(f(),k("div",Aa,[c("div",Na,[a(n(Ze),{class:"h-3 w-3"}),g[7]||(g[7]=c("span",{class:"font-medium"},"Warnings:",-1))]),c("ul",za,[(f(!0),k(Q,null,ee(u.block.metadata.warnings,d=>(f(),k("li",{key:d},A(d),1))),128))])])):q("",!0),u.block.metadata.isValid&&u.block.metadata.errors.length===0&&u.block.metadata.warnings.length===0?(f(),k("div",Ra,[a(n(Ge),{class:"h-3 w-3"}),g[8]||(g[8]=c("span",null,"Block is valid and ready to insert",-1))])):q("",!0)]),u.compact?(f(),k("div",Ga,[a(n(J),{variant:"ghost",size:"sm",onClick:g[3]||(g[3]=d=>u.$emit("editBlock",u.block)),class:"h-6 px-2 text-xs"},{default:l(()=>[a(n(At),{class:"h-3 w-3 mr-1"}),g[9]||(g[9]=V(" Edit "))]),_:1}),c("span",Oa,A(u.block.metadata.errors.length)+" errors, "+A(u.block.metadata.warnings.length)+" warnings ",1)])):q("",!0)]))}}),jt=Me(Fa,[["__scopeId","data-v-4942637e"]]),qa={class:"block-preview-component space-y-6"},ja={class:"flex items-center justify-between"},Ha={class:"flex items-center gap-2"},Ua={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ja={class:"flex items-center gap-2"},Ka={class:"text-2xl font-bold"},Wa={class:"flex items-center gap-2"},Qa={class:"text-2xl font-bold"},Ya={class:"flex items-center gap-2"},Xa={class:"text-2xl font-bold"},Za={class:"flex items-center gap-2"},eo={class:"text-2xl font-bold"},to={key:1,class:"space-y-3"},so={class:"list-disc list-inside space-y-1 mt-2"},no={key:0,class:"text-sm text-muted-foreground"},ao={class:"list-disc list-inside space-y-1 mt-2"},oo={key:0,class:"text-sm text-muted-foreground"},ro={key:2},io={class:"flex items-center justify-between mb-4"},lo={class:"flex items-center gap-2"},uo={class:"text-sm text-muted-foreground"},co={key:0,class:"space-y-3"},po={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},mo=["onClick"],fo={key:3,class:"text-center py-12 text-muted-foreground"},go={key:4,class:"text-center py-12"},vo={key:5,class:"flex items-center justify-between pt-4 border-t"},ho={class:"text-sm text-muted-foreground"},yo={key:0},bo={key:1},wo={class:"flex items-center gap-2"},xo={class:"space-y-4"},ko={class:"flex items-center gap-2 mt-1"},_o={class:"text-sm text-muted-foreground"},So={key:0},Co={class:"list-disc list-inside space-y-1 mt-1 text-sm text-destructive"},$o={key:1},To={class:"list-disc list-inside space-y-1 mt-1 text-sm text-yellow-600"},Eo=K({__name:"BlockPreviewComponent",props:{content:{}},emits:["insertBlocks","cancel"],setup(m,{emit:t}){const e=m,s=t,r=D(!1),o=D(null),i=D([]),u=D("list"),g=D(!1),d=D(null),x=D(""),L=se(()=>{var R;return((R=o.value)==null?void 0:R.blocks.some(_=>_.metadata.isValid))??!1}),G=async()=>{if(!e.content.trim()){o.value=null;return}r.value=!0;try{await be(),o.value=me.parseMarkdown(e.content),i.value=[]}catch(R){console.error("Error refreshing preview:",R)}finally{r.value=!1}},C=()=>{u.value=u.value==="list"?"grid":"list"},b=R=>{const _=i.value.indexOf(R);_>-1?i.value.splice(_,1):i.value.push(R)},S=()=>{o.value&&(i.value=o.value.blocks.map((R,_)=>({block:R,index:_})).filter(({block:R})=>R.metadata.isValid).map(({index:R})=>R))},y=()=>{i.value=[]},p=R=>{d.value=R,x.value=R.content,g.value=!0},T=()=>{d.value=null,x.value="",g.value=!1},H=()=>{if(!d.value||!x.value.trim())return;d.value.content=x.value,d.value.metadata.rawText=x.value;const R=me.parseMarkdown(x.value);if(R.blocks.length>0){const _=R.blocks[0];d.value.type=_.type,d.value.attributes=_.attributes,d.value.metadata.isValid=_.metadata.isValid,d.value.metadata.errors=_.metadata.errors,d.value.metadata.warnings=_.metadata.warnings}T()},W=()=>{if(!o.value||i.value.length===0)return;const R=i.value.map(_=>o.value.blocks[_]).filter(_=>_.metadata.isValid);if(R.length>0){const _=me.convertToTiptap(R);s("insertBlocks",_)}};return ie(()=>e.content,()=>{G()},{immediate:!0}),(R,_)=>(f(),k("div",qa,[c("div",ja,[_[4]||(_[4]=c("div",null,[c("h3",{class:"text-lg font-semibold"},"Block Preview"),c("p",{class:"text-sm text-muted-foreground"}," Review and validate blocks before inserting them into your document ")],-1)),c("div",Ha,[a(n(J),{variant:"outline",size:"sm",onClick:G,disabled:r.value},{default:l(()=>[a(n(Fs),{class:"h-4 w-4 mr-2"}),_[3]||(_[3]=V(" Refresh "))]),_:1},8,["disabled"]),a(n(J),{variant:"outline",size:"sm",onClick:C},{default:l(()=>[(f(),O(lt(u.value==="list"?n(qs):n(Xt)),{class:"h-4 w-4 mr-2"})),V(" "+A(u.value==="list"?"Grid":"List"),1)]),_:1})])]),o.value?(f(),k("div",Ua,[a(n(Be),{class:"p-4"},{default:l(()=>[c("div",Ja,[a(n(et),{class:"h-5 w-5 text-blue-500"}),c("div",null,[c("p",Ka,A(o.value.metadata.totalLines),1),_[5]||(_[5]=c("p",{class:"text-xs text-muted-foreground"},"Total Lines",-1))])])]),_:1}),a(n(Be),{class:"p-4"},{default:l(()=>[c("div",Wa,[a(n(Nn),{class:"h-5 w-5 text-green-500"}),c("div",null,[c("p",Qa,A(o.value.metadata.validBlocks),1),_[6]||(_[6]=c("p",{class:"text-xs text-muted-foreground"},"Valid Blocks",-1))])])]),_:1}),a(n(Be),{class:"p-4"},{default:l(()=>[c("div",Ya,[a(n(Ze),{class:"h-5 w-5 text-yellow-500"}),c("div",null,[c("p",Xa,A(o.value.metadata.invalidBlocks),1),_[7]||(_[7]=c("p",{class:"text-xs text-muted-foreground"},"Invalid Blocks",-1))])])]),_:1}),a(n(Be),{class:"p-4"},{default:l(()=>[c("div",Za,[a(n(Ge),{class:"h-5 w-5 text-blue-500"}),c("div",null,[c("p",eo,A(i.value.length),1),_[8]||(_[8]=c("p",{class:"text-xs text-muted-foreground"},"Selected",-1))])])]),_:1})])):q("",!0),o.value&&(o.value.metadata.errors.length>0||o.value.metadata.warnings.length>0)?(f(),k("div",to,[o.value.metadata.errors.length>0?(f(),O(n(bt),{key:0,variant:"destructive"},{default:l(()=>[a(n(Ze),{class:"h-4 w-4"}),a(n(Nt),null,{default:l(()=>_[9]||(_[9]=[V("Parsing Errors")])),_:1}),a(n(wt),null,{default:l(()=>[c("ul",so,[(f(!0),k(Q,null,ee(o.value.metadata.errors.slice(0,3),j=>(f(),k("li",{key:j,class:"text-sm"},A(j),1))),128)),o.value.metadata.errors.length>3?(f(),k("li",no," ...and "+A(o.value.metadata.errors.length-3)+" more errors ",1)):q("",!0)])]),_:1})]),_:1})):q("",!0),o.value.metadata.warnings.length>0?(f(),O(n(bt),{key:1,variant:"default"},{default:l(()=>[a(n(Ze),{class:"h-4 w-4"}),a(n(Nt),null,{default:l(()=>_[10]||(_[10]=[V("Warnings")])),_:1}),a(n(wt),null,{default:l(()=>[c("ul",ao,[(f(!0),k(Q,null,ee(o.value.metadata.warnings.slice(0,3),j=>(f(),k("li",{key:j,class:"text-sm"},A(j),1))),128)),o.value.metadata.warnings.length>3?(f(),k("li",oo," ...and "+A(o.value.metadata.warnings.length-3)+" more warnings ",1)):q("",!0)])]),_:1})]),_:1})):q("",!0)])):q("",!0),o.value&&o.value.blocks.length>0?(f(),k("div",ro,[c("div",io,[c("div",lo,[a(n(J),{variant:"outline",size:"sm",onClick:S,disabled:!L.value},{default:l(()=>[a(n(Ge),{class:"h-4 w-4 mr-2"}),_[11]||(_[11]=V(" Select All Valid "))]),_:1},8,["disabled"]),a(n(J),{variant:"outline",size:"sm",onClick:y,disabled:i.value.length===0},{default:l(()=>[a(n(_t),{class:"h-4 w-4 mr-2"}),_[12]||(_[12]=V(" Deselect All "))]),_:1},8,["disabled"])]),c("div",uo,A(i.value.length)+" of "+A(o.value.blocks.length)+" blocks selected ",1)]),u.value==="list"?(f(),k("div",co,[(f(!0),k(Q,null,ee(o.value.blocks,(j,X)=>(f(),k("div",{key:`${j.type}-${X}`,class:le(["border rounded-lg p-4 hover:bg-muted/50 transition-colors",{"border-green-200 bg-green-50/50":j.metadata.isValid&&i.value.includes(X),"border-red-200 bg-red-50/50":!j.metadata.isValid,"border-yellow-200 bg-yellow-50/50":j.metadata.isValid&&j.metadata.warnings.length>0}])},[a(jt,{block:j,index:X,"is-selected":i.value.includes(X),onToggleSelection:b,onEditBlock:p},null,8,["block","index","is-selected"])],2))),128))])):(f(),k("div",po,[(f(!0),k(Q,null,ee(o.value.blocks,(j,X)=>(f(),k("div",{key:`${j.type}-${X}`,class:le(["border rounded-lg p-4 hover:bg-muted/50 transition-colors cursor-pointer",{"border-green-200 bg-green-50/50":j.metadata.isValid&&i.value.includes(X),"border-red-200 bg-red-50/50":!j.metadata.isValid,"border-yellow-200 bg-yellow-50/50":j.metadata.isValid&&j.metadata.warnings.length>0}]),onClick:fe=>b(X)},[a(jt,{block:j,index:X,"is-selected":i.value.includes(X),compact:!0,onToggleSelection:b,onEditBlock:p},null,8,["block","index","is-selected"])],10,mo))),128))]))])):r.value?(f(),k("div",go,[a(n(js),{class:"h-12 w-12 mx-auto mb-4 animate-spin text-primary"}),_[15]||(_[15]=c("p",{class:"text-lg font-medium mb-2"},"Processing content...",-1)),_[16]||(_[16]=c("p",{class:"text-sm text-muted-foreground"},"Analyzing markdown and detecting blocks",-1))])):(f(),k("div",fo,[a(n(et),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),_[13]||(_[13]=c("p",{class:"text-lg font-medium mb-2"},"No blocks to preview",-1)),_[14]||(_[14]=c("p",{class:"text-sm"},"Paste or type markdown content to see block previews",-1))])),o.value&&o.value.blocks.length>0?(f(),k("div",vo,[c("div",ho,[i.value.length>0?(f(),k("p",yo," Ready to insert "+A(i.value.length)+" block"+A(i.value.length!==1?"s":""),1)):(f(),k("p",bo,"Select blocks to insert them into your document"))]),c("div",wo,[a(n(J),{variant:"outline",onClick:_[0]||(_[0]=j=>R.$emit("cancel"))},{default:l(()=>_[17]||(_[17]=[V(" Cancel ")])),_:1}),a(n(J),{onClick:W,disabled:i.value.length===0||r.value},{default:l(()=>[a(n(St),{class:"h-4 w-4 mr-2"}),V(" Insert "+A(i.value.length>0?`(${i.value.length})`:""),1)]),_:1},8,["disabled"])])])):q("",!0),a(n(Oe),{modelValue:g.value,"onUpdate:modelValue":_[2]||(_[2]=j=>g.value=j),open:g.value},{default:l(()=>[a(n(rt),{class:"max-w-2xl"},{default:l(()=>{var j,X,fe;return[a(n(Fe),null,{default:l(()=>[a(n(qe),null,{default:l(()=>_[18]||(_[18]=[V("Edit Block")])),_:1}),a(n(ut),null,{default:l(()=>_[19]||(_[19]=[V(" Modify the block content and attributes before insertion ")])),_:1})]),_:1}),c("div",xo,[c("div",null,[a(n(Ie),null,{default:l(()=>_[20]||(_[20]=[V("Block Type")])),_:1}),c("div",ko,[a(n(Yt),{variant:(j=d.value)!=null&&j.metadata.isValid?"default":"destructive"},{default:l(()=>{var $;return[V(A(($=d.value)==null?void 0:$.type),1)]}),_:1},8,["variant"]),c("span",_o," Line "+A((X=d.value)==null?void 0:X.metadata.startLine)+"-"+A((fe=d.value)==null?void 0:fe.metadata.endLine),1)])]),c("div",null,[a(n(Ie),null,{default:l(()=>_[21]||(_[21]=[V("Content")])),_:1}),a(n(Zt),{modelValue:x.value,"onUpdate:modelValue":_[1]||(_[1]=$=>x.value=$),rows:8,class:"mt-1 font-mono text-sm",placeholder:"Edit block content..."},null,8,["modelValue"])]),d.value&&d.value.metadata.errors&&d.value.metadata.errors.length>0?(f(),k("div",So,[a(n(Ie),{class:"text-destructive"},{default:l(()=>_[22]||(_[22]=[V("Errors")])),_:1}),c("ul",Co,[(f(!0),k(Q,null,ee(d.value.metadata.errors,$=>(f(),k("li",{key:$},A($),1))),128))])])):q("",!0),d.value&&d.value.metadata.warnings&&d.value.metadata.warnings.length>0?(f(),k("div",$o,[a(n(Ie),{class:"text-yellow-600"},{default:l(()=>_[23]||(_[23]=[V("Warnings")])),_:1}),c("ul",To,[(f(!0),k(Q,null,ee(d.value.metadata.warnings,$=>(f(),k("li",{key:$},A($),1))),128))])])):q("",!0)]),a(n(Ct),null,{default:l(()=>[a(n(J),{variant:"outline",onClick:T},{default:l(()=>_[24]||(_[24]=[V("Cancel")])),_:1}),a(n(J),{onClick:H,disabled:!x.value.trim()},{default:l(()=>_[25]||(_[25]=[V("Save Changes")])),_:1},8,["disabled"])]),_:1})]}),_:1})]),_:1},8,["modelValue","open"])]))}}),Bo=Me(Eo,[["__scopeId","data-v-0943d0e1"]]),Io={class:"markdown-input-component"},Po={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Vo={class:"space-y-4"},Mo={class:"flex items-center justify-between"},Lo={class:"flex items-center gap-2"},Do={class:"text-sm text-muted-foreground"},Ao={class:"space-y-2"},No={class:"grid grid-cols-2 gap-2"},zo={class:"space-y-4"},Ro=K({__name:"MarkdownInputComponent",props:{modelValue:{type:Boolean}},emits:["update:modelValue","insertBlocks"],setup(m,{emit:t}){const e=m,s=t,r=se({get:()=>e.modelValue,set:S=>s("update:modelValue",S)}),o=D(""),i=D(!1),u=se(()=>{if(!o.value.trim())return!1;try{return me.parseMarkdown(o.value).blocks.some(y=>y.metadata.isValid)}catch{return!1}}),g=[{name:"Heading",icon:Us,template:`# Heading

Content goes here...`},{name:"Code Block",icon:Js,template:'```python\n# Your code here\nprint("Hello, World!")\n```'},{name:"Table",icon:Ks,template:`| Header 1 | Header 2 | Header 3 |
|----------|----------|----------|
| Data 1   | Data 2   | Data 3   |
| Data 4   | Data 5   | Data 6   |`},{name:"Image",icon:Ws,template:'![Alt text](image-url "Optional title")'},{name:"Link",icon:es,template:"[Link text](https://example.com)"},{name:"List",icon:Xt,template:`- Item 1
- Item 2
  - Nested item
- Item 3`},{name:"Quote",icon:Qs,template:`> This is a blockquote
> It can span multiple lines`},{name:"Math",icon:Ys,template:`$$
E = mc^2
$$`},{name:"Executable Code",icon:Xs,template:"```{python,output=true}\nimport pandas as pd\ndf = pd.DataFrame({'A': [1, 2, 3]})\nprint(df)\n```"}],d=()=>{o.value=""},x=()=>{o.value=`# Sample Document

This is a sample markdown document demonstrating various block types.

## Code Example

Here's a Python code block:

\`\`\`python
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(fibonacci(10))
\`\`\`

## Mathematical Expression

Inline math: $E = mc^2$

Display math:
$$
\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}
$$

## Table

| Feature | Status | Notes |
|---------|--------|-------|
| Headings | ✅ | All levels supported |
| Code | ✅ | Syntax highlighting |
| Math | ✅ | KaTeX rendering |
| Tables | ✅ | Responsive design |

## List

- **Unordered list**
  - Nested item
  - Another nested item
- **Ordered list**
  1. First item
  2. Second item

## Blockquote

> This is a blockquote that demonstrates how quoted text appears.
> It can span multiple lines and provides visual distinction.

## Executable Code

\`\`\`{python,output=true}
import matplotlib.pyplot as plt
import numpy as np

x = np.linspace(0, 10, 100)
y = np.sin(x)

plt.plot(x, y)
plt.title('Sine Wave')
plt.show()
\`\`\`

## Image

![Sample Image](https://via.placeholder.com/400x200 "Placeholder Image")

## Link

Visit [our documentation](https://example.com/docs) for more information.

---

*This document showcases the rich markdown capabilities available.*`},L=S=>{var H;const y=((H=document.getElementById("markdown-input"))==null?void 0:H.selectionStart)||0,p=o.value.substring(0,y),T=o.value.substring(y);o.value=p+`

`+S.template+`

`+T,be(()=>{const W=document.getElementById("markdown-input");if(W){W.focus();const R=p.length+2+S.template.length+2;W.setSelectionRange(R,R)}})},G=S=>{s("insertBlocks",S),b()},C=async()=>{if(o.value.trim()){i.value=!0;try{const y=me.parseMarkdown(o.value).blocks.filter(p=>p.metadata.isValid);if(y.length>0){const p=me.convertToTiptap(y);s("insertBlocks",p),b()}}catch(S){console.error("Error processing markdown:",S)}finally{i.value=!1}}},b=()=>{r.value=!1,o.value=""};return ie(r,S=>{S&&!o.value.trim()&&x()}),(S,y)=>(f(),k("div",Io,[a(n(Oe),{modelValue:r.value,"onUpdate:modelValue":y[1]||(y[1]=p=>r.value=p),open:r.value},{default:l(()=>[a(n(Hs),{class:"max-w-6xl"},{default:l(()=>[a(n(Fe),null,{default:l(()=>[a(n(qe),null,{default:l(()=>y[2]||(y[2]=[V("Insert Markdown Content")])),_:1}),a(n(ut),null,{default:l(()=>y[3]||(y[3]=[V(" Paste or type markdown content. Preview and validate blocks before inserting them into your document. ")])),_:1})]),_:1}),c("div",Po,[c("div",Vo,[c("div",null,[a(n(Ie),{for:"markdown-input"},{default:l(()=>y[4]||(y[4]=[V("Markdown Content")])),_:1}),a(n(Zt),{id:"markdown-input",modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=p=>o.value=p),rows:15,class:"font-mono text-sm resize-none",placeholder:`Paste or type your markdown content here...

# Example Heading

This is a paragraph with **bold** and *italic* text.

\`\`\`python
def hello_world():
    print('Hello, World!')
\`\`\`

$$E = mc^2$$

| Column 1 | Column 2 |
|----------|----------|
| Data 1   | Data 2   |

> This is a blockquote

- List item 1
- List item 2
  - Nested item

\`\`\`{python,output=true}
import pandas as pd
df = pd.DataFrame({'A': [1, 2, 3]})
print(df)
\`\`\``},null,8,["modelValue"])]),c("div",Mo,[c("div",Lo,[a(n(J),{variant:"outline",size:"sm",onClick:d,disabled:!o.value.trim()},{default:l(()=>[a(n(it),{class:"h-4 w-4 mr-2"}),y[5]||(y[5]=V(" Clear "))]),_:1},8,["disabled"]),a(n(J),{variant:"outline",size:"sm",onClick:x},{default:l(()=>[a(n(et),{class:"h-4 w-4 mr-2"}),y[6]||(y[6]=V(" Load Example "))]),_:1})]),c("div",Do,A(o.value.length)+" characters ",1)]),c("div",Ao,[a(n(Ie),{class:"text-sm font-medium"},{default:l(()=>y[7]||(y[7]=[V("Quick Actions")])),_:1}),c("div",No,[(f(),k(Q,null,ee(g,p=>a(n(J),{key:p.name,variant:"outline",size:"sm",onClick:T=>L(p),class:"justify-start text-xs"},{default:l(()=>[(f(),O(lt(p.icon),{class:"h-3 w-3 mr-2"})),V(" "+A(p.name),1)]),_:2},1032,["onClick"])),64))])])]),c("div",zo,[a(Bo,{content:o.value,onInsertBlocks:G,onCancel:b},null,8,["content"])])]),a(n(Ct),{class:"gap-2"},{default:l(()=>[a(n(J),{variant:"outline",onClick:b},{default:l(()=>y[8]||(y[8]=[V(" Cancel ")])),_:1}),a(n(J),{onClick:C,disabled:!u.value||i.value},{default:l(()=>[a(n(St),{class:"h-4 w-4 mr-2"}),y[9]||(y[9]=V(" Insert All Valid Blocks "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","open"])]))}}),Go=Me(Ro,[["__scopeId","data-v-b0f1446f"]]);class Ht{static async handlePaste(t){try{const e=me.parseMarkdown(t);if(e.blocks.length===0)return{success:!1,blocks:[],metadata:{totalBlocks:0,validBlocks:0,invalidBlocks:0,errors:["No valid blocks found in the pasted content"],warnings:[]},message:"No valid markdown blocks detected. The content may not be in markdown format."};const s=e.blocks.filter(u=>u.metadata.isValid),r=e.blocks.filter(u=>!u.metadata.isValid),o=me.convertToTiptap(s),i={success:s.length>0,blocks:o,metadata:{totalBlocks:e.blocks.length,validBlocks:s.length,invalidBlocks:r.length,errors:e.metadata.errors,warnings:e.metadata.warnings},message:this.generateMessage(s.length,r.length,e.metadata.errors,e.metadata.warnings)};return I.info("Enhanced markdown paste result:",i),i}catch(e){return I.error("Error in enhanced markdown paste handler:",e),{success:!1,blocks:[],metadata:{totalBlocks:0,validBlocks:0,invalidBlocks:0,errors:["Failed to parse markdown content"],warnings:[]},message:"An error occurred while parsing the markdown content. Please check the format and try again."}}}static isMarkdownContent(t){return!t||t.trim().length===0?!1:[/^#{1,6}\s+.+/m,/\*\*[^*]+\*\*|\*[^*]+\*/,/```[\s\S]*?```/,/`[^`]+`/,/\[[^\]]+\]\([^)]+\)/,/!\[[^\]]*\]\([^)]+\)/,/^[\s]*[-*+]\s+.+|^[\s]*\d+\.\s+.+/m,/^>\s+.+/m,/^\|.*\|$/m,/\$[^$\n]+\$|\$\$[\s\S]*?\$\$/,/^[\s]*[-*_]{3,}[\s]*$/m,/```\{[^}]+\}[\s\S]*?```/,/```mermaid[\s\S]*?```/,/@[a-zA-Z0-9_-]+/].some(s=>s.test(t))}static getQuickPreview(t){try{const e=me.parseMarkdown(t);return{blockTypes:[...new Set(e.blocks.map(r=>r.type))],totalBlocks:e.blocks.length}}catch{return{blockTypes:[],totalBlocks:0}}}static validateBlockTypes(t,e){try{const s=me.parseMarkdown(t),o=[...new Set(s.blocks.map(i=>i.type))].filter(i=>!e.includes(i));return{isValid:o.length===0,invalidTypes:o}}catch{return{isValid:!1,invalidTypes:[]}}}static generateMessage(t,e,s,r){if(t===0)return"No valid blocks could be parsed from the content.";let o=`Successfully parsed ${t} block${t!==1?"s":""}`;return e>0&&(o+=` (${e} invalid block${e!==1?"s":""} skipped)`),r.length>0&&(o+=`. ${r.length} warning${r.length!==1?"s":""} found.`),s.length>0&&(o+=`. ${s.length} error${s.length!==1?"s":""} encountered.`),o}static getImprovementSuggestions(t){const e=[];try{const s=me.parseMarkdown(t);s.metadata.errors.length>0&&e.push("Fix validation errors before inserting blocks"),s.metadata.warnings.length>0&&e.push("Address warnings for better content quality");const r=s.blocks.map(o=>o.type);r.includes("image")&&!r.includes("image")&&e.push("Consider adding alt text to images for accessibility"),r.includes("table")&&s.blocks.some(o=>{var i;return o.type==="table"&&((i=o.attributes.rows)==null?void 0:i.length)===0})&&e.push("Tables should have data rows for better readability"),r.includes("code")&&!r.includes("code")&&e.push("Specify language for code blocks to enable syntax highlighting")}catch{e.push("Check markdown syntax and formatting")}return e}static cleanMarkdownContent(t){return t.replace(/\n\s*\n\s*\n/g,`

`).replace(/\r\n/g,`
`).replace(/[ \t]+$/gm,"").replace(/(\n#{1,6}\s+)/g,`
$1`).replace(/(\n```)/g,`
$1`).replace(/(```\n)/g,`$1
`).trim()}}const Oo={class:"h-full w-full flex overflow-hidden"},Fo={class:"flex-1 flex flex-col min-w-0 h-full overflow-hidden"},qo={class:"flex-1 min-h-0 relative overflow-auto"},jo={class:"h-full overflow-hidden px-4 md:px-8 lg:px-12"},Ho={class:"max-w-4xl mx-auto py-8"},Uo={class:"nota-title-field mb-6"},Jo={class:"flex items-center justify-between"},Ko={class:"flex items-center gap-4 mt-2"},Wo={key:0,class:"flex items-center gap-1"},Qo={key:1,class:"flex items-center gap-1"},Yo=K({__name:"NotaEditor",props:{notaId:{},extensions:{}},emits:["saving"],setup(m,{expose:t,emit:e}){const s=m,r=e,o=we(),i=dt(),u=ts(),g=Zs(),d=kt(),x=D(!0),L=D(!1),G=D(!1),{syncContentToBlocks:C,initializeBlocks:b,getTiptapContent:S,isInitialized:y}=en(s.notaId);D(!1);const p=D([]),T=D(!1),H=D(""),W=D(""),R=v=>JSON.stringify(v,(h,E)=>{if(!(h==="marks"||h==="selection"))return E}),_=v=>{if(T.value)return;if(p.value.length>=50){I.warn("Edit queue limit reached, processing queue immediately"),X();return}const h={...v,id:`edit-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),applied:!1};p.value.push(h),T.value||be(()=>{T.value||X()})},j=(v,h)=>{if(!v.docChanged||T.value)return;const{steps:E}=v;for(const w of E)w.from!==void 0&&w.to!==void 0&&(w.slice&&w.slice.content&&w.slice.content.size>0?_({type:"update",position:w.from,content:h.getJSON()}):w.from!==w.to&&_({type:"delete",position:w.from,content:h.getJSON()}))},X=async()=>{var v;if(!(T.value||p.value.length===0)){T.value=!0;try{const h=(v=P.value)==null?void 0:v.getJSON();if(!h)return;const E=Date.now();p.value=p.value.filter(w=>E-w.timestamp<5*60*1e3&&!w.applied);for(const w of p.value)w.applied||(await fe(w,h),w.applied=!0);p.value=p.value.filter(w=>w.applied),H.value=JSON.stringify(h)}catch(h){I.error("Error processing edit queue:",h)}finally{T.value=!1}}},fe=async(v,h)=>{try{await C(h),await u.saveSessions(s.notaId),I.info(`Applied edit ${v.id} to database`)}catch(E){throw I.error(`Error applying edit ${v.id}:`,E),E}},$=Rt(async()=>{if(P.value)try{r("saving",!0),await X()}catch(v){I.error("Error in debounced save:",v)}finally{r("saving",!1)}},2e3),M=Rt(async()=>{if(!P.value||!P.value.isFocused)return;const v=P.value.getJSON(),h=R(v);h!==W.value&&(W.value=h,$())},3e3),z=se(()=>o.getCurrentNota(s.notaId)),te=se(()=>{if(!z.value)return null;const v=S.value;return v||{type:"doc",content:[]}}),re=v=>{try{const{attrs:h,content:E}=v,w=E?E.map(pe=>pe.text).join(`
`):"",B=i.jupyterServers,Y=h.serverID?zt(h.serverID).split(":"):null,ae=Y?B.find(pe=>zt(pe.ip)===Y[0]&&pe.port===Y[1]):void 0;u.addCell({id:h.id,code:w,serverConfig:ae,kernelName:h.kernelName,output:h.output,sessionId:h.sessionId}),I.info(`Registered code cell: ${h.id}`)}catch(h){I.error("Error registering code cell:",h)}},ne=v=>{const h=[],E=w=>{w.type==="executableCodeBlock"&&h.push(w),w.content&&w.content.forEach(B=>{E(B)})};return E(v),h},ge=(v,h)=>{ne(v).forEach(re)},F=v=>{if(!P.value)return;const h=P.value.getJSON(),E=B=>{var Y;if(((Y=B.attrs)==null?void 0:Y.id)===v)return B;if(B.content)for(const ae of B.content){const pe=E(ae);if(pe)return pe}return null},w=E(h);w&&w.type==="executableCodeBlock"&&re(w)},U=tn({fontSize:16,lineHeight:1.6,spellCheck:!0,tabSize:2,indentWithTabs:!1,wordWrap:!0,dragHandleWidth:24,autoSave:!0}),he=sn(),P=nn({content:null,extensions:he,editorProps:{attributes:{class:"prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none"},handlePaste:(v,h)=>{var w;const E=(w=h.clipboardData)==null?void 0:w.getData("text/plain");if(!E)return!1;if(Ht.isMarkdownContent(E)){const B=P.value;if(B)return h.preventDefault(),Ht.handlePaste(E).then(Y=>{Y.success&&Y.blocks.length>0?setTimeout(()=>{v.state.selection.from!==v.state.selection.to&&B.commands.deleteSelection(),B.commands.insertContent(Y.blocks),N.success(Y.message)},0):(N.error(Y.message),confirm("Would you like to open the markdown input dialog to fix the issues?")&&(G.value=!0))}).catch(Y=>{I.error("Error in enhanced paste handling:",Y),setTimeout(()=>{v.state.selection.from!==v.state.selection.to&&B.commands.deleteSelection(),B.commands.insertContent(E,{parseOptions:{preserveWhitespace:"full"}})},0)}),!0}return!1}},onCreate({editor:v}){u.loadSavedSessions(s.notaId);const h=v.getJSON();H.value=JSON.stringify(h),W.value=R(h),Pt(),v.view.dom.addEventListener("click",E=>{const w=E.target,B=w.tagName==="A"?w:w.closest("a");if(B){E.preventDefault();const ae=B.getAttribute("href");ae!=null&&ae.startsWith("/nota/")&&d.push(ae);return}const Y=w.closest('[data-type="executableCodeBlock"]');if(Y){const ae=Y.getAttribute("data-block-id");if(ae){const pe=v.getJSON(),Vt=Ue=>{var Mt;if(((Mt=Ue.attrs)==null?void 0:Mt.id)===ae)return Ue;if(Ue.content)for(const Ts of Ue.content){const Lt=Vt(Ts);if(Lt)return Lt}return null},ft=Vt(pe);ft&&ft.type==="executableCodeBlock"&&re(ft)}}})},onUpdate:({editor:v,transaction:h})=>{if(h.docChanged&&v.isFocused&&!T.value){j(h,v);const E=v.getJSON(),w=R(E);w!==W.value&&(W.value=w,M())}},onBlur:({editor:v})=>{p.value.length>0&&$()}}),xe=se(()=>y.value);ie([()=>s.notaId],([v])=>{P.value},{immediate:!0}),ie(()=>te.value,()=>{try{It()}catch(v){I.error("Error in content change watcher:",v)}}),ie(xe,v=>{try{if(v&&P.value){const h=S.value;if(h){const E=P.value.getJSON();E&&E.content&&E.content.length>0&&E.content.some(B=>B.type!=="doc"&&(B.content&&B.content.length>0||B.text))?I.info("Editor already has content, skipping load:",E):(P.value.commands.setContent(h),W.value=R(h),H.value=JSON.stringify(h),I.info("Initial editor content loaded from blocks (page refresh):",h))}else I.warn("No block content available when block system is ready")}}catch(h){I.error("Error in block system ready watcher:",h)}}),ie(()=>S.value,(v,h)=>{try{if(v&&P.value&&!h){const E=P.value.getJSON();E&&E.content&&E.content.length>0||(P.value.commands.setContent(v),W.value=R(v),H.value=JSON.stringify(v),I.info("Content loaded from database on page refresh:",v))}}catch(E){I.error("Error in page refresh content watcher:",E)}},{immediate:!0}),ie(()=>S.value,v=>{try{if(v&&P.value&&!(!z.value||!y.value||!P.value)){const E=P.value.getJSON();E&&E.content&&E.content.length>0||(P.value.commands.setContent(v),W.value=R(v),H.value=JSON.stringify(v),I.info("Initial editor content loaded from content watcher (page refresh):",v))}}catch(h){I.error("Error in content watcher:",h)}}),se(()=>P.value?P.value.getText().split(/\s+/).filter(h=>h.length>0).length:0);function Le(v=U){if(!P.value)return;P.value.setOptions({editorProps:{attributes:{class:`prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none editor-font-size-${v.fontSize}`,spellcheck:v.spellCheck.toString()}}});const h=document.querySelector(".ProseMirror");if(h){const E={"--editor-font-size":`${v.fontSize}px`,"--editor-line-height":v.lineHeight.toString(),"--editor-tab-size":v.tabSize.toString(),"--drag-handle-width":`${v.dragHandleWidth}px`,"--word-wrap":v.wordWrap?"break-word":"normal"};Object.entries(E).forEach(([w,B])=>{h.style.setProperty(w,B)})}x.value=v.autoSave}const De=D(!1),Tt=D(!1),de=D(),ce=D(""),ke=D(""),He=D(!1),Et=v=>{if(!P.value||v.target instanceof HTMLElement&&v.target.closest(".cm-editor")!==null||!(v.ctrlKey&&v.shiftKey&&v.altKey))return;v.preventDefault();const h={c:()=>P.value.chain().focus().insertContent({type:"executableCodeBlock",attrs:{language:"python"}}).run(),t:()=>P.value.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),m:()=>P.value.chain().focus().insertContent({type:"mathBlock",attrs:{latex:""}}).run(),y:()=>P.value.chain().focus().setYoutube("https://www.youtube.com/watch?v=dQw4w9WgXcQ").run(),f:()=>P.value.chain().focus().setSubfigure().run(),h:()=>P.value.chain().focus().setHorizontalRule().run(),q:()=>P.value.chain().focus().toggleBlockquote().run(),k:()=>P.value.chain().focus().toggleTaskList().run(),g:()=>P.value.chain().focus().insertDrawIo().run(),b:()=>{var w;(w=z.value)!=null&&w.id&&P.value.chain().focus().insertNotaTable(z.value.id).run()},x:()=>{P.value&&P.value.chain().focus().command(({tr:w,dispatch:B})=>{if(B){const Y=P.value.schema.nodes.paragraph.create(null,P.value.schema.text("New text block"));w.insert(w.doc.content.size,Y)}return!0}).run()}},E=v.key.toLowerCase();h[E]&&h[E]()};Ce(async()=>{await b(),be(()=>{if(de.value&&z.value){const h=z.value.title||"";de.value.textContent=h,ke.value=h,ce.value=h}}),document.addEventListener("keydown",Et),window.addEventListener("activate-ai-assistant",h=>{h.detail}),window.addEventListener("open-jupyter-sidebar",()=>{}),document.addEventListener("open-markdown-input",h=>{G.value=!0});const v=localStorage.getItem("editor-settings");if(v)try{const h=JSON.parse(v);Object.entries({fontSize:w=>w&&w[0]?w[0]:void 0,lineHeight:w=>w&&w[0]?w[0]:void 0,spellCheck:w=>w!==void 0?w:void 0,tabSize:w=>w&&w[0]?w[0]:void 0,indentWithTabs:w=>w!==void 0?w:void 0,wordWrap:w=>w!==void 0?w:void 0,dragHandleWidth:w=>w&&w[0]?w[0]:void 0,autoSave:w=>w!==void 0?w:void 0}).forEach(([w,B])=>{const Y=B(h[w]);Y!==void 0&&(U[w]=Y)}),Le()}catch(h){I.error("Failed to parse saved editor settings",h)}window.addEventListener("editor-settings-changed",h=>{if(h.detail){const E={fontSize:B=>B&&B[0]?B[0]:void 0,lineHeight:B=>B&&B[0]?B[0]:void 0,spellCheck:B=>B!==void 0?B:void 0,tabSize:B=>B&&B[0]?B[0]:void 0,indentWithTabs:B=>B!==void 0?B:void 0,wordWrap:B=>B!==void 0?B:void 0,dragHandleWidth:B=>B&&B[0]?B[0]:void 0,autoSave:B=>B!==void 0?B:void 0};let w=!1;Object.entries(E).forEach(([B,Y])=>{const ae=Y(h.detail[B]);ae!==void 0&&(U[B]=ae,w=!0)}),w&&Le()}})}),tt(()=>{document.removeEventListener("keydown",Et),window.removeEventListener("activate-ai-assistant",()=>{}),window.removeEventListener("open-jupyter-sidebar",()=>{}),document.removeEventListener("open-markdown-input",()=>{}),u.cleanup()});const vs=async()=>{if(!(!P.value||!z.value))try{N.message("Starting export... (this may take a moment for large trees)");const v=P.value.getJSON();await cn({title:z.value.title||"Untitled",content:v,citations:g.getCitationsByNotaId(s.notaId),rootNotaId:z.value.id,fetchNota:async h=>{var B;if(h===((B=z.value)==null?void 0:B.id))return{title:z.value.title,content:v,citations:z.value.citations};let E=o.getItem(h);if(E||(E=await o.loadNota(h)),!E)return null;const w=await o.getNotaContentAsTiptap(h);return{title:E.title,content:w,citations:E.citations}}}),N.success("Export completed successfully")}catch(v){I.error("Export failed",v),N.error("Export failed")}},mt=D(!1),hs=async()=>{if(!(mt.value||!P.value||!z.value)){mt.value=!0;try{const v=P.value.getJSON(),h={...z.value};await o.saveNotaVersion({id:s.notaId,nota:h,versionName:`Version ${new Date().toLocaleString()}`,createdAt:new Date}),N("Version saved successfully")}catch(v){I.error("Error saving version:",v),N("Failed to save version")}finally{mt.value=!1}}},ys=async()=>{if(P.value){const v=S.value;v&&P.value.commands.setContent(v)}},Bt=(v,h)=>{P.value&&(P.value.chain().focus().setLink({href:`/nota/${v}`,target:"_self"}).insertContent(h).run(),$())},bs=async v=>{if(P.value)try{const h=await o.createItem(v,s.notaId);return Bt(h.id,h.title),h}catch(h){I.error("Error creating sub-nota:",h),N("Failed to create sub-nota")}},{counters:Ae,reset:It}=an();Gt(pn,{counters:Ae,getNumber:v=>{if(!Ae.has(v)){const h=Ae.size+1;Ae.set(v,h)}return Ae.get(v)||0},reset:It});const ws=D(!0);Gt("renderMath",ws);const Pt=()=>{if(!P.value)return;const v=g.getCitationsByNotaId(s.notaId),h=new Map;v.forEach((E,w)=>{h.set(E.key,w+1)}),P.value.state.doc.descendants((E,w)=>{var B;if(E.type.name==="citation"){const Y=E.attrs.citationKey,ae=h.get(Y);ae!==void 0&&ae!==E.attrs.citationNumber&&((B=P.value)==null||B.commands.command(({tr:pe})=>(pe.setNodeMarkup(w,void 0,{...E.attrs,citationNumber:ae}),!0)))}return!0})};ie(()=>g.getCitationsByNotaId(s.notaId),()=>{Pt()},{deep:!0}),ie(z,v=>{if(v&&de.value){const h=v.title||"";de.value.textContent=h,ke.value=h,ce.value=h}});const xs=v=>{const h=v.target;ke.value=h.textContent||""},ks=()=>{ce.value=ke.value},_s=async()=>{if(He.value)return;const v=ke.value.trim();if(v===ce.value||v===""){v===""&&de.value&&(de.value.textContent=ce.value,ke.value=ce.value);return}await Cs(v)},Ss=v=>{var h;v.key==="Enter"?(v.preventDefault(),(h=P.value)==null||h.commands.focus()):v.key==="Escape"&&(v.preventDefault(),de.value&&(de.value.textContent=ce.value,ke.value=ce.value))},Cs=async v=>{if(!He.value)try{He.value=!0,await o.updateNotaTitle(s.notaId,v),ce.value=v,N.success("Title updated")}catch(h){console.error("Error saving title:",h),N.error("Failed to update title"),de.value&&(de.value.textContent=ce.value,ke.value=ce.value)}finally{He.value=!1}},$s=v=>{if(!(!P.value||v.length===0))try{P.value.commands.insertContent(v),N.success(`Successfully inserted ${v.length} block${v.length!==1?"s":""}`),G.value=!1,$()}catch(h){I.error("Error inserting markdown blocks:",h),N.error("Failed to insert blocks. Please try again.")}};return t({editor:P,insertSubNotaLink:Bt,createAndLinkSubNota:bs,saveVersion:hs,showVersionHistory:L,showMarkdownInput:G,registerCodeCell:re,registerCodeCellsOnDemand:ge,findCodeBlocks:ne,registerCodeCellForExecution:F,processEditQueue:X,queueEdit:_,syncContent:()=>{if(P.value){const v=P.value.getJSON();C(v)}},forceLoadContent:()=>{if(P.value){const v=S.value;return v?(P.value.commands.setContent(v),W.value=R(v),H.value=JSON.stringify(v),I.info("Content force-loaded from database:",v),!0):!1}return!1}}),(v,h)=>{const E=on("Button");return f(),k("div",Oo,[c("div",Fo,[c("div",qo,[c("div",jo,[a(n(rn),{class:"h-full"},{default:l(()=>[c("div",Ho,[z.value?(f(),O(ha,{key:0,"nota-id":z.value.id,class:"mb-4"},null,8,["nota-id"])):q("",!0),c("div",Uo,[c("div",Jo,[c("div",{ref_key:"titleInput",ref:de,class:"nota-title-input flex-1",contenteditable:"true",placeholder:"Untitled",onInput:xs,onBlur:_s,onKeydown:Ss,onFocus:ks},null,544),a(E,{variant:"ghost",size:"sm",onClick:h[0]||(h[0]=w=>L.value=!0),class:"ml-4 h-8 px-2 text-xs"},{default:l(()=>[a(n(ln),{class:"h-3 w-3 mr-1"}),h[4]||(h[4]=V(" History "))]),_:1}),a(E,{variant:"ghost",size:"sm",onClick:vs,class:"ml-2 h-8 px-2 text-xs",title:"Export to HTML"},{default:l(()=>[a(n(un),{class:"h-3 w-3 mr-1"}),h[5]||(h[5]=V(" Export "))]),_:1})])]),a(n(dn),{editor:n(P)},null,8,["editor"]),c("div",Ko,[z.value?(f(),O(n(ss),{key:0,modelValue:z.value.tags,"onUpdate:modelValue":h[1]||(h[1]=w=>z.value.tags=w),class:"w-full border-none"},null,8,["modelValue"])):q("",!0),c("div",{class:le(["flex items-center text-xs text-muted-foreground transition-opacity duration-200",{"opacity-0":!De.value&&!Tt.value}])},[De.value?(f(),k("span",Wo,[a(n(ns),{class:"w-3 h-3 animate-spin"}),h[6]||(h[6]=V(" Saving "))])):Tt.value?(f(),k("span",Qo,[a(n(Ge),{class:"w-3 h-3 text-green-600"}),h[7]||(h[7]=V(" Saved "))])):q("",!0)],2)])])]),_:1})])])]),a(ca,{"nota-id":v.notaId,open:L.value,"onUpdate:open":h[2]||(h[2]=w=>L.value=w),onVersionRestored:ys},null,8,["nota-id","open"]),a(Go,{modelValue:G.value,"onUpdate:modelValue":h[3]||(h[3]=w=>G.value=w),onInsertBlocks:$s},null,8,["modelValue"])])}}}),Xo=K({__name:"ContextMenu",props:{dir:{},modal:{type:Boolean}},emits:["update:open"],setup(m,{emit:t}){const r=ot(m,t);return(o,i)=>(f(),O(n(Hn),$e(Te(n(r))),{default:l(()=>[ue(o.$slots,"default")]),_:3},16))}}),Zo=K({__name:"ContextMenuContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},sideFlip:{type:Boolean},alignOffset:{},alignFlip:{type:Boolean},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},sticky:{},hideWhenDetached:{type:Boolean},positionStrategy:{},disableUpdateOnLayoutShift:{type:Boolean},prioritizePosition:{type:Boolean},reference:{},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(m,{emit:t}){const e=m,s=t,r=ct(e,"class"),o=ot(r,s);return(i,u)=>(f(),O(n(Zn),null,{default:l(()=>[a(n(Jn),ve(n(o),{class:n(je)("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e.class)}),{default:l(()=>[ue(i.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),Ne=K({__name:"ContextMenuItem",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{},inset:{type:Boolean}},emits:["select"],setup(m,{emit:t}){const e=m,s=t,r=ct(e,"class"),o=ot(r,s);return(i,u)=>(f(),O(n(Wn),ve(n(o),{class:n(je)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i.inset&&"pl-8",e.class)}),{default:l(()=>[ue(i.$slots,"default")]),_:3},16,["class"]))}}),Ut=K({__name:"ContextMenuLabel",props:{asChild:{type:Boolean},as:{},class:{},inset:{type:Boolean}},setup(m){const t=m,e=ct(t,"class");return(s,r)=>(f(),O(n(Yn),ve(n(e),{class:n(je)("px-2 py-1.5 text-sm font-semibold text-foreground",s.inset&&"pl-8",t.class)}),{default:l(()=>[ue(s.$slots,"default")]),_:3},16,["class"]))}}),vt=K({__name:"ContextMenuSeparator",props:{asChild:{type:Boolean},as:{},class:{}},setup(m){const t=m,e=ct(t,"class");return(s,r)=>(f(),O(n(ta),ve(n(e),{class:n(je)("-mx-1 my-1 h-px bg-border",t.class)}),null,16,["class"]))}}),ht=K({__name:"ContextMenuShortcut",props:{class:{}},setup(m){const t=m;return(e,s)=>(f(),k("span",{class:le(n(je)("ml-auto text-xs tracking-widest text-muted-foreground",t.class))},[ue(e.$slots,"default")],2))}}),er=K({__name:"ContextMenuTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{}},setup(m){const e=mn(m);return(s,r)=>(f(),O(n(na),$e(Te(n(e))),{default:l(()=>[ue(s.$slots,"default")]),_:3},16))}}),tr={class:"space-y-4 py-4"},sr={class:"space-y-2"},nr={class:"space-y-2"},ar=K({__name:"AddToFavoritesModal",props:{open:{type:Boolean}},emits:["update:open","submit"],setup(m,{emit:t}){const e=m,s=t,r=D(""),o=D([]),i=g=>{const d=g.target;r.value=d.value},u=()=>{r.value.trim()&&(s("submit",r.value.trim(),o.value),r.value="",o.value=[],s("update:open",!1))};return ie(()=>e.open,g=>{g&&(r.value="",o.value=[])}),(g,d)=>(f(),O(n(Oe),{open:g.open,"onUpdate:open":d[1]||(d[1]=x=>s("update:open",x))},{default:l(()=>[a(n(rt),null,{default:l(()=>[a(n(Fe),null,{default:l(()=>[a(n(qe),null,{default:l(()=>d[2]||(d[2]=[V("Add to Favorites")])),_:1}),a(n(ut),null,{default:l(()=>d[3]||(d[3]=[V(" Save this block to your favorites for quick access later. ")])),_:1})]),_:1}),c("div",tr,[c("div",sr,[d[4]||(d[4]=c("label",{for:"name",class:"text-sm font-medium"},"Block Name",-1)),a(n(Re),{id:"name",value:r.value,onInput:i,placeholder:"Enter a name for this block"},null,8,["value"])]),c("div",nr,[d[5]||(d[5]=c("label",{class:"text-sm font-medium"},"Tags",-1)),a(n(ss),{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=x=>o.value=x)},{default:l(()=>[(f(!0),k(Q,null,ee(o.value,x=>(f(),O(n(fn),{key:x,value:x},{default:l(()=>[V(A(x),1)]),_:2},1032,["value"]))),128)),a(n(gn),{placeholder:"Type and press enter to add tags"})]),_:1},8,["modelValue"])]),a(n(Ct),null,{default:l(()=>[a(n(J),{type:"button",disabled:r.value.length===0,onClick:u},{default:l(()=>d[6]||(d[6]=[V(" Save ")])),_:1},8,["disabled"])]),_:1})])]),_:1})]),_:1},8,["open"]))}});function or(){const m=D(!1),t=vn();return{isProcessing:m,executeAction:async(s,r,o)=>{if(!r.trim())return N({title:"No text selected",description:"Please select some text to perform this action.",variant:"destructive"}),null;try{m.value=!0;const i=t.settings.preferredProviderId,u=t.getApiKey(i);if(!u&&i!=="webllm")return N({title:"API Key Required",description:`Please configure your ${i} API key in settings.`,variant:"destructive"}),null;const d={prompt:`${s.prompt}

Text to process: "${r}"

Please respond with only the processed text, no additional commentary.`,maxTokens:t.settings.maxTokens,temperature:.3},x=await hn.generateText(i,d,u);if(x!=null&&x.text){let L=x.text.trim();return(L.startsWith('"')&&L.endsWith('"')||L.startsWith("'")&&L.endsWith("'"))&&(L=L.slice(1,-1)),o&&o(L),N({title:`${s.name} Complete`,description:"Text has been successfully processed."}),L}else throw new Error("No response received from AI service")}catch(i){return I.error(`Error in ${s.name}:`,i),N({title:`${s.name} Failed`,description:i instanceof Error?i.message:"An unexpected error occurred.",variant:"destructive"}),null}finally{m.value=!1}}}}const rr=K({__name:"BlockCommandMenu",props:{editorView:{}},emits:["close"],setup(m,{emit:t}){const e=m,s=t,r=D(null),o=()=>{var $;return r.value||(($=e.editorView)==null?void 0:$.state.selection)||null},i=()=>{var $;r.value=null,($=e.editorView)!=null&&$.state.selection&&(r.value=e.editorView.state.selection,I.info("Stored fresh selection:",{from:r.value.from,to:r.value.to,empty:r.value.empty}))},u=()=>{r.value=null},g=$=>{var M;(M=$.detail)!=null&&M.selection&&(r.value=$.detail.selection,I.info("Received selection update from context menu plugin:",{from:$.detail.selection.from,to:$.detail.selection.to,empty:$.detail.selection.empty}))};Ce(()=>{document.addEventListener("block-context-menu:selection-update",g)}),tt(()=>{document.removeEventListener("block-context-menu:selection-update",g)});const d=$=>{$?i():(u(),s("close"))};Ce(()=>{document.addEventListener("block-context-menu:selection-update",g)}),tt(()=>{document.removeEventListener("block-context-menu:selection-update",g)});const x=()=>{const $=o();if(!e.editorView||!$)return null;const M=e.editorView.state.doc.nodeAt($.from);return{nodeName:M==null?void 0:M.type.name,isBlock:M==null?void 0:M.isBlock,isInline:M==null?void 0:M.isInline,selection:{from:$.from,to:$.to,empty:$.empty}}},L=yn(),G=Ln(),{isProcessing:C,executeAction:b}=or(),S=D(!1),y=se(()=>{try{return G.isLoaded?G.enabledActions.filter($=>$&&$.id&&$.name&&$.icon&&$.color):[]}catch($){return I.error("Error getting enabled AI actions:",$),[]}}),p=async()=>{s("close");const $=o();if(!e.editorView||!$){I.error("No selection available for cut operation"),N({title:"Error",description:"No content selected to cut",variant:"destructive"});return}try{await T();const{state:M,dispatch:z}=e.editorView,te=M.tr.delete($.from,$.to);z(te),u(),e.editorView.focus(),N({title:"Success",description:"Content cut to clipboard"})}catch(M){I.error("Failed to cut content:",M),N({title:"Error",description:"Failed to cut content",variant:"destructive"})}},T=async()=>{const $=o();if(!e.editorView||!$){I.error("No selection available for clipboard operation");return}if($.empty){I.warn("Selection is empty, attempting to select current block");const re=$.from,ne=e.editorView.state.doc.nodeAt(re);if(ne&&ne.isBlock){const ge=re-$.$from.parentOffset,F=ge+ne.nodeSize;r.value=kn.create(e.editorView.state.doc,ge,F)}else{N({title:"Warning",description:"No block content selected",variant:"destructive"});return}}const M=(r.value||$).content(),{dom:z,text:te}=_n(e.editorView,M);try{if(typeof ClipboardItem<"u"){const re=new ClipboardItem({"text/html":new Blob([z.innerHTML],{type:"text/html"}),"text/plain":new Blob([te],{type:"text/plain"})});await navigator.clipboard.write([re])}else await navigator.clipboard.writeText(te);N({title:"Success",description:"Content copied to clipboard"})}catch(re){I.error("Failed to copy to clipboard:",re);try{const ne=document.createElement("textarea");ne.value=te,document.body.appendChild(ne),ne.select(),document.execCommand("copy"),document.body.removeChild(ne),N({title:"Success",description:"Content copied to clipboard"})}catch(ne){I.error("Fallback copy also failed:",ne),N({title:"Error",description:"Failed to copy content to clipboard",variant:"destructive"})}}},H=async()=>{const $=x();I.info("Copy operation - Selected node info:",$);const M=o();if(!e.editorView||!M||M.empty){I.warn("Copy operation aborted - no valid selection"),N({title:"Warning",description:"No content selected to copy",variant:"destructive"}),s("close");return}try{await T(),u()}catch(z){I.error("Copy operation failed:",z)}s("close")},W=()=>{const $=o();if(!e.editorView||!$||$.empty){I.warn("Delete operation aborted - no valid selection"),N({title:"Warning",description:"No content selected to delete",variant:"destructive"}),s("close");return}const{state:M,dispatch:z}=e.editorView,te=M.tr.delete($.from,$.to);z(te),u(),e.editorView.focus(),N({title:"Success",description:"Content deleted"}),s("close")},R=()=>{S.value=!0},_=async($,M)=>{const z=o();if(!e.editorView||!z)return;const te=e.editorView.state.doc.nodeAt(z.from);if(!te)return;const re=te.type.name,ne=te.toJSON();try{await L.addBlock({name:$,content:JSON.stringify(ne),type:re,tags:Array.from(M)}),S.value=!1,N({title:"Success",description:"Block added to favorites"}),s("close"),e.editorView.focus()}catch(ge){I.error("Failed to add block:",ge),N({title:"Error",description:"Failed to add block to favorites",variant:"destructive"})}},j=()=>{const $=o();if(!e.editorView||!$)return"";const{from:M,to:z}=$;return e.editorView.state.doc.textBetween(M,z," ").trim()},X=$=>{const M=o();if(!e.editorView||!M)return;const{state:z,dispatch:te}=e.editorView,{from:re,to:ne}=M,ge=z.tr.replaceWith(re,ne,z.schema.text($));te(ge),e.editorView.focus()},fe=async $=>{const M=G.getActionById($);if(!M)return;const z=j();await b(M,z,te=>{X(te)}),s("close")};return($,M)=>(f(),k(Q,null,[a(n(Xo),{"onUpdate:open":d},{default:l(()=>[a(n(er),{"as-child":""},{default:l(()=>[ue($.$slots,"default",{},void 0,!0)]),_:3}),a(n(Zo),{class:"w-64"},{default:l(()=>[a(n(Ut),null,{default:l(()=>M[1]||(M[1]=[V("Block Actions")])),_:1}),a(n(vt)),a(n(Ne),{onClick:p},{default:l(()=>[a(n(bn),{class:"mr-2 h-4 w-4"}),M[3]||(M[3]=c("span",null,"Cut",-1)),a(n(ht),null,{default:l(()=>M[2]||(M[2]=[V("⌘X")])),_:1})]),_:1}),a(n(Ne),{onClick:H},{default:l(()=>[a(n(wn),{class:"mr-2 h-4 w-4"}),M[5]||(M[5]=c("span",null,"Copy",-1)),a(n(ht),null,{default:l(()=>M[4]||(M[4]=[V("⌘C")])),_:1})]),_:1}),a(n(Ne),{onClick:R},{default:l(()=>[a(n(xn),{class:"mr-2 h-4 w-4"}),M[6]||(M[6]=c("span",null,"Add to Favorites",-1))]),_:1}),n(G).isLoaded&&y.value.length>0?(f(),k(Q,{key:0},[a(n(vt)),a(n(Ut),{class:"text-xs text-muted-foreground"},{default:l(()=>M[7]||(M[7]=[V("AI Actions")])),_:1}),(f(!0),k(Q,null,ee(y.value,z=>(f(),O(n(Ne),{key:z.id,onClick:()=>fe(z.id),disabled:n(C)},{default:l(()=>[(f(),O(lt(n(Dn)(z.icon||"EditIcon")),{class:"mr-2 h-4 w-4"})),c("span",null,A(n(C)?"Processing...":z.name||"AI Action"),1)]),_:2},1032,["onClick","disabled"]))),128))],64)):q("",!0),a(n(vt)),a(n(Ne),{onClick:W,class:"text-destructive focus:text-destructive"},{default:l(()=>[a(n(it),{class:"mr-2 h-4 w-4"}),M[9]||(M[9]=c("span",null,"Delete",-1)),a(n(ht),null,{default:l(()=>M[8]||(M[8]=[V("Del")])),_:1})]),_:1})]),_:1})]),_:3}),a(ar,{open:S.value,"onUpdate:open":M[0]||(M[0]=z=>S.value=z),onSubmit:_},null,8,["open"])],64))}}),ir=Me(rr,[["__scopeId","data-v-278296af"]]),lr={class:"flex items-center justify-between"},ur={key:0,class:"mb-6 border rounded-lg p-4 bg-muted/50"},dr={class:"flex gap-2"},cr={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pr={class:"flex items-center gap-2 justify-end"},mr={key:0,class:"flex items-center gap-2"},fr={key:1},gr={key:1,class:"rounded-lg border border-dashed p-8 text-center"},vr={key:2,class:"space-y-4"},hr=K({__name:"NotaConfigServers",props:{notaId:{},config:{}},setup(m){we();const t=dt(),e=new is,s=D(!1),r=D({}),o=D(!1),i=Sn(Cn({ip:Je().min(1,"IP address is required").refine(y=>y.includes(".")||y==="localhost","Please enter a valid IP address or hostname"),port:Je().min(1,"Port is required").regex(/^\d+$/,"Port must be a number").refine(y=>{const p=parseInt(y);return p>0&&p<=65535},"Port must be between 1 and 65535"),token:Je().optional(),url:Je().optional()})),{handleSubmit:u,resetForm:g,setValues:d,values:x}=$n({validationSchema:i,initialValues:{ip:"",port:"",token:"",url:""}}),L=async y=>{s.value=!0;try{const p=await e.testConnection(y),T=`${y.ip}:${y.port}`;r.value[T]=p,p.success&&await G(y)}catch(p){const T=`${y.ip}:${y.port}`;r.value[T]={success:!1,message:p instanceof Error?p.message:"Connection failed"}}finally{s.value=!1}},G=async y=>{try{const p=await e.getAvailableKernels(y);t.updateKernels(y,p)}catch(p){I.error("Failed to refresh kernels:",p)}},C=u(async y=>{var R;const p={ip:y.ip.trim(),port:y.port.trim(),token:((R=y.token)==null?void 0:R.trim())||""};if(t.jupyterServers.some(_=>_.ip.toLowerCase()===p.ip.toLowerCase()&&_.port===p.port)){N("A server with this IP and port already exists");return}N("Testing connection to server..."),await L(p);const H=`${p.ip}:${p.port}`,W=r.value[H];if(W!=null&&W.success)t.addServer(p),g(),o.value=!1,N("Server added successfully");else{const _=(W==null?void 0:W.message)||"Connection failed";N(`Failed to add server: ${_}`)}}),b=async y=>{confirm("Are you sure you want to remove this server?")&&t.removeServer(y)},S=()=>{if(!x.url){N("Please enter a Jupyter URL");return}const y=e.parseJupyterUrl(x.url);y?(d({...x,ip:y.ip,port:y.port,token:y.token}),N("URL parsed successfully")):N("Failed to parse Jupyter URL")};return(y,p)=>(f(),O(n(Be),null,{default:l(()=>[a(n(as),null,{default:l(()=>[c("div",lr,[c("div",null,[a(n(os),null,{default:l(()=>p[3]||(p[3]=[V("Connected Servers")])),_:1}),a(n(Tn),null,{default:l(()=>p[4]||(p[4]=[V("Manage your Jupyter server connections")])),_:1})]),a(n(J),{onClick:p[0]||(p[0]=T=>o.value=!o.value),variant:"outline",class:"flex items-center gap-2"},{default:l(()=>[a(n(St),{class:"w-4 h-4"}),p[5]||(p[5]=V(" Add Server "))]),_:1})])]),_:1}),a(n(rs),null,{default:l(()=>[o.value?(f(),k("div",ur,[c("form",{onSubmit:p[2]||(p[2]=(...T)=>n(C)&&n(C)(...T)),class:"space-y-4"},[a(n(Ke),{name:"url"},{default:l(({componentField:T})=>[a(n(We),null,{default:l(()=>[a(n(Qe),null,{default:l(()=>p[6]||(p[6]=[V("Jupyter URL (Optional)")])),_:1}),c("div",dr,[a(n(Ye),null,{default:l(()=>[a(n(Re),ve({placeholder:"https://jupyter-server.example.com:8888/?token=abc123",class:"flex-1"},T),null,16)]),_:2},1024),a(n(J),{type:"button",variant:"outline",onClick:S,class:"flex items-center gap-2"},{default:l(()=>[a(n(es),{class:"w-4 h-4"}),p[7]||(p[7]=V(" Parse URL "))]),_:1})]),a(n(En),null,{default:l(()=>p[8]||(p[8]=[V(" Paste a Jupyter URL (including Kaggle URLs) to automatically fill the fields below ")])),_:1}),a(n(Xe))]),_:2},1024)]),_:1}),c("div",cr,[a(n(Ke),{name:"ip"},{default:l(({componentField:T})=>[a(n(We),null,{default:l(()=>[a(n(Qe),null,{default:l(()=>p[9]||(p[9]=[V("Server IP")])),_:1}),a(n(Ye),null,{default:l(()=>[a(n(Re),ve({placeholder:"localhost"},T),null,16)]),_:2},1024),a(n(Xe))]),_:2},1024)]),_:1}),a(n(Ke),{name:"port"},{default:l(({componentField:T})=>[a(n(We),null,{default:l(()=>[a(n(Qe),null,{default:l(()=>p[10]||(p[10]=[V("Port")])),_:1}),a(n(Ye),null,{default:l(()=>[a(n(Re),ve({inputmode:"numeric",pattern:"[0-9]*",placeholder:"8888"},T),null,16)]),_:2},1024),a(n(Xe))]),_:2},1024)]),_:1})]),a(n(Ke),{name:"token"},{default:l(({componentField:T})=>[a(n(We),null,{default:l(()=>[a(n(Qe),null,{default:l(()=>p[11]||(p[11]=[V("Token")])),_:1}),a(n(Ye),null,{default:l(()=>[a(n(Re),ve({type:"password",placeholder:"Jupyter token (optional)"},T),null,16)]),_:2},1024),a(n(Xe))]),_:2},1024)]),_:1}),c("div",pr,[a(n(J),{type:"button",variant:"ghost",onClick:p[1]||(p[1]=()=>{o.value=!1,n(g)()}),disabled:s.value},{default:l(()=>p[12]||(p[12]=[V(" Cancel ")])),_:1},8,["disabled"]),a(n(J),{type:"submit",disabled:s.value,class:le({"pointer-events-none":s.value})},{default:l(()=>[s.value?(f(),k("span",mr,p[13]||(p[13]=[c("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[c("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),c("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),V(" Testing... ")]))):(f(),k("span",fr,"Add Server"))]),_:1},8,["disabled","class"])])],32)])):q("",!0),n(t).jupyterServers.length===0?(f(),k("div",gr,[a(n($t),{class:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),p[14]||(p[14]=c("p",{class:"text-sm font-medium mb-2"},"No Jupyter Servers Configured",-1)),p[15]||(p[15]=c("p",{class:"text-sm text-muted-foreground max-w-md mx-auto"}," Add a Jupyter server to enable code execution in your notebooks. You can connect to a local or remote Jupyter server. ",-1))])):(f(),k("div",vr,[(f(!0),k(Q,null,ee(n(t).jupyterServers,T=>(f(),O(An,{key:`${T.ip}:${T.port}`,server:T,kernels:n(t).kernels[`${T.ip}:${T.port}`],onRemove:b,onKernelsUpdated:G},null,8,["server","kernels"]))),128))]))]),_:1})]),_:1}))}}),yr={key:0},br={key:1,class:"space-y-6"},wr={class:"flex justify-end"},xr={class:"flex items-center justify-between"},kr={class:"flex items-center gap-3"},_r={key:0,class:"text-sm text-muted-foreground py-4"},Sr={key:1,class:"space-y-3 py-4"},Cr={class:"flex items-center gap-3"},$r={class:"font-medium"},Tr={class:"text-sm text-muted-foreground"},Er={key:0,class:"text-sm text-muted-foreground py-4"},Br={key:1,class:"space-y-3 py-4"},Ir={class:"flex items-center gap-3"},Pr={class:"font-medium"},Vr={class:"text-sm text-muted-foreground"},Mr=K({__name:"NotaConfigSessions",props:{notaId:{},config:{}},setup(m){we();const e=dt().jupyterServers,s=new is,r=D(!1),o=D({}),i=D({}),u=D({}),g=async C=>{const b=`${C.ip}:${C.port}`;try{if((await s.testConnection(C)).success){const[y,p]=await Promise.all([s.getActiveSessions(C),s.getRunningKernels(C)]);o.value[b]=y,i.value[b]=p}else o.value[b]=[],i.value[b]=[]}catch(S){I.error("Failed to refresh sessions:",S),o.value[b]=[],i.value[b]=[]}},d=async()=>{r.value=!0;try{await Promise.all(e.map(g))}finally{r.value=!1}},x=C=>{const b=new Date(C),y=new Date().getTime()-b.getTime(),p=Math.floor(y/6e4);if(p<1)return"just now";if(p<60)return`${p}m ago`;const T=Math.floor(p/60);return T<24?`${T}h ago`:`${Math.floor(T/24)}d ago`},L=async(C,b)=>{`${C.ip}${C.port}`,u.value[b]=!0;try{await s.deleteKernel(C,b),await g(C),N("Kernel deleted successfully")}catch(S){I.error("Failed to delete kernel:",S),N("Failed to delete kernel")}finally{u.value[b]=!1}},G=async C=>{var y;const b=`${C.ip}:${C.port}`,S=((y=i.value[b])==null?void 0:y.filter(p=>p.executionState==="idle"))||[];if(S.length===0){N("No idle kernels to clean");return}try{await Promise.all(S.map(p=>s.deleteKernel(C,p.id))),await g(C),N(`Cleaned ${S.length} idle kernel(s)`)}catch(p){I.error("Failed to clean idle kernels:",p),N("Failed to clean some kernels")}};return Ce(d),(C,b)=>n(e).length===0?(f(),k("div",yr,[a(n(bt),null,{default:l(()=>[a(n(wt),null,{default:l(()=>b[0]||(b[0]=[V(" No servers configured. Add a server to view active sessions and kernels. ")])),_:1})]),_:1})])):(f(),k("div",br,[c("div",wr,[a(n(J),{variant:"outline",size:"sm",onClick:d,disabled:r.value,class:"flex items-center gap-2"},{default:l(()=>[a(n(ns),{class:le(["w-4 h-4",{"animate-spin":r.value}])},null,8,["class"]),V(" "+A(r.value?"Refreshing...":"Refresh All"),1)]),_:1},8,["disabled"])]),(f(!0),k(Q,null,ee(n(e),S=>(f(),k("div",{key:`${S.ip}:${S.port}`},[a(n(Be),null,{default:l(()=>[a(n(as),null,{default:l(()=>{var y;return[c("div",xr,[c("div",kr,[a(n($t),{class:"w-5 h-5 text-muted-foreground"}),a(n(os),{class:"text-base"},{default:l(()=>[c("code",null,A(S.ip)+":"+A(S.port),1)]),_:2},1024)]),(y=i.value[`${S.ip}:${S.port}`])!=null&&y.some(p=>p.executionState==="idle")?(f(),O(n(J),{key:0,variant:"outline",size:"sm",onClick:p=>G(S),class:"flex items-center gap-2"},{default:l(()=>[a(n(_t),{class:"w-4 h-4"}),b[1]||(b[1]=V(" Clean Idle Kernels "))]),_:2},1032,["onClick"])):q("",!0)])]}),_:2},1024),a(n(rs),null,{default:l(()=>[a(n(ls),{defaultValue:"sessions",class:"w-full"},{default:l(()=>[a(n(us),{class:"w-full grid grid-cols-2"},{default:l(()=>[a(n(st),{value:"sessions",class:"flex items-center gap-2"},{default:l(()=>[a(n(xt),{class:"w-4 h-4"}),b[2]||(b[2]=V(" Sessions "))]),_:1}),a(n(st),{value:"kernels",class:"flex items-center gap-2"},{default:l(()=>[a(n(Ot),{class:"w-4 h-4"}),b[3]||(b[3]=V(" Kernels "))]),_:1})]),_:1}),a(n(nt),{value:"sessions"},{default:l(()=>{var y;return[(y=o.value[`${S.ip}:${S.port}`])!=null&&y.length?(f(),k("div",Sr,[(f(!0),k(Q,null,ee(o.value[`${S.ip}:${S.port}`],p=>(f(),k("div",{key:p.id,class:"flex items-center justify-between p-3 rounded-lg bg-muted/50"},[c("div",Cr,[a(n(xt),{class:"w-4 h-4 text-green-500"}),c("div",null,[c("div",$r,A(p.name||"Untitled"),1),c("div",Tr,A(p.kernel.name)+" • Last activity "+A(x(p.kernel.lastActivity)),1)])])]))),128))])):(f(),k("div",_r," No active sessions on this server. "))]}),_:2},1024),a(n(nt),{value:"kernels"},{default:l(()=>{var y;return[(y=i.value[`${S.ip}:${S.port}`])!=null&&y.length?(f(),k("div",Br,[(f(!0),k(Q,null,ee(i.value[`${S.ip}:${S.port}`],p=>(f(),k("div",{key:p.id,class:"flex items-center justify-between p-3 rounded-lg bg-muted/50"},[c("div",Ir,[a(n(Ot),{class:le(["w-4 h-4",{"text-green-500":p.executionState==="idle","text-yellow-500":p.executionState==="busy","text-blue-500":p.executionState==="starting"}])},null,8,["class"]),c("div",null,[c("div",Pr,A(p.name),1),c("div",Vr,A(p.executionState)+" • "+A(p.connections)+" connection(s) • Last activity "+A(x(p.lastActivity)),1)])]),p.executionState!=="busy"?(f(),O(n(J),{key:0,variant:"ghost",size:"sm",disabled:u.value[p.id],onClick:T=>L(S,p.id),class:"text-destructive hover:text-destructive"},{default:l(()=>[a(n(it),{class:le(["w-4 h-4",{"animate-spin":u.value[p.id]}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])):q("",!0)]))),128))])):(f(),k("div",Er," No running kernels on this server. "))]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]))}}),Lr={class:"mt-6"},Dr={class:"flex items-center justify-center gap-2 p-1"},Ar={class:"flex items-center justify-center gap-2 p-1"},Nr=K({__name:"NotaConfigModal",props:{notaId:{},open:{type:Boolean}},emits:["update:open"],setup(m,{emit:t}){const e=m,s=t,r=we(),o=se(()=>r.getCurrentNota(e.notaId)),i=se(()=>{var u,g,d,x;return{kernelPreferences:((g=(u=o.value)==null?void 0:u.config)==null?void 0:g.kernelPreferences)||{},savedSessions:((x=(d=o.value)==null?void 0:d.config)==null?void 0:x.savedSessions)||[]}});return(u,g)=>(f(),O(n(Oe),{open:u.open,"onUpdate:open":g[0]||(g[0]=d=>s("update:open",d))},{default:l(()=>[a(n(rt),{class:"max-w-4xl max-h-[90vh] overflow-y-auto"},{default:l(()=>[a(n(Fe),null,{default:l(()=>[a(n(qe),null,{default:l(()=>g[1]||(g[1]=[V("Jupyter Configuration")])),_:1}),a(n(ut),null,{default:l(()=>g[2]||(g[2]=[V(" Configure Jupyter servers and kernels for your Nota ")])),_:1})]),_:1}),c("div",Lr,[a(n(ls),{"default-value":"servers",class:"w-full"},{default:l(()=>[a(n(us),{class:"grid w-full grid-cols-2"},{default:l(()=>[a(n(st),{value:"servers"},{default:l(()=>[c("div",Dr,[a(n($t),{class:"w-4 h-4 shrink-0"}),g[3]||(g[3]=c("span",{class:"text-sm"},"Servers",-1))])]),_:1}),a(n(st),{value:"sessions"},{default:l(()=>[c("div",Ar,[a(n(xt),{class:"w-4 h-4 shrink-0"}),g[4]||(g[4]=c("span",{class:"text-sm"},"Sessions",-1))])]),_:1})]),_:1}),a(n(nt),{value:"servers"},{default:l(()=>[a(hr,{"nota-id":u.notaId,config:i.value},null,8,["nota-id","config"])]),_:1}),a(n(nt),{value:"sessions"},{default:l(()=>[a(Mr,{"nota-id":u.notaId,config:i.value},null,8,["nota-id","config"])]),_:1})]),_:1})])]),_:1})]),_:1},8,["open"]))}}),zr={class:"flex items-center justify-between space-x-1 bg-muted/20 border-b px-1 py-1 no-scrollbar max-h-12 min-h-[3rem]"},Rr={class:"flex items-center space-x-1 overflow-x-auto no-scrollbar"},Gr=["onClick","onDragstart","onDragover","onDrop"],Or={class:"truncate flex-1 min-w-0"},Fr={key:0,class:"ml-1 text-primary-foreground text-xs"},qr=["onClick"],jr={class:"flex items-center gap-1 pr-2"},Hr=K({__name:"PaneTabs",props:{pane:{}},emits:["splitHorizontal","splitVertical","closePane"],setup(m,{emit:t}){const e=m,s=we(),r=pt(),o=D(!1),i=D(null),u=D(!1),g=se(()=>(e.pane.tabHistory||[]).map(p=>{const T=s.getItem(p);return{id:p,title:(T==null?void 0:T.title)||"Untitled",isDirty:!1}})),d=y=>{o.value||r.switchToTabInPane(e.pane.id,y)},x=y=>{r.closeTabInPane(e.pane.id,y)},L=(y,p)=>{o.value=!0,i.value=p,r.setDraggedTab(p),y.dataTransfer&&(y.dataTransfer.effectAllowed="move",y.dataTransfer.setData("text/plain",p)),I.debug("Started dragging pane tab",p)},G=()=>{o.value=!1,i.value=null,u.value=!1,r.setDraggedTab(null),I.debug("Ended dragging pane tab")},C=(y,p)=>{i.value&&i.value!==p&&(u.value=!0)},b=()=>{u.value=!1},S=(y,p)=>{var W;const T=i.value;if(!T||T===p)return;const H=(W=r.panes.find(R=>(R.tabHistory||[]).includes(T)))==null?void 0:W.id;H&&H!==e.pane.id?(r.closeTabInPane(H,T),r.switchToTabInPane(e.pane.id,T)):I.debug("Tab reordering within same pane not implemented yet"),G(),I.debug("Dropped pane tab",{sourceTabId:T,targetTabId:p})};return(y,p)=>(f(),k("div",zr,[c("div",Rr,[(f(!0),k(Q,null,ee(g.value,T=>(f(),k("div",{key:T.id,class:le(["flex items-center py-1 px-3 text-sm rounded-md cursor-pointer transition-colors whitespace-nowrap h-8 min-w-0 max-w-[200px]",y.pane.notaId===T.id?"bg-background text-foreground font-medium shadow-sm":"hover:bg-background/80 text-muted-foreground",o.value&&i.value===T.id?"opacity-50":"",u.value&&T.id!==i.value?"ring-2 ring-primary/50":""]),draggable:!0,onClick:H=>d(T.id),onDragstart:H=>L(H,T.id),onDragend:G,onDragover:ye(H=>C(H,T.id),["prevent"]),onDragleave:b,onDrop:ye(H=>S(H,T.id),["prevent"])},[c("span",Or,A(T.title),1),T.isDirty?(f(),k("span",Fr,"*")):q("",!0),c("button",{class:"ml-2 w-5 h-5 rounded-sm flex items-center justify-center hover:bg-muted transition-colors",onClick:ye(H=>x(T.id),["stop"]),"aria-label":"Close tab"},[a(n(Ft),{class:"h-3 w-3"})],8,qr)],42,Gr))),128))]),c("div",jr,[a(n(J),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0",onClick:p[0]||(p[0]=ye(T=>y.$emit("splitHorizontal"),["stop"])),title:"Split Right"},{default:l(()=>[a(n(Rn),{class:"h-4 w-4"})]),_:1}),a(n(J),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0",onClick:p[1]||(p[1]=ye(T=>y.$emit("splitVertical"),["stop"])),title:"Split Down"},{default:l(()=>[a(n(Gn),{class:"h-4 w-4"})]),_:1}),a(n(J),{variant:"ghost",size:"sm",class:"h-7 w-7 p-0",onClick:p[2]||(p[2]=ye(T=>y.$emit("closePane"),["stop"])),title:"Close Pane"},{default:l(()=>[a(n(Ft),{class:"h-4 w-4"})]),_:1})])]))}}),Ur=Me(Hr,[["__scopeId","data-v-64019942"]]),Jr={class:"text-center text-muted-foreground"},Kr={key:1,class:"flex-1 min-h-0 w-full max-h-full overflow-hidden"},Wr={key:1,class:"flex items-center justify-center h-full"},Qr={class:"flex flex-col items-center gap-4 p-8 rounded-lg bg-card border shadow-lg"},Yr={class:"w-full space-y-2"},Xr={class:"flex items-center justify-between text-xs"},Zr={class:"flex items-center justify-between text-xs"},_e=K({__name:"NotaPane",props:{pane:{}},setup(m,{expose:t}){const e=m,s=we(),r=dt(),o=pt(),i=ts(),u=ds(),g=D(!1),d=D(!1),x=D(!1),L=D(!1),G=D(!1),C=D(null),b=D("nota"),S=se(()=>e.pane.notaId?s.getCurrentNota(e.pane.notaId):null);ie(S,F=>{F&&b.value==="nota"&&(b.value="editor")});const y=se(()=>e.pane.isActive);ie(y,F=>{var U,he;F?(u.setActiveEditor(((U=C.value)==null?void 0:U.editor)||null),u.setActiveEditorComponent(C.value||null)):u.activeEditor===((he=C.value)==null?void 0:he.editor)&&(u.setActiveEditor(null),u.setActiveEditorComponent(null))}),ie(()=>{var F;return(F=C.value)==null?void 0:F.editor},F=>{F&&y.value&&(u.setActiveEditor(F),u.setActiveEditorComponent(C.value),b.value==="editor"&&(b.value="ready"))});const p=async F=>{try{d.value=!1,b.value="nota";const U=await s.loadNota(F);U&&!U.tags&&(U.tags=[],await s.saveItem(U)),U&&!U.parentId&&r.jupyterServers.length===0&&N({title:"Configure Jupyter",description:"Set up your Jupyter server to enable code execution in this notebook."}),b.value="editor",await new Promise(he=>setTimeout(he,100)),d.value=!0,b.value="ready"}catch(U){I.error("Error loading nota in pane:",U),N({title:"Error",description:"Failed to load notebook. Please try again.",variant:"destructive"})}};ie(()=>e.pane.notaId,async F=>{F?await p(F):(d.value=!1,b.value="nota")},{immediate:!0});const T=()=>{y.value||o.setActivePane(e.pane.id)},H=F=>{o.draggedTab&&(G.value=!0)},W=()=>{G.value=!1},R=F=>{G.value=!1,o.draggedTab&&!e.pane.notaId&&(o.openNotaInPane(o.draggedTab,e.pane.id),o.setDraggedTab(null))},_=()=>{o.splitPane(e.pane.id,"horizontal")},j=()=>{o.splitPane(e.pane.id,"vertical")},X=()=>{o.closePane(e.pane.id)},fe=async()=>{g.value=!0;try{await i.executeAll()}catch(F){I.error("Error executing all cells:",F),N({title:"Execution Error",description:"Failed to execute all cells. Please check your code or server connection.",variant:"destructive"})}finally{g.value=!1}},$=()=>{x.value=!x.value},M=()=>{L.value=!L.value},z=async()=>{if(e.pane.notaId)try{await s.exportNota(e.pane.notaId),N({title:"Export Complete",description:"Your nota has been exported successfully."})}catch(F){I.error("Error exporting nota:",F),N({title:"Export Error",description:"Failed to export nota. Please try again.",variant:"destructive"})}},te=()=>{e.pane.notaId&&s.toggleFavorite(e.pane.notaId)},re=F=>{S.value&&(S.value.tags=F)},ne=async()=>{var F;await((F=C.value)==null?void 0:F.saveVersion())},ge=()=>{C.value&&(C.value.showVersionHistory=!0)};return t({pane:e.pane,notaEditorRef:C,executeAllCells:fe,toggleFavorite:te,toggleConfigModal:$,toggleShareDialog:M,exportNota:z,saveVersion:ne,openHistory:ge}),(F,U)=>{var he,P;return f(),k("div",{class:le(["h-full w-full max-h-full flex flex-col bg-background border-r border-border overflow-hidden",{"border-primary border-2":y.value}]),onClick:T},[a(Ur,{pane:F.pane,onSplitHorizontal:_,onSplitVertical:j,onClosePane:X},null,8,["pane"]),F.pane.notaId?(f(),k("div",Kr,[d.value&&S.value?(f(),O(ir,{key:0,"editor-view":(P=(he=C.value)==null?void 0:he.editor)==null?void 0:P.view},{default:l(()=>{var xe,Le,De;return[(f(),O(Yo,{"nota-id":F.pane.notaId,key:F.pane.notaId,"can-run-all":S.value&&((xe=S.value.config)==null?void 0:xe.savedSessions)&&((Le=S.value.config)==null?void 0:Le.savedSessions.length)>0,"is-executing-all":g.value,onRunAll:fe,"is-favorite":(De=S.value)==null?void 0:De.favorite,"onUpdate:favorite":te,"onUpdate:tags":re,onShare:M,onOpenConfig:$,onExportNota:z,class:"h-full w-full",ref_key:"notaEditorRef",ref:C},null,8,["nota-id","can-run-all","is-executing-all","is-favorite"]))]}),_:1},8,["editor-view"])):(f(),k("div",Wr,[c("div",Qr,[U[6]||(U[6]=cs('<div class="flex items-center gap-3"><div class="w-8 h-8 animate-spin rounded-full border-2 border-primary border-t-transparent"></div><div class="flex flex-col"><h3 class="text-lg font-semibold">Loading Nota</h3><p class="text-sm text-muted-foreground">Please wait while we prepare your notebook...</p></div></div>',1)),c("div",Yr,[c("div",Xr,[U[4]||(U[4]=c("span",null,"Nota",-1)),c("span",{class:le(b.value!=="nota"?"text-green-600":"text-muted-foreground")},A(b.value!=="nota"?"✓ Loaded":"⏳ Loading..."),3)]),c("div",Zr,[U[5]||(U[5]=c("span",null,"Editor",-1)),c("span",{class:le(b.value==="ready"?"text-green-600":"text-muted-foreground")},A(b.value==="ready"?"✓ Ready":"⏳ Initializing..."),3)])])])]))])):(f(),k("div",{key:0,class:le(["flex-1 flex items-center justify-center border-2 border-dashed border-muted-foreground/25 m-4 rounded-lg",{"border-primary bg-primary/10":G.value,"border-muted-foreground/50 bg-muted/5":!G.value}]),onDragover:ye(H,["prevent"]),onDragleave:ye(W,["prevent"]),onDrop:ye(R,["prevent"])},[c("div",Jr,[a(n(et),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),U[2]||(U[2]=c("p",{class:"text-sm"},"Drop a tab here to split the view",-1)),U[3]||(U[3]=c("p",{class:"text-xs mt-1"},"or select a tab to view in this pane",-1))])],34)),F.pane.notaId?(f(),O(Nr,{key:2,"nota-id":F.pane.notaId,open:x.value,"onUpdate:open":U[0]||(U[0]=xe=>x.value=xe)},null,8,["nota-id","open"])):q("",!0),F.pane.notaId?(f(),O(Bn,{key:3,"nota-id":F.pane.notaId,open:L.value,"onUpdate:open":U[1]||(U[1]=xe=>L.value=xe)},null,8,["nota-id","open"])):q("",!0)],2)}}});var yt=function(m,t){return Number(m.slice(0,-1*t.length))},ei=function(m){return m.endsWith("px")?{value:m,type:"px",numeric:yt(m,"px")}:m.endsWith("fr")?{value:m,type:"fr",numeric:yt(m,"fr")}:m.endsWith("%")?{value:m,type:"%",numeric:yt(m,"%")}:m==="auto"?{value:m,type:"auto"}:null},ms=function(m){return m.split(" ").map(ei)},ti=function(m,t,e,s){e===void 0&&(e=0),s===void 0&&(s=!1);var r=s?m+1:m,o=t.slice(0,r).reduce(function(u,g){return u+g.numeric},0),i=e?m*e:0;return o+i},fs=function(m,t,e){return t.concat(e).map(function(s){return s.style[m]}).filter(function(s){return s!==void 0&&s!==""})},si=function(m,t){return t.endsWith(m)?Number(t.slice(0,-1*m.length)):null},Jt=function(m){for(var t=0;t<m.length;t++)if(m[t].numeric>0)return t;return null},Se=function(){return!1},ni=function(m,t,e){m.style[t]=e},Z=function(m,t,e){var s=m[t];return s!==void 0?s:e};function gs(m){var t;return(t=[]).concat.apply(t,Array.from(m.ownerDocument.styleSheets).map(function(e){var s=[];try{s=Array.from(e.cssRules||[])}catch{}return s})).filter(function(e){var s=!1;try{s=m.matches(e.selectorText)}catch{}return s})}var ai="grid-template-columns",oi="grid-template-rows",oe=function(t,e,s){this.direction=t,this.element=e.element,this.track=e.track,t==="column"?(this.gridTemplateProp=ai,this.gridGapProp="grid-column-gap",this.cursor=Z(s,"columnCursor",Z(s,"cursor","col-resize")),this.snapOffset=Z(s,"columnSnapOffset",Z(s,"snapOffset",30)),this.dragInterval=Z(s,"columnDragInterval",Z(s,"dragInterval",1)),this.clientAxis="clientX",this.optionStyle=Z(s,"gridTemplateColumns")):t==="row"&&(this.gridTemplateProp=oi,this.gridGapProp="grid-row-gap",this.cursor=Z(s,"rowCursor",Z(s,"cursor","row-resize")),this.snapOffset=Z(s,"rowSnapOffset",Z(s,"snapOffset",30)),this.dragInterval=Z(s,"rowDragInterval",Z(s,"dragInterval",1)),this.clientAxis="clientY",this.optionStyle=Z(s,"gridTemplateRows")),this.onDragStart=Z(s,"onDragStart",Se),this.onDragEnd=Z(s,"onDragEnd",Se),this.onDrag=Z(s,"onDrag",Se),this.writeStyle=Z(s,"writeStyle",ni),this.startDragging=this.startDragging.bind(this),this.stopDragging=this.stopDragging.bind(this),this.drag=this.drag.bind(this),this.minSizeStart=e.minSizeStart,this.minSizeEnd=e.minSizeEnd,e.element&&(this.element.addEventListener("mousedown",this.startDragging),this.element.addEventListener("touchstart",this.startDragging))};oe.prototype.getDimensions=function(){var t=this.grid.getBoundingClientRect(),e=t.width,s=t.height,r=t.top,o=t.bottom,i=t.left,u=t.right;this.direction==="column"?(this.start=r,this.end=o,this.size=s):this.direction==="row"&&(this.start=i,this.end=u,this.size=e)};oe.prototype.getSizeAtTrack=function(t,e){return ti(t,this.computedPixels,this.computedGapPixels,e)};oe.prototype.getSizeOfTrack=function(t){return this.computedPixels[t].numeric};oe.prototype.getRawTracks=function(){var t=fs(this.gridTemplateProp,[this.grid],gs(this.grid));if(!t.length){if(this.optionStyle)return this.optionStyle;throw Error("Unable to determine grid template tracks from styles.")}return t[0]};oe.prototype.getGap=function(){var t=fs(this.gridGapProp,[this.grid],gs(this.grid));return t.length?t[0]:null};oe.prototype.getRawComputedTracks=function(){return window.getComputedStyle(this.grid)[this.gridTemplateProp]};oe.prototype.getRawComputedGap=function(){return window.getComputedStyle(this.grid)[this.gridGapProp]};oe.prototype.setTracks=function(t){this.tracks=t.split(" "),this.trackValues=ms(t)};oe.prototype.setComputedTracks=function(t){this.computedTracks=t.split(" "),this.computedPixels=ms(t)};oe.prototype.setGap=function(t){this.gap=t};oe.prototype.setComputedGap=function(t){this.computedGap=t,this.computedGapPixels=si("px",this.computedGap)||0};oe.prototype.getMousePosition=function(t){return"touches"in t?t.touches[0][this.clientAxis]:t[this.clientAxis]};oe.prototype.startDragging=function(t){if(!("button"in t&&t.button!==0)){t.preventDefault(),this.element?this.grid=this.element.parentNode:this.grid=t.target.parentNode,this.getDimensions(),this.setTracks(this.getRawTracks()),this.setComputedTracks(this.getRawComputedTracks()),this.setGap(this.getGap()),this.setComputedGap(this.getRawComputedGap());var e=this.trackValues.filter(function(u){return u.type==="%"}),s=this.trackValues.filter(function(u){return u.type==="fr"});if(this.totalFrs=s.length,this.totalFrs){var r=Jt(s);r!==null&&(this.frToPixels=this.computedPixels[r].numeric/s[r].numeric)}if(e.length){var o=Jt(e);o!==null&&(this.percentageToPixels=this.computedPixels[o].numeric/e[o].numeric)}var i=this.getSizeAtTrack(this.track,!1)+this.start;if(this.dragStartOffset=this.getMousePosition(t)-i,this.aTrack=this.track-1,this.track<this.tracks.length-1)this.bTrack=this.track+1;else throw Error("Invalid track index: "+this.track+". Track must be between two other tracks and only "+this.tracks.length+" tracks were found.");this.aTrackStart=this.getSizeAtTrack(this.aTrack,!1)+this.start,this.bTrackEnd=this.getSizeAtTrack(this.bTrack,!0)+this.start,this.dragging=!0,window.addEventListener("mouseup",this.stopDragging),window.addEventListener("touchend",this.stopDragging),window.addEventListener("touchcancel",this.stopDragging),window.addEventListener("mousemove",this.drag),window.addEventListener("touchmove",this.drag),this.grid.addEventListener("selectstart",Se),this.grid.addEventListener("dragstart",Se),this.grid.style.userSelect="none",this.grid.style.webkitUserSelect="none",this.grid.style.MozUserSelect="none",this.grid.style.pointerEvents="none",this.grid.style.cursor=this.cursor,window.document.body.style.cursor=this.cursor,this.onDragStart(this.direction,this.track)}};oe.prototype.stopDragging=function(){this.dragging=!1,this.cleanup(),this.onDragEnd(this.direction,this.track),this.needsDestroy&&(this.element&&(this.element.removeEventListener("mousedown",this.startDragging),this.element.removeEventListener("touchstart",this.startDragging)),this.destroyCb(),this.needsDestroy=!1,this.destroyCb=null)};oe.prototype.drag=function(t){var e=this.getMousePosition(t),s=this.getSizeOfTrack(this.track),r=this.aTrackStart+this.minSizeStart+this.dragStartOffset+this.computedGapPixels,o=this.bTrackEnd-this.minSizeEnd-this.computedGapPixels-(s-this.dragStartOffset),i=r+this.snapOffset,u=o-this.snapOffset;e<i&&(e=r),e>u&&(e=o),e<r?e=r:e>o&&(e=o);var g=e-this.aTrackStart-this.dragStartOffset-this.computedGapPixels,d=this.bTrackEnd-e+this.dragStartOffset-s-this.computedGapPixels;if(this.dragInterval>1){var x=Math.round(g/this.dragInterval)*this.dragInterval;d-=x-g,g=x}if(g<this.minSizeStart&&(g=this.minSizeStart),d<this.minSizeEnd&&(d=this.minSizeEnd),this.trackValues[this.aTrack].type==="px")this.tracks[this.aTrack]=g+"px";else if(this.trackValues[this.aTrack].type==="fr")if(this.totalFrs===1)this.tracks[this.aTrack]="1fr";else{var L=g/this.frToPixels;this.tracks[this.aTrack]=L+"fr"}else if(this.trackValues[this.aTrack].type==="%"){var G=g/this.percentageToPixels;this.tracks[this.aTrack]=G+"%"}if(this.trackValues[this.bTrack].type==="px")this.tracks[this.bTrack]=d+"px";else if(this.trackValues[this.bTrack].type==="fr")if(this.totalFrs===1)this.tracks[this.bTrack]="1fr";else{var C=d/this.frToPixels;this.tracks[this.bTrack]=C+"fr"}else if(this.trackValues[this.bTrack].type==="%"){var b=d/this.percentageToPixels;this.tracks[this.bTrack]=b+"%"}var S=this.tracks.join(" ");this.writeStyle(this.grid,this.gridTemplateProp,S),this.onDrag(this.direction,this.track,S)};oe.prototype.cleanup=function(){window.removeEventListener("mouseup",this.stopDragging),window.removeEventListener("touchend",this.stopDragging),window.removeEventListener("touchcancel",this.stopDragging),window.removeEventListener("mousemove",this.drag),window.removeEventListener("touchmove",this.drag),this.grid&&(this.grid.removeEventListener("selectstart",Se),this.grid.removeEventListener("dragstart",Se),this.grid.style.userSelect="",this.grid.style.webkitUserSelect="",this.grid.style.MozUserSelect="",this.grid.style.pointerEvents="",this.grid.style.cursor=""),window.document.body.style.cursor=""};oe.prototype.destroy=function(t,e){t===void 0&&(t=!0),t||this.dragging===!1?(this.cleanup(),this.element&&(this.element.removeEventListener("mousedown",this.startDragging),this.element.removeEventListener("touchstart",this.startDragging)),e&&e()):(this.needsDestroy=!0,e&&(this.destroyCb=e))};var Kt=function(m,t,e){return t in m?m[t]:e},Pe=function(m,t){return function(e){if(e.track<1)throw Error("Invalid track index: "+e.track+". Track must be between two other tracks.");var s=m==="column"?t.columnMinSizes||{}:t.rowMinSizes||{},r=m==="column"?"columnMinSize":"rowMinSize";return new oe(m,Object.assign({},{minSizeStart:Kt(s,e.track-1,Z(t,r,Z(t,"minSize",0))),minSizeEnd:Kt(s,e.track+1,Z(t,r,Z(t,"minSize",0)))},e),t)}},Ee=function(t){var e=this;this.columnGutters={},this.rowGutters={},this.options=Object.assign({},{columnGutters:t.columnGutters||[],rowGutters:t.rowGutters||[],columnMinSizes:t.columnMinSizes||{},rowMinSizes:t.rowMinSizes||{}},t),this.options.columnGutters.forEach(function(s){e.columnGutters[s.track]=Pe("column",e.options)(s)}),this.options.rowGutters.forEach(function(s){e.rowGutters[s.track]=Pe("row",e.options)(s)})};Ee.prototype.addColumnGutter=function(t,e){this.columnGutters[e]&&this.columnGutters[e].destroy(),this.columnGutters[e]=Pe("column",this.options)({element:t,track:e})};Ee.prototype.addRowGutter=function(t,e){this.rowGutters[e]&&this.rowGutters[e].destroy(),this.rowGutters[e]=Pe("row",this.options)({element:t,track:e})};Ee.prototype.removeColumnGutter=function(t,e){var s=this;e===void 0&&(e=!0),this.columnGutters[t]&&this.columnGutters[t].destroy(e,function(){delete s.columnGutters[t]})};Ee.prototype.removeRowGutter=function(t,e){var s=this;e===void 0&&(e=!0),this.rowGutters[t]&&this.rowGutters[t].destroy(e,function(){delete s.rowGutters[t]})};Ee.prototype.handleDragStart=function(t,e,s){e==="column"?(this.columnGutters[s]&&this.columnGutters[s].destroy(),this.columnGutters[s]=Pe("column",this.options)({track:s}),this.columnGutters[s].startDragging(t)):e==="row"&&(this.rowGutters[s]&&this.rowGutters[s].destroy(),this.rowGutters[s]=Pe("row",this.options)({track:s}),this.rowGutters[s].startDragging(t))};Ee.prototype.destroy=function(t){var e=this;t===void 0&&(t=!0),Object.keys(this.columnGutters).forEach(function(s){return e.columnGutters[s].destroy(t,function(){delete e.columnGutters[s]})}),Object.keys(this.rowGutters).forEach(function(s){return e.rowGutters[s].destroy(t,function(){delete e.rowGutters[s]})})};function ri(m){return new Ee(m)}const ii=["data-track"],li=["data-track"],ze="7px",ui=K({__name:"SplitViewContainer",setup(m,{expose:t}){const e=pt(),s=D(null),r=D([]);let o=null;const i=se(()=>{const d=e.panes.length;if(d<=1)return{display:"grid","grid-template-columns":"1fr","grid-template-rows":"1fr"};if(d===2)return{display:"grid","grid-template-columns":`1fr ${ze} 1fr`,"grid-template-rows":"1fr"};if(d===3)return{display:"grid","grid-template-columns":`1fr ${ze} 1fr`,"grid-template-rows":`1fr ${ze} 1fr`};const x=Math.ceil(Math.sqrt(d)),L=Math.ceil(d/x),G=Array(x).fill("1fr").join(` ${ze} `),C=Array(L).fill("1fr").join(` ${ze} `);return{display:"grid","grid-template-columns":G,"grid-template-rows":C}}),u=()=>{if(o&&(o.destroy(),o=null),!s.value||e.panes.length<=1)return;const d=[],x=[],L=s.value.querySelectorAll(".gutter-col"),G=s.value.querySelectorAll(".gutter-row");L.forEach(C=>{const b=parseInt(C.dataset.track||"0",10);b>0&&d.push({track:b,element:C})}),G.forEach(C=>{const b=parseInt(C.dataset.track||"0",10);b>0&&x.push({track:b,element:C})}),(d.length>0||x.length>0)&&(I.debug("Initializing split-grid",{columnGutters:d,rowGutters:x}),o=ri({columnGutters:d,rowGutters:x,minSize:150}))};Ce(()=>{be(u)}),tt(()=>{o&&o.destroy()}),ie(()=>e.panes.length,()=>{be(u)}),In(()=>{r.value=[]});const g=d=>{d&&r.value.push(d)};return t({paneRefs:r}),(d,x)=>(f(),k("div",{class:"split-view-container w-full h-full max-h-full overflow-hidden",ref_key:"gridRef",ref:s,style:gt(i.value)},[n(e).panes.length===1?(f(),O(_e,{key:0,pane:n(e).panes[0],ref:g},null,8,["pane"])):q("",!0),n(e).panes.length===2?(f(),k(Q,{key:1},[a(_e,{pane:n(e).panes[0],style:{"grid-column":"1","grid-row":"1"},ref:g},null,8,["pane"]),x[0]||(x[0]=c("div",{class:"gutter-col","data-track":"1",style:{"grid-column":"2","grid-row":"1"}},null,-1)),a(_e,{pane:n(e).panes[1],style:{"grid-column":"3","grid-row":"1"},ref:g},null,8,["pane"])],64)):q("",!0),n(e).panes.length===3?(f(),k(Q,{key:2},[a(_e,{pane:n(e).panes[0],style:{"grid-column":"1","grid-row":"1 / span 3"},ref:g},null,8,["pane"]),x[1]||(x[1]=c("div",{class:"gutter-col","data-track":"1",style:{"grid-column":"2","grid-row":"1 / span 3"}},null,-1)),a(_e,{pane:n(e).panes[1],style:{"grid-column":"3","grid-row":"1"},ref:g},null,8,["pane"]),x[2]||(x[2]=c("div",{class:"gutter-row","data-track":"1",style:{"grid-column":"3","grid-row":"2"}},null,-1)),a(_e,{pane:n(e).panes[2],style:{"grid-column":"3","grid-row":"3"},ref:g},null,8,["pane"])],64)):q("",!0),n(e).panes.length>=4?(f(),k(Q,{key:3},[(f(!0),k(Q,null,ee(n(e).panes,(L,G)=>(f(),O(_e,{key:L.id,pane:L,ref_for:!0,ref:g},null,8,["pane"]))),128)),(f(!0),k(Q,null,ee(Math.ceil(Math.sqrt(n(e).panes.length))-1,L=>(f(),k("div",{key:`col-gutter-${L}`,class:"gutter-col","data-track":L*2-1,style:gt({"grid-column":L*2,"grid-row":"1 / -1"})},null,12,ii))),128)),(f(!0),k(Q,null,ee(Math.ceil(n(e).panes.length/Math.ceil(Math.sqrt(n(e).panes.length)))-1,L=>(f(),k("div",{key:`row-gutter-${L}`,class:"gutter-row","data-track":L*2-1,style:gt({"grid-row":L*2,"grid-column":"1 / -1"})},null,12,li))),128))],64)):q("",!0)],4))}}),di={class:"h-full w-full flex overflow-hidden"},ci={key:0,class:"left-sidebar-container"},pi={class:"py-1 px-2 border-b flex items-center justify-between flex-shrink-0"},mi={class:"flex-1 flex flex-col overflow-hidden min-h-0"},fi={class:"h-full w-full flex flex-col bg-background flex-1 min-h-0 overflow-hidden"},wi=K({__name:"SplitNotaView",setup(m){const t=pt(),e=ds(),s=we(),r=Pn(),o=D(null),{sidebarStates:i,toggleSidebar:u}=Vn(),g=se(()=>{const d=t.activePaneObj;return d&&d.notaId?s.getItem(d.notaId):null});return se(()=>(g.value,0)),se(()=>{var d,x;return(x=(d=o.value)==null?void 0:d.getActivePaneComponent)==null?void 0:x.call(d)}),Ce(()=>{t.initializeLayout()}),ie(()=>r.params.id,d=>{if(d&&typeof d=="string"){const x=t.getPaneByNotaId(d);x?t.setActivePane(x.id):t.openNotaInPane(d)}},{immediate:!0}),(d,x)=>(f(),k("div",di,[n(i).toc.isOpen?(f(),k("div",ci,[c("div",pi,[x[2]||(x[2]=cs('<div class="flex items-center"><svg class="h-3.5 w-3.5 text-primary mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><rect x="9" y="3" width="6" height="4" rx="1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M9 12h6M9 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><h3 class="text-sm font-medium">Table of Contents</h3></div>',1)),a(n(J),{variant:"ghost",size:"icon",class:"h-5 w-5 -mr-1",onClick:x[0]||(x[0]=L=>n(u)("toc"))},{default:l(()=>x[1]||(x[1]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"w-3 h-3"},[c("path",{d:"M18 6 6 18"}),c("path",{d:"m6 6 12 12"})],-1)])),_:1})]),c("div",mi,[n(e).activeEditor?(f(),O(Mn,{key:0,editor:n(e).activeEditor},null,8,["editor"])):q("",!0)])])):q("",!0),c("div",fi,[a(ui,{class:"flex-1 min-h-0",ref_key:"splitViewContainerRef",ref:o},null,512)])]))}});export{wi as default};
