import{d as Z,c5 as tt,O as et,a7 as ot,bc as st,q as k,P as I,cn as at,Q as ut,ab as nt,ay as lt,R as _,o as v,k as a,V as h,i as l,e as u,b4 as F,w as i,E as y,L as b,F as L,a3 as rt,J as S,aB as J,$ as H,ad as U,az as ct,ac as V,bJ as A,b as O,bC as dt,C as it,bl as pt,co as vt,cp as ft,aQ as j,cq as M,a6 as mt}from"./index-BQvMrvkP.js";const xt={class:"min-h-screen bg-background"},_t={class:"border-b bg-card"},yt={class:"container mx-auto px-4 py-4"},bt={class:"flex items-center justify-between"},gt={class:"flex items-center gap-4"},kt={class:"flex items-center gap-2"},ht={key:0,class:"flex items-center gap-2 text-muted-foreground"},wt={class:"flex items-center gap-2"},Ct={class:"container mx-auto px-4 py-6"},It={key:0,class:"flex items-center justify-center py-12"},Ot={class:"flex items-center gap-3"},Nt={key:1,class:"flex items-center justify-center py-12"},Bt={class:"flex items-center gap-3 text-destructive"},Et={class:"text-sm text-muted-foreground mt-1"},Lt={key:2},St={class:"flex items-center justify-between"},jt={class:"flex items-center gap-3"},$t={class:"flex items-center gap-2"},Rt={class:"flex items-center gap-2"},Tt={key:0,class:"text-sm text-muted-foreground"},Ut={key:0,class:"text-center py-12 text-muted-foreground"},Vt={key:2,class:"output-container"},zt=["innerHTML"],Dt={class:"whitespace-pre-wrap text-sm bg-muted/20 rounded border p-4 overflow-auto font-mono"},Ft=Z({__name:"CodeBlockOutputView",props:{notaId:{},blockId:{}},setup(q){const f=q;tt(),et();const Q=ot(),z=st(),g=k(null),s=k(null),w=k(!0),N=k(null),B=k(!1),$=k(null),P=I(()=>!g.value||!s.value?"Code Block Output":`${g.value.title} - Code Block Output`),m=I(()=>{var t,e,n;const o=((t=s.value)==null?void 0:t.output)||((n=(e=s.value)==null?void 0:e.attrs)==null?void 0:n.output);if(!o)return"text";if(o.includes("<table")||o.includes("<div")||o.includes("<img"))return"html";try{return JSON.parse(o),"json"}catch{return"text"}}),G=I(()=>{var o;return m.value==="html"||m.value==="json"&&((o=s.value)==null?void 0:o.output)&&s.value.output.length>100}),E=I(()=>{var t,e,n;const o=((t=s.value)==null?void 0:t.output)||((n=(e=s.value)==null?void 0:e.attrs)==null?void 0:n.output);if(!o)return"";if(m.value==="json")try{const d=JSON.parse(o);return JSON.stringify(d,null,2)}catch{return o}return at(o)}),R=I(()=>{var e,n,d;const o=((e=s.value)==null?void 0:e.output)||((d=(n=s.value)==null?void 0:n.attrs)==null?void 0:d.output);if(!o)return!1;const t=o.toLowerCase();return t.includes("error")||t.includes("exception")||t.includes("traceback")||t.includes("failed")}),T=async()=>{var o,t;w.value=!0,N.value=null;try{const e=Q.getCurrentNota(f.notaId);if(!e)throw new Error("Nota not found");g.value=e;const d=await ft().loadNotaBlocks(f.notaId,e),r=d.find(p=>p.id===f.blockId&&p.type==="executableCodeBlock");if(!r)throw new Error("Code block not found in nota");const C={type:"doc",content:d.map(p=>{if(p.type==="executableCodeBlock"){const x=p;return{type:p.type,attrs:{id:p.id,...x,serverID:"",kernelName:x.language||"python3",sessionId:x.sessionId||"",output:x.output||""},content:[{type:"text",text:x.content||""}]}}else return{type:p.type,attrs:{id:p.id,...p},content:[]}})};z.registerCodeCells(C,f.notaId,!0);const c=z.getCellById(f.blockId);j.debug("Cell lookup result:",{blockId:f.blockId,cellFound:!!c,cellOutput:c==null?void 0:c.output,cellHasError:c==null?void 0:c.hasError}),j.debug("Loading code block output:",{blockId:f.blockId,notaId:f.notaId,foundBlock:!!r,cellFromStore:!!c,cellOutput:((o=c==null?void 0:c.output)==null?void 0:o.substring(0,100))||"No output",blockOutput:((t=r==null?void 0:r.output)==null?void 0:t.substring(0,100))||"No output in block"}),c&&r?s.value={type:r.type,attrs:{id:r.id,...r,output:c.output||r.output},content:[],output:c.output||r.output}:r&&(s.value={type:r.type,attrs:{id:r.id,...r,output:r.output},content:[],output:r.output}),$.value=new Date}catch(e){N.value=e instanceof Error?e.message:"Failed to load code block",j.error("Error loading code block output:",e)}finally{w.value=!1}},K=async()=>{var t,e,n;const o=((t=s.value)==null?void 0:t.output)||((n=(e=s.value)==null?void 0:e.attrs)==null?void 0:n.output);if(o)try{const d=m.value==="json"?E.value:M(o);await navigator.clipboard.writeText(d),B.value=!0,setTimeout(()=>{B.value=!1},2e3)}catch(d){j.error("Failed to copy output:",d)}},W=()=>{var c,p,x,D;const o=((c=s.value)==null?void 0:c.output)||((x=(p=s.value)==null?void 0:p.attrs)==null?void 0:x.output);if(!o)return;const t=m.value==="json"?E.value:M(o),e=m.value==="json"?"json":"txt",n=`${((D=g.value)==null?void 0:D.title)||"output"}-${f.blockId}.${e}`,d=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(d),C=document.createElement("a");C.href=r,C.download=n,C.click(),URL.revokeObjectURL(r)},X=()=>{const o=`/nota/${f.notaId}`;window.open(o,"_blank")},Y=async()=>{await T()};return ut(()=>{T(),document.title=P.value}),nt([()=>f.notaId,()=>f.blockId],()=>{T()}),lt(()=>{document.title="BashNota"}),(o,t)=>(v(),_("div",xt,[a("header",_t,[a("div",yt,[a("div",bt,[a("div",gt,[a("div",kt,[l(u(F),{class:"w-6 h-6 text-primary"}),t[0]||(t[0]=a("h1",{class:"text-xl font-semibold"},"Code Block Output",-1))]),g.value?(v(),_("div",ht,[t[1]||(t[1]=a("span",null,"from",-1)),l(u(L),{variant:"secondary"},{default:i(()=>[y(b(g.value.title),1)]),_:1})])):h("",!0)]),a("div",wt,[l(u(S),{variant:"outline",size:"sm",onClick:X,class:"gap-2"},{default:i(()=>[l(u(rt),{class:"w-4 h-4"}),t[2]||(t[2]=y(" View Source "))]),_:1}),l(u(S),{variant:"outline",size:"sm",onClick:Y,disabled:w.value,class:"gap-2"},{default:i(()=>[l(u(J),{class:H(["w-4 h-4",{"animate-spin":w.value}])},null,8,["class"]),t[3]||(t[3]=y(" Refresh "))]),_:1},8,["disabled"])])])])]),a("main",Ct,[w.value?(v(),_("div",It,[a("div",Ot,[l(u(J),{class:"w-5 h-5 animate-spin"}),t[4]||(t[4]=a("span",null,"Loading code block output...",-1))])])):N.value?(v(),_("div",Nt,[l(u(V),{class:"max-w-md"},{default:i(()=>[l(u(U),{class:"pt-6"},{default:i(()=>[a("div",Bt,[l(u(ct),{class:"w-5 h-5"}),a("div",null,[t[5]||(t[5]=a("h3",{class:"font-medium"},"Error Loading Output",-1)),a("p",Et,b(N.value),1)])])]),_:1})]),_:1})])):s.value?(v(),_("div",Lt,[l(u(V),null,{default:i(()=>[l(u(A),null,{default:i(()=>{var e,n,d;return[a("div",St,[a("div",jt,[t[7]||(t[7]=a("h2",{class:"text-lg font-medium"},"Output",-1)),a("div",$t,[l(u(L),{variant:R.value?"destructive":"secondary"},{default:i(()=>[y(b(m.value.toUpperCase()),1)]),_:1},8,["variant"]),R.value?(v(),O(u(L),{key:0,variant:"destructive"},{default:i(()=>t[6]||(t[6]=[y(" Error ")])),_:1})):h("",!0),(e=s.value.attrs)!=null&&e.language?(v(),O(u(L),{key:1,variant:"outline"},{default:i(()=>[y(b(s.value.attrs.language),1)]),_:1})):h("",!0)])]),a("div",Rt,[l(u(S),{variant:"outline",size:"sm",onClick:K,disabled:!s.value.output&&!((n=s.value.attrs)!=null&&n.output),class:"gap-2"},{default:i(()=>[B.value?(v(),O(u(it),{key:1,class:"w-4 h-4"})):(v(),O(u(dt),{key:0,class:"w-4 h-4"})),y(" "+b(B.value?"Copied":"Copy"),1)]),_:1},8,["disabled"]),l(u(S),{variant:"outline",size:"sm",onClick:W,disabled:!s.value.output&&!((d=s.value.attrs)!=null&&d.output),class:"gap-2"},{default:i(()=>[l(u(pt),{class:"w-4 h-4"}),t[8]||(t[8]=y(" Download "))]),_:1},8,["disabled"])])]),$.value?(v(),_("div",Tt," Last updated: "+b($.value.toLocaleString()),1)):h("",!0)]}),_:1}),l(u(U),null,{default:i(()=>{var e,n;return[!s.value.output&&!((e=s.value.attrs)!=null&&e.output)?(v(),_("div",Ut,[l(u(F),{class:"w-12 h-12 mx-auto mb-3 opacity-50"}),t[9]||(t[9]=a("h3",{class:"text-lg font-medium mb-2"},"No Output",-1)),t[10]||(t[10]=a("p",{class:"text-sm"},"This code block hasn't been executed yet or produced no output.",-1))])):G.value?(v(),O(vt,{key:1,content:E.value,type:m.value==="json"?"dataframe":"html",height:"600px"},null,8,["content","type"])):s.value.output||(n=s.value.attrs)!=null&&n.output?(v(),_("div",Vt,[a("pre",{class:H(["whitespace-pre-wrap text-sm bg-muted/20 rounded border p-4 overflow-auto font-mono max-h-96",{"text-destructive":R.value}]),innerHTML:E.value},null,10,zt)])):h("",!0)]}),_:1})]),_:1}),l(u(V),{class:"mt-6"},{default:i(()=>[l(u(A),null,{default:i(()=>t[11]||(t[11]=[a("h3",{class:"text-lg font-medium"},"Source Code",-1)])),_:1}),l(u(U),null,{default:i(()=>{var e;return[a("pre",Dt,b(((e=s.value.content)==null?void 0:e.map(n=>n.text).join(`
`))||"No code content"),1)]}),_:1})]),_:1})])):h("",!0)])]))}}),Ht=mt(Ft,[["__scopeId","data-v-910fbc83"]]);export{Ht as default};
