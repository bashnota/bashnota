import{d as O,q as k,ab as S,P as C,dZ as F,d_ as A,b as _,o as r,w as l,i as a,e,bJ as Y,bK as T,E as d,bL as U,ad as j,k as s,R as u,V as m,b0 as M,ai as q,ak as J,al as L,aU as D,L as v,am as K,an as $,dg as Q,ct as Z,cu as G,$ as B,az as E,aB as X,J as ee,ac as te,t as i,aQ as w}from"./index-DL3HndNP.js";import{u as se}from"./useStorageMode-DwlCZl3J.js";import{u as ae}from"./SettingsView-BKzCHabl.js";import{s as oe}from"./directoryHandleStorage-BEIVvCyE.js";import{H as le}from"./hard-drive-XoB89juZ.js";const re={class:"space-y-3"},de={class:"flex items-center gap-2"},ie={class:"flex items-center gap-2"},ne={class:"flex items-center gap-2"},ce={key:0,class:"text-xs text-muted-foreground"},ue={class:"text-sm text-muted-foreground"},me={key:0,class:"space-y-3 pt-2 border-t"},fe={class:"flex items-center justify-between"},ge={class:"space-y-0.5"},pe={key:0,class:"flex items-center gap-2 p-2 bg-muted rounded-md"},ye={class:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg"},he={key:1,class:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-950/20 rounded-lg"},xe={key:2,class:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-950/20 rounded-lg"},be={class:"flex items-start gap-2"},Fe=O({__name:"StorageModeSettings",setup(_e){const n=ae(),{storageMode:f,autoWatch:c,isFilesystemSupported:g,isFilesystemMode:y,isWatchingFiles:p,getModeDescription:P,switchToFilesystem:N,switchToIndexedDB:I}=se(),h=k(!1),x=k(!1);S(()=>n.advancedSettings.storageMode,o=>{o!==f.value&&(f.value=o)},{immediate:!0}),S(()=>n.advancedSettings.filesystemAutoWatch,o=>{o!==c.value&&(c.value=o)},{immediate:!0});const W=async o=>{if(o!==f.value){h.value=!0;try{if(o==="filesystem"){if(!g.value){i.error("File System Access API Not Supported",{description:"Your browser does not support the File System Access API. Please use a modern browser like Chrome, Edge, or Opera."});return}try{const t=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});w.info("[StorageMode] Directory selected:",t.name),await oe(t),await N(),n.updateCategory("advanced",{storageMode:"filesystem"}),i.success("Filesystem Mode Enabled",{description:`Directory "${t.name}" selected. Please reload the page to complete the switch.`}),x.value=!0}catch(t){w.error("Failed to enable filesystem mode:",t),t.name==="AbortError"?i.info("Directory Selection Cancelled",{description:"You need to select a directory to use File System mode."}):i.error("Failed to Enable Filesystem Mode",{description:"Could not access the file system. Please check your browser permissions."})}}else I(),n.updateCategory("advanced",{storageMode:"indexeddb"}),i.success("IndexedDB Mode Enabled",{description:"Please reload the page to apply changes."}),x.value=!0}catch(t){w.error("Failed to change storage mode:",t),i.error("Failed to Change Storage Mode",{description:"An error occurred while changing the storage mode."})}finally{h.value=!1}}},R=o=>{c.value=o,n.updateCategory("advanced",{filesystemAutoWatch:o}),i.success(o?"Auto-Watch Enabled":"Auto-Watch Disabled",{description:o?"Changes to .nota files will be detected automatically.":"You will need to manually reload to see file changes."})},V=()=>{window.location.reload()},z=C(()=>y.value?F:A),H=C(()=>y.value?"File System":"IndexedDB");return(o,t)=>(r(),_(e(te),null,{default:l(()=>[a(e(Y),null,{default:l(()=>[a(e(T),{class:"flex items-center gap-2"},{default:l(()=>[a(e(le),{class:"w-5 h-5"}),t[1]||(t[1]=d(" Storage Mode "))]),_:1}),a(e(U),null,{default:l(()=>t[2]||(t[2]=[d(" Choose how BashNota stores your notes ")])),_:1})]),_:1}),a(e(j),{class:"space-y-6"},{default:l(()=>[s("div",re,[a(e(M),null,{default:l(()=>t[3]||(t[3]=[d("Storage Backend")])),_:1}),a(e(q),{"model-value":e(f),"onUpdate:modelValue":t[0]||(t[0]=b=>{(b==="indexeddb"||b==="filesystem")&&W(b)}),disabled:h.value},{default:l(()=>[a(e(J),{class:"w-full"},{default:l(()=>[a(e(L),null,{default:l(()=>[s("div",de,[(r(),_(D(z.value),{class:"w-4 h-4"})),d(" "+v(H.value),1)])]),_:1})]),_:1}),a(e(K),null,{default:l(()=>[a(e($),{value:"indexeddb"},{default:l(()=>[s("div",ie,[a(e(A),{class:"w-4 h-4"}),t[4]||(t[4]=d(" IndexedDB (Browser Storage) "))])]),_:1}),a(e($),{value:"filesystem",disabled:!e(g)},{default:l(()=>[s("div",ne,[a(e(F),{class:"w-4 h-4"}),t[5]||(t[5]=d(" File System (.nota files) ")),e(g)?m("",!0):(r(),u("span",ce," (Not Supported) "))])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model-value","disabled"]),s("p",ue,v(e(P)),1)]),e(y)?(r(),u("div",me,[s("div",fe,[s("div",ge,[a(e(M),null,{default:l(()=>t[6]||(t[6]=[d("Auto-Watch Files")])),_:1}),t[7]||(t[7]=s("p",{class:"text-sm text-muted-foreground"}," Automatically detect changes to .nota files in the selected directory ",-1))]),a(e(Q),{checked:e(c),"onUpdate:checked":R},null,8,["checked"])]),e(c)?(r(),u("div",pe,[(r(),_(D(e(p)?e(Z):e(G)),{class:B(["w-4 h-4",e(p)?"text-green-600 dark:text-green-400":"text-gray-400"])},null,8,["class"])),s("span",{class:B(["text-sm",e(p)?"text-green-700 dark:text-green-300":"text-muted-foreground"])}," File watcher is "+v(e(p)?"active":"inactive"),3)])):m("",!0),s("div",ye,[a(e(E),{class:"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),t[8]||(t[8]=s("div",{class:"text-sm text-blue-700 dark:text-blue-300"},[s("p",{class:"font-medium mb-1"},"File System Mode Benefits:"),s("ul",{class:"list-disc list-inside space-y-1 text-xs"},[s("li",null,"Edit .nota files directly with any text editor"),s("li",null,"Real-time synchronization with file system"),s("li",null,"Easy backup and version control with git"),s("li",null,"Works across multiple instances of BashNota")])],-1))])])):m("",!0),e(g)?m("",!0):(r(),u("div",he,[a(e(E),{class:"w-4 h-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),t[9]||(t[9]=s("div",{class:"text-sm text-amber-700 dark:text-amber-300"},[s("p",{class:"font-medium mb-1"},"File System Mode Not Available"),s("p",{class:"text-xs"}," Your browser does not support the File System Access API. Please use Chrome, Edge, or Opera to enable this feature. ")],-1))])),x.value?(r(),u("div",xe,[s("div",be,[a(e(X),{class:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5"}),t[10]||(t[10]=s("div",{class:"text-sm text-green-700 dark:text-green-300"},[s("p",{class:"font-medium"},"Reload Required"),s("p",{class:"text-xs"},"Please reload the page to apply storage mode changes")],-1))]),a(e(ee),{size:"sm",variant:"default",onClick:V},{default:l(()=>t[11]||(t[11]=[d(" Reload Now ")])),_:1})])):m("",!0)]),_:1})]),_:1}))}});export{Fe as default};
